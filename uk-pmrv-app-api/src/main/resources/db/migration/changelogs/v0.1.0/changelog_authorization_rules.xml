<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
		logicalFilePath="v0.1.0/changelog_authorization_rules.xml"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.11.xsd">

    <changeSet id="0_1_0_AUTHORIZATION_RULE_CREATE_SEQUENCE" author="tpapath">
        <createSequence sequenceName="au_rule_seq" minValue="0" maxValue="999999999999999999"
                        incrementBy="1" startValue="1" cycle="false"/>
        <rollback>
            <sql>
                DROP SEQUENCE IF EXISTS au_rule_seq;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_AUTHORIZATION_RULE_CREATE_TABLE" author="tpapath">
        <createTable tableName="au_rule" remarks="Represents an authorization rule">
            <column name="id" type="bigint" remarks="Primary key">
                <constraints primaryKey="true" primaryKeyName="au_rule_pk" nullable="false"/>
            </column>
            <column name="resource_type" type="varchar(255)" remarks="The role type of the user">
                <constraints nullable="false" />
            </column>
            <column name="resource_sub_type" type="varchar(255)" remarks="The resource type">
                <constraints nullable="true" />
            </column>
            <column name="handler" type="varchar(255)" remarks="The action on the resource">
                <constraints nullable="false" />
            </column>
            <column name="permission" type="varchar(255)" remarks="The permission needed to perform the action on the resource">
                <constraints nullable="true" />
            </column>
            <column name="role_type" type="varchar(255)" remarks="The role type of the user">
                <constraints nullable="false" />
            </column>
        </createTable>
        <rollback>
            <sql>
                DROP TABLE IF EXISTS au_rule;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_AUTHORIZED_SERVICE_CREATE_SEQUENCE" author="tpapath">
        <createSequence sequenceName="au_service_seq" minValue="0" maxValue="999999999999999999"
                        incrementBy="1" startValue="1" cycle="false"/>
        <rollback>
            <sql>
                DROP SEQUENCE IF EXISTS au_service_seq;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_AUTHORIZED_SERVICE_CREATE_TABLE" author="tpapath">
        <createTable tableName="au_service" remarks="Represents an authorized service">
            <column name="id" type="bigint" remarks="Primary key">
                <constraints primaryKey="true" primaryKeyName="au_service_pk" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)" remarks="The service name">
                <constraints nullable="false" unique="true" />
            </column>
        </createTable>
        <rollback>
            <sql>
                DROP TABLE IF EXISTS au_service CASCADE;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_AUTHORIZATION_SERVICE_RULE_CREATE_TABLE" author="tpapath">
        <createTable tableName="au_service_rule" remarks="Represents the relationship between services and rules">
            <column name="service_id" type="bigint" remarks="au_service id">
                <constraints nullable="false"/>
            </column>
            <column name="rule_id" type="bigint" remarks="au_rule id">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="au_service_rule" columnNames="service_id, rule_id" constraintName="au_service_rule_pk"/>
        <addForeignKeyConstraint baseTableName="au_service_rule" baseColumnNames="rule_id" constraintName="au_rule_fk" referencedTableName="au_rule" referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="au_service_rule" baseColumnNames="service_id" constraintName="au_service_fk" referencedTableName="au_service" referencedColumnNames="id"/>
        <rollback>
            <sql>
                DROP TABLE IF EXISTS au_service CASCADE;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_ACCOUNT_ACCESS_RULE" author="tpapath">
        <comment>Populate account access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT' , 'accountAccessHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT' , 'accountAccessHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'ACCOUNT' and handler = 'accountAccessHandler' and role_type = 'OPERATOR' and permission is null;
                delete from au_rule where resource_type = 'ACCOUNT' and handler = 'accountAccessHandler' and role_type = 'REGULATOR' and permission is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getAssignedItemsByAccount_AUTHORIZATION_SERVICE" author="tpapath">
        <validCheckSum>8:7103fb04952ee1a9862763e1295f4a49</validCheckSum>
        <comment>Populate getAssignedItemsByAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getAssignedItemsByAccount');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getAssignedItemsByAccount' and aur.resource_type = 'ACCOUNT' and aur.handler = 'accountAccessHandler' and permission is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getAssignedItemsByAccount');
                delete from au_service where name = 'getAssignedItemsByAccount';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_POPULATE_REQUEST_ACCESS_RULE" author="tpapath">
        <comment>Populate account access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST' , 'requestAccessHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST' , 'requestAccessHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'REQUEST' and handler = 'requestAccessHandler' and role_type = 'OPERATOR' and permission is null;
                delete from au_rule where resource_type = 'REQUEST' and handler = 'requestAccessHandler' and role_type = 'REGULATOR' and permission is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRequestActionsByRequestId_AUTHORIZATION_SERVICE" author="tpapath">
        <validCheckSum>8:1cd4513dfa2618238ac7c80b41c883d4</validCheckSum>
        <comment>Populate getAssignedItemsByAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRequestActionsByRequestId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getRequestActionsByRequestId' and aur.resource_type = 'REQUEST' and aur.handler = 'requestAccessHandler' and permission is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRequestActionsByRequestId');
                delete from au_service where name = 'getRequestActionsByRequestId';
            </sql>
        </rollback>
    </changeSet>



    <changeSet id="0_1_0_POPULATE_REQUEST_TASK_EXECUTE_ACCESS_RULE" author="tpapath">
        <comment>Populate account access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW', 'requestTaskExecuteAccessHandler', 'PERM_INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW_EXECUTE_TASK', 'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'ACCOUNT_USERS_SETUP', 'requestTaskExecuteAccessHandler', 'PERM_ACCOUNT_USERS_SETUP_EXECUTE_TASK', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'INSTALLATION_ACCOUNT_OPENING_ARCHIVE', 'requestTaskExecuteAccessHandler', 'PERM_INSTALLATION_ACCOUNT_OPENING_ARCHIVE_EXECUTE_TASK', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'PERMIT_ISSUANCE_APPLICATION_SUBMIT', 'requestTaskExecuteAccessHandler', 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK', 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'REQUEST_TASK' and handler = 'requestTaskExecuteAccessHandler';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_processRequestTaskAction_AUTHORIZATION_SERVICE" author="tpapath">
        <comment>Populate getAssignedItemsByAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'processRequestTaskAction');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'processRequestTaskAction' and aur.resource_type = 'REQUEST_TASK' and aur.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW'
            and aur.handler = 'requestTaskExecuteAccessHandler') or
            (aus.name = 'processRequestTaskAction' and aur.resource_type = 'REQUEST_TASK' and aur.resource_sub_type = 'ACCOUNT_USERS_SETUP'
            and aur.handler = 'requestTaskExecuteAccessHandler') or
            (aus.name = 'processRequestTaskAction' and aur.resource_type = 'REQUEST_TASK' and aur.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_ARCHIVE'
            and aur.handler = 'requestTaskExecuteAccessHandler') or
            (aus.name = 'processRequestTaskAction' and aur.resource_type = 'REQUEST_TASK' and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMIT'
            and aur.handler = 'requestTaskExecuteAccessHandler');
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRequestActionsByRequestId');
                delete from au_service where name = 'getRequestActionsByRequestId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getItemsAssignedToOthersByAccount_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate getItemsAssignedToOthersByAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getItemsAssignedToOthersByAccount');

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s cross join au_rule r
            where s.name = 'getItemsAssignedToOthersByAccount' and r.handler = 'accountAccessHandler' and r.resource_type ='ACCOUNT' and r.permission is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getItemsAssignedToOthersByAccount');
                delete from au_service where name = 'getItemsAssignedToOthersByAccount';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_CA_ACCESS_RULE" author="P70383">
        <comment>Populate ca access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'CA' , 'caAccessHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'CA' and handler = 'caAccessHandler' and role_type = 'REGULATOR' and permission is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateCurrentRegulatorUser_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate updateCurrentRegulatorUser service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateCurrentRegulatorUser');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'updateCurrentRegulatorUser' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission is null);

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'updateCurrentRegulatorUser');
                delete from au_service where name = 'updateCurrentRegulatorUser';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_CA_USERS_EDIT_ACCESS_RULE" author="P70383">
        <comment>Populate ca users edit access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'CA' , 'caAccessHandler', 'PERM_CA_USERS_EDIT', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'CA' and handler = 'caAccessHandler' and role_type = 'REGULATOR' and permission = 'PERM_CA_USERS_EDIT';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateRegulatorUserByCaAndId_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate updateRegulatorUserByCaAndId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateRegulatorUserByCaAndId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'updateRegulatorUserByCaAndId' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_EDIT');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'updateRegulatorUserByCaAndId');
                delete from au_service where name = 'updateRegulatorUserByCaAndId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_ACCOUNT_USERS_EDIT_ACCESS_RULE" author="pafilisa@unisystems.gr">
        <comment>Populate access rule to edit account users</comment>

        <sql>
            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT' , 'accountAccessHandler', 'PERM_ACCOUNT_USERS_EDIT', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT' , 'accountAccessHandler', 'PERM_ACCOUNT_USERS_EDIT', 'REGULATOR');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'ACCOUNT'
                and handler = 'accountAccessHandler'
                and permission = 'PERM_ACCOUNT_USERS_EDIT'
                and role_type in ('OPERATOR', 'REGULATOR');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateAccountOperatorUsers_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate updateAccountOperatorUsers service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateAccountOperatorUsers');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateAccountOperatorUsers'
            and aur.resource_type = 'ACCOUNT'
            and aur.handler = 'accountAccessHandler'
            and permission = 'PERM_ACCOUNT_USERS_EDIT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateAccountOperatorUsers');

                delete from au_service
                where name = 'updateAccountOperatorUsers';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_ACCOUNT_USERS_VIEW_ACCESS_RULE" author="pafilisa@unisystems.gr">
        <comment>Populate access rule to view account users</comment>

        <sql>
            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT' , 'accountAccessHandler', 'PERM_ACCOUNT_USERS_VIEW', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT' , 'accountAccessHandler', 'PERM_ACCOUNT_USERS_VIEW', 'REGULATOR');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'ACCOUNT'
                and handler = 'accountAccessHandler'
                and permission = 'PERM_ACCOUNT_USERS_VIEW'
                and role_type in ('OPERATOR', 'REGULATOR');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getAccountOperatorUsers_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate getAccountOperatorUsers service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getAccountOperatorUsers');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getAccountOperatorUsers'
            and aur.resource_type = 'ACCOUNT'
            and aur.handler = 'accountAccessHandler'
            and permission = 'PERM_ACCOUNT_USERS_VIEW';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getAccountOperatorUsers');

                delete from au_service
                where name = 'getAccountOperatorUsers';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getOperatorUserById_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate getOperatorUserById service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getOperatorUserById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getOperatorUserById'
            and aur.resource_type = 'ACCOUNT'
            and aur.handler = 'accountAccessHandler'
            and permission = 'PERM_ACCOUNT_USERS_EDIT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getOperatorUserById');

                delete from au_service
                where name = 'getOperatorUserById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateOperatorUserById_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate updateOperatorUserById service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateOperatorUserById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateOperatorUserById'
            and aur.resource_type = 'ACCOUNT'
            and aur.handler = 'accountAccessHandler'
            and permission = 'PERM_ACCOUNT_USERS_EDIT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateOperatorUserById');

                delete from au_service
                where name = 'updateOperatorUserById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRegulatorUserByCaAndId_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getRegulatorUserByCaAndId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRegulatorUserByCaAndId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getRegulatorUserByCaAndId' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_EDIT');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRegulatorUserByCaAndId');
                delete from au_service where name = 'getRegulatorUserByCaAndId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_CA_USERS_VIEW_ACCESS_RULE" author="P70383">
        <comment>Populate ca users edit access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'CA' , 'caAccessHandler', 'PERM_CA_USERS_VIEW', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'CA' and handler = 'caAccessHandler' and role_type = 'REGULATOR' and permission = 'PERM_CA_USERS_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getCaRegulators_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getCaRegulators service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getCaRegulators');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getCaRegulators' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_VIEW');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getCaRegulators');
                delete from au_service where name = 'getCaRegulators';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateCompetentAuthorityRegulatorUsersStatus_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate updateCompetentAuthorityRegulatorUsersStatus service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateCompetentAuthorityRegulatorUsersStatus');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'updateCompetentAuthorityRegulatorUsersStatus' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_EDIT');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'updateCompetentAuthorityRegulatorUsersStatus');
                delete from au_service where name = 'updateCompetentAuthorityRegulatorUsersStatus';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteRegulatorUserByCompetentAuthority_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate deleteRegulatorUserByCompetentAuthority service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteRegulatorUserByCompetentAuthority');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'deleteRegulatorUserByCompetentAuthority' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_EDIT');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'deleteRegulatorUserByCompetentAuthority');
                delete from au_service where name = 'deleteRegulatorUserByCompetentAuthority';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteCurrentRegulatorUserByCompetentAuthority_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate deleteCurrentRegulatorUserByCompetentAuthority service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteCurrentRegulatorUserByCompetentAuthority');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'deleteCurrentRegulatorUserByCompetentAuthority' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission is null);

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'deleteCurrentRegulatorUserByCompetentAuthority');
                delete from au_service where name = 'deleteCurrentRegulatorUserByCompetentAuthority';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_SERVICE_RULE_deleteCurrentRegulatorUserByCompetentAuthority_AUTHORIZATION_SERVICE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'deleteCurrentRegulatorUserByCompetentAuthority';</sqlCheck>
        </preConditions>
        <comment>Update service rule of deleteCurrentRegulatorUserByCompetentAuthority service</comment>
        <sql>
            update au_service_rule
            set rule_id = (select id from au_rule where resource_type = 'CA' and handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_EDIT')
            where service_id in (select id from au_service where name = 'deleteCurrentRegulatorUserByCompetentAuthority');
        </sql>
        <rollback>
            <sql>
                update au_service_rule
                set rule_id = (select id from au_rule where resource_type = 'CA' and handler = 'caAccessHandler' and permission is null)
                where service_id in (select id from au_service where name = 'deleteCurrentRegulatorUserByCompetentAuthority');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getUnassignedItemsByAccount_AUTHORIZATION_SERVICE" author="p70366@trasys.gr">
        <comment>Populate getUnassignedItemsByAccount service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getUnassignedItemsByAccount');

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s cross join au_rule r
            where s.name = 'getUnassignedItemsByAccount'
            and r.handler = 'accountAccessHandler'
            and r.resource_type ='ACCOUNT'
            and r.role_type = 'REGULATOR'
            and r.permission is null;
        </sql>

        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getUnassignedItemsByAccount');
                delete from au_service where name = 'getUnassignedItemsByAccount';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_inviteOperatorUserToAccount_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate inviteOperatorUserToAccount service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'inviteOperatorUserToAccount');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'inviteOperatorUserToAccount'
            and aur.resource_type = 'ACCOUNT'
            and aur.handler = 'accountAccessHandler'
            and permission = 'PERM_ACCOUNT_USERS_EDIT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'inviteOperatorUserToAccount');

                delete from au_service
                where name = 'inviteOperatorUserToAccount';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_inviteRegulatorUserToCA_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate inviteRegulatorUserToCA service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'inviteRegulatorUserToCA');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'inviteRegulatorUserToCA'
            and aur.resource_type = 'CA'
            and aur.handler = 'caAccessHandler'
            and permission = 'PERM_CA_USERS_EDIT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'inviteRegulatorUserToCA');

                delete from au_service
                where name = 'inviteRegulatorUserToCA';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getActiveAccountById_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getActiveAccountById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getActiveAccountById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getActiveAccountById' and aur.resource_type = 'ACCOUNT' and aur.handler = 'accountAccessHandler' and permission is null);

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getActiveAccountById');
                delete from au_service where name = 'getActiveAccountById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REQUEST_TASK_ACCESS_RULE" author="pafilisa@unisystems.gr">
        <comment>Populate request task access rule</comment>

        <sql>
            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskAccessHandler', 'PERM_TASK_ASSIGNMENT', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskAccessHandler', 'PERM_TASK_ASSIGNMENT', 'REGULATOR');
        </sql>

        <rollback>
            <sql>
                delete
                  from au_rule
                 where resource_type = 'REQUEST_TASK'
                   and handler = 'requestTaskAccessHandler'
                   and permission = 'PERM_TASK_ASSIGNMENT'
                   and role_type in ('OPERATOR', 'REGULATOR');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_assignTask_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate assignTask service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'assignTask');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and permission = 'PERM_TASK_ASSIGNMENT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask');

                delete from au_service
                where name = 'assignTask';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getCandidateAssignees_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate getCandidateAssignees service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getCandidateAssignees');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and permission = 'PERM_TASK_ASSIGNMENT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssignees');

                delete from au_service
                where name = 'getCandidateAssignees';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_releaseTask_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate releaseTask service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'releaseTask');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'releaseTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and permission = 'PERM_TASK_ASSIGNMENT';
        </sql>

        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'releaseTask');

                delete from au_service
                where name = 'releaseTask';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getCurrentRegulatorUserPermissionsByCa_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getCurrentRegulatorUserPermissionsByCa service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getCurrentRegulatorUserPermissionsByCa');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getCurrentRegulatorUserPermissionsByCa' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission is null);

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getCurrentRegulatorUserPermissionsByCa');
                delete from au_service where name = 'getCurrentRegulatorUserPermissionsByCa';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRegulatorUserPermissionsByCaAndId_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getRegulatorUserPermissionsByCaAndId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRegulatorUserPermissionsByCaAndId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getRegulatorUserPermissionsByCaAndId' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_EDIT');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRegulatorUserPermissionsByCaAndId');
                delete from au_service where name = 'getRegulatorUserPermissionsByCaAndId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_ACCOUNT_USERS_SETUP_MESSAGE_ACCESS_RULE" author="p70366@trasys.gr">
        <comment>Populate message access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE', 'ACCOUNT_USERS_SETUP', 'notificationSystemMessageAccessHandler', 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK', 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'SYSTEM_MESSAGE' and resource_sub_type = 'ACCOUNT_USERS_SETUP' and handler = 'notificationSystemMessageAccessHandler' and permission = 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getNotificationSystemMessageById_AUTHORIZATION_SERVICE" author="p70366@trasys.gr">
        <comment>Populate getNotificationSystemMessageById service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getNotificationSystemMessageById');

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s cross join au_rule r
            where s.name = 'getNotificationSystemMessageById'
            and r.handler = 'notificationSystemMessageAccessHandler'
            and r.resource_type = 'SYSTEM_MESSAGE'
            and resource_sub_type = 'ACCOUNT_USERS_SETUP';
        </sql>

        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getNotificationSystemMessageById');
                delete from au_service where name = 'getNotificationSystemMessageById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_RENAME_updateAccountOperatorUsers_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Rename updateAccountOperatorUsers to updateAccountOperatorAuthorities</comment>

        <sql>
            update au_service set name= 'updateAccountOperatorAuthorities'
            where name = 'updateAccountOperatorUsers';
        </sql>

        <rollback>
            <sql>
                update au_service set name= 'updateAccountOperatorUsers'
                where name = 'updateAccountOperatorAuthorities';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteAccountOperatorAuthority_AUTHORIZATION_SERVICE" author="p70366@trasys.gr">
        <comment>Populate deleteAccountOperatorAuthority service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteAccountOperatorAuthority');

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s cross join au_rule r
            where s.name = 'deleteAccountOperatorAuthority'
            and r.handler = 'accountAccessHandler'
            and r.resource_type = 'ACCOUNT'
            and r.permission = 'PERM_ACCOUNT_USERS_EDIT'
            and r.role_type = 'OPERATOR';
        </sql>

        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'deleteAccountOperatorAuthority');
                delete from au_service where name = 'deleteAccountOperatorAuthority';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteCurrentUserAccountOperatorAuthority_AUTHORIZATION_SERVICE" author="p70366@trasys.gr">
        <comment>Populate deleteCurrentUserAccountOperatorAuthority service</comment>

        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteCurrentUserAccountOperatorAuthority');

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s cross join au_rule r
            where s.name = 'deleteCurrentUserAccountOperatorAuthority'
            and r.handler = 'accountAccessHandler'
            and r.resource_type = 'ACCOUNT'
            and r.permission = 'PERM_ACCOUNT_USERS_EDIT'
            and r.role_type = 'OPERATOR';
        </sql>

        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'deleteCurrentUserAccountOperatorAuthority');
                delete from au_service where name = 'deleteCurrentUserAccountOperatorAuthority';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_VERIFICATION_BODY_USERS_VIEW_ACCESS_RULE" author="P35066">
        <comment>Populate verification body users access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'VERIFICATION_BODY', 'verificationBodyAccessHandler', 'PERM_VB_USERS_EDIT', 'VERIFIER');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'VERIFICATION_BODY'
                and handler = 'verificationBodyAccessHandler'
                and permission = 'PERM_VB_USERS_EDIT'
                and role_type = 'VERIFIER';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_updateVerifierUsers_AUTHORIZATION_SERVICE_AND_ASSIGN_TO_PERM_VB_USERS_EDIT_RULE" author="P35066">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateVerifierUsers');
            
            insert into au_service_rule(service_id, rule_id)
            values(
            	(select s.id from au_service s where s.name = 'updateVerifierUsers'),
            	(select r.id from au_rule r
            	  where r.resource_type = 'VERIFICATION_BODY'
            	  and r.handler = 'verificationBodyAccessHandler'
            	  and r.permission = 'PERM_VB_USERS_EDIT'
            	  and r.role_type = 'VERIFIER')
            );
        </sql>

        <rollback>
            <sql>
            	delete from au_service_rule 
            	where service_id = (select id from au_service where name = 'updateVerifierUsers');
            	
                delete from au_service where name = 'updateVerifierUsers';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getVerifierUserById_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getVerifierUserById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getVerifierUserById');

            insert into au_service_rule(service_id, rule_id)
            values(
            (select s.id from au_service s where s.name = 'getVerifierUserById'),
            (select r.id from au_rule r
            where r.resource_type = 'VERIFICATION_BODY'
            and r.handler = 'verificationBodyAccessHandler'
            and r.permission = 'PERM_VB_USERS_EDIT'
            and r.role_type = 'VERIFIER')
            );
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getVerifierUserById');
                delete from au_service where name = 'getVerifierUserById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRegulatorPermissionGroupLevels_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate getRegulatorPermissionGroupLevels service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRegulatorPermissionGroupLevels');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getRegulatorPermissionGroupLevels' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_EDIT');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRegulatorPermissionGroupLevels');
                delete from au_service where name = 'getRegulatorPermissionGroupLevels';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateVerifierUserById_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate updateVerifierUserById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateVerifierUserById');

            insert into au_service_rule(service_id, rule_id)
            values(
            (select s.id from au_service s where s.name = 'updateVerifierUserById'),
            (select r.id from au_rule r
            where r.resource_type = 'VERIFICATION_BODY'
            and r.handler = 'verificationBodyAccessHandler'
            and r.permission = 'PERM_VB_USERS_EDIT'
            and r.role_type = 'VERIFIER')
            );
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'updateVerifierUserById');
                delete from au_service where name = 'updateVerifierUserById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_inviteVerifierUser_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate inviteVerifierUser auth service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'inviteVerifierUser');

            insert into au_service_rule(service_id, rule_id)
            values(
            (select s.id from au_service s where s.name = 'inviteVerifierUser'),
            (select r.id from au_rule r
            where r.resource_type = 'VERIFICATION_BODY'
            and r.handler = 'verificationBodyAccessHandler'
            and r.permission = 'PERM_VB_USERS_EDIT'
            and r.role_type = 'VERIFIER')
            );
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'inviteVerifierUser');
                delete from au_service where name = 'inviteVerifierUser';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_NEW_USER_CONFIRMED_REQUEST_TASK_ACCESS_RULE" author="P35066">
        <comment>Populate NEW_USER_CONFIRMED REQUEST TASK access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'NEW_USER_CONFIRMED', 'requestTaskExecuteAccessHandler', null, 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'NEW_USER_CONFIRMED' and handler = 'requestTaskExecuteAccessHandler';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_processRequestTaskAction_AUTHORIZATION_SERVICE_with_NEW_USER_CONFIRMED_REQUEST_TASK" author="P35066">
        <comment>Populate processRequestTaskAction service WITH NEW_USER_CONFIRMED REQUEST_TASK rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            values(
            	(select s.id from au_service s where s.name = 'processRequestTaskAction'),
            	(select r.id from au_rule r
            	  where r.resource_type = 'REQUEST_TASK'
            	  and r.resource_sub_type = 'NEW_USER_CONFIRMED'
            	  and r.handler = 'requestTaskExecuteAccessHandler')
            );
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule 
                where service_id = (select id from au_service where name = 'processRequestTaskAction')
                and rule_id = (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'NEW_USER_CONFIRMED' and handler = 'requestTaskExecuteAccessHandler');
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_NEW_USER_CONFIRMED_SYSTEM_MESSAGE_ACCESS_RULE" author="P35066">
        <comment>Populate NEW_USER_CONFIRMED SYSTEM_MESSAGE access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE', 'NEW_USER_CONFIRMED', 'notificationSystemMessageAccessHandler', null, 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'SYSTEM_MESSAGE' and resource_sub_type = 'NEW_USER_CONFIRMED' and handler = 'notificationSystemMessageAccessHandler';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_getNotificationSystemMessageById_AUTHORIZATION_SERVICE_with_NEW_USER_CONFIRMED_SYSTEM_MESSAGE" author="P35066">
        <comment>Populate getNotificationSystemMessageById service WITH NEW_USER_CONFIRMED SYSTEM MESSAGE rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            values(
            	(select s.id from au_service s where s.name = 'getNotificationSystemMessageById'),
            	(select r.id from au_rule r
            	  where r.resource_type = 'SYSTEM_MESSAGE'
            	  and r.resource_sub_type = 'NEW_USER_CONFIRMED'
            	  and r.handler = 'notificationSystemMessageAccessHandler')
            );
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule 
                where service_id = (select id from au_service where name = 'getNotificationSystemMessageById')
                and rule_id = (select id from au_rule where resource_type = 'SYSTEM_MESSAGE' and resource_sub_type = 'NEW_USER_CONFIRMED' and handler = 'notificationSystemMessageAccessHandler');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_PERM_ACCOUNT_USERS_VIEW_permission" author="P70366">
        <sql>
            update au_rule
            set permission = NULL
            where permission = 'PERM_ACCOUNT_USERS_VIEW';
        </sql>
    </changeSet>
    
    <changeSet id="0_1_0_rename_getAccountOperatorUsers_service_to_getAccountOperatorAuthorities" author="P35066">
        <sql>
            update au_service
            set name = 'getAccountOperatorAuthorities'
            where name = 'getAccountOperatorUsers';
        </sql>
        <rollback>
            <sql>
               update au_service
	            set name = 'getAccountOperatorUsers'
	            where name = 'getAccountOperatorAuthorities';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_rename_updateVerifierUsers_service_to_updateVerifierAuthorities" author="P35066">
        <sql>
            update au_service
            set name = 'updateVerifierAuthorities'
            where name = 'updateVerifierUsers';
        </sql>
        <rollback>
            <sql>
               update au_service
	            set name = 'updateVerifierUsers'
	            where name = 'updateVerifierAuthorities';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_DELETE_CA_USERS_VIEW_ACCESS_RULE" author="pafilisa@unisystems.gr">
        <comment>Delete ca users edit access rule and services (getCaRegulators) using that rule</comment>
        <sql>
            delete
              from au_service_rule
             where rule_id in (select id
                                 from au_rule
                                where resource_type = 'CA'
                                  and handler = 'caAccessHandler'
                                  and role_type = 'REGULATOR'
                                  and permission = 'PERM_CA_USERS_VIEW');

            delete
              from au_rule
              where resource_type = 'CA'
                and handler = 'caAccessHandler'
                and role_type = 'REGULATOR'
                and permission = 'PERM_CA_USERS_VIEW';

            delete
            from au_service
            where name = 'getCaRegulators';
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, handler, permission, role_type)
                values (nextval('au_rule_seq'), 'CA' , 'caAccessHandler', 'PERM_CA_USERS_VIEW', 'REGULATOR');

                insert into au_service(id, name)
                values (nextval('au_service_seq'), 'getCaRegulators');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id from au_service aus cross join au_rule aur where
                (aus.name = 'getCaRegulators' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission = 'PERM_CA_USERS_VIEW');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REQUEST_TASK_VIEW_RULE" author="P70383">
        <comment>Populate request task view rule</comment>

        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskViewHandler', 'REGULATOR');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK' and handler = 'requestTaskViewHandler'
                and role_type in ('OPERATOR', 'REGULATOR') and permission is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getItemTaskInfo_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getItemTaskInfo service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getItemTaskInfo');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getItemTaskInfo' and aur.resource_type = 'REQUEST_TASK' and aur.handler = 'requestTaskViewHandler' and permission is null);

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getItemTaskInfo');
                delete from au_service where name = 'getItemTaskInfo';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REQUEST_VIEW_RULE" author="P70383">
        <comment>Populate request view rule</comment>

        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST' , 'requestViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST' , 'requestViewHandler', 'REGULATOR');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST' and handler = 'requestViewHandler'
                and role_type in ('OPERATOR', 'REGULATOR') and permission is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getItemRequestInfo_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getItemRequestInfo service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getItemRequestInfo');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getItemRequestInfo' and aur.resource_type = 'REQUEST' and aur.handler = 'requestViewHandler' and permission is null);

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getItemRequestInfo');
                delete from au_service where name = 'getItemRequestInfo';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getTaskItemInfoById_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getTaskItemInfoById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getTaskItemInfoById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getTaskItemInfoById' and aur.resource_type = 'REQUEST_TASK' and aur.handler = 'requestTaskViewHandler' and permission is null);
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getTaskItemInfoById');
                delete from au_service where name = 'getTaskItemInfoById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REQUEST_OBJECT_ACCESS_RULE" author="P70383">
        <comment>Populate request object access rule</comment>

        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_REF_OBJECT' , 'requestObjectAccessHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_REF_OBJECT' , 'requestObjectAccessHandler', 'REGULATOR');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_REF_OBJECT' and handler = 'requestObjectAccessHandler'
                and role_type in ('OPERATOR', 'REGULATOR') and permission is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRequestActionsByRequestRefObjectId_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getRequestActionsByRequestRefObjectId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRequestActionsByRequestRefObjectId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getRequestActionsByRequestRefObjectId' and aur.resource_type = 'REQUEST_REF_OBJECT' and aur.handler = 'requestObjectAccessHandler' and permission is null);
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRequestActionsByRequestRefObjectId');
                delete from au_service where name = 'getRequestActionsByRequestRefObjectId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REQUEST_TASK_EXECUTE_VIEW_ACCESS_RULE" author="P70383">
        <comment>Populate request task execute view rule</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW', 'requestTaskExecuteAccessHandler', 'PERM_INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW_VIEW_TASK', 'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'ACCOUNT_USERS_SETUP', 'requestTaskExecuteAccessHandler', 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'INSTALLATION_ACCOUNT_OPENING_ARCHIVE', 'requestTaskExecuteAccessHandler', 'PERM_INSTALLATION_ACCOUNT_OPENING_ARCHIVE_VIEW_TASK', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'PERMIT_ISSUANCE_APPLICATION_SUBMIT', 'requestTaskExecuteAccessHandler', 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK', 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'REQUEST_TASK' and handler = 'requestTaskExecuteAccessHandler'
                and permission in ('PERM_INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW_VIEW_TASK', 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK', 'PERM_INSTALLATION_ACCOUNT_OPENING_ARCHIVE_VIEW_TASK', 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_assignTask_AUTHORIZATION_SERVICE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'assignTask';</sqlCheck>
        </preConditions>
        <comment>Update assignTask service</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.permission like '%_VIEW_TASK';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'assignTask')
                and rule_id in (select id from au_rule where resource_type = 'REQUEST_TASK' and handler = 'requestTaskExecuteAccessHandler' and permission like '%_VIEW_TASK');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_getCandidateAssignees_AUTHORIZATION_SERVICE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getCandidateAssignees';</sqlCheck>
        </preConditions>
        <comment>Update getCandidateAssignees service</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.permission like '%_VIEW_TASK';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getCandidateAssignees')
                and rule_id in (select id from au_rule where resource_type = 'REQUEST_TASK' and handler = 'requestTaskExecuteAccessHandler' and permission like '%_VIEW_TASK');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRegulatorRoles_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate getRegulatorRoles service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRegulatorRoles');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
              from au_service aus
             cross join au_rule aur
            where aus.name = 'getRegulatorRoles'
              and aur.resource_type = 'CA'
              and aur.handler = 'caAccessHandler'
              and permission = 'PERM_CA_USERS_EDIT';
        </sql>
        <rollback>
            <sql>
                delete
                  from au_service_rule
                 where service_id = (select id from au_service where name = 'getRegulatorRoles');

                delete
                  from au_service
                 where name = 'getRegulatorRoles';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getOperatorRoleCodes_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate getOperatorRoleCodes service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getOperatorRoleCodes');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
              from au_service aus
             cross join au_rule aur
            where aus.name = 'getOperatorRoleCodes'
              and aur.resource_type = 'ACCOUNT'
              and aur.handler = 'accountAccessHandler'
              and permission = 'PERM_ACCOUNT_USERS_EDIT';
        </sql>
        <rollback>
            <sql>
                delete
                  from au_service_rule
                 where service_id = (select id from au_service where name = 'getOperatorRoleCodes');

                delete
                  from au_service
                 where name = 'getOperatorRoleCodes';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getVerifierRoleCodes_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate getVerifierRoleCodes service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getVerifierRoleCodes');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getVerifierRoleCodes'
            and aur.resource_type = 'VERIFICATION_BODY'
            and aur.handler = 'verificationBodyAccessHandler'
            and permission = 'PERM_VB_USERS_EDIT';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getVerifierRoleCodes');

                delete
                from au_service
                where name = 'getVerifierRoleCodes';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_ACCOUNT_USERS_SETUP_MESSAGE_ACCESS_RULE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_rule where resource_type = 'SYSTEM_MESSAGE' and resource_sub_type = 'ACCOUNT_USERS_SETUP'
                and handler = 'notificationSystemMessageAccessHandler';
            </sqlCheck>
        </preConditions>
        <comment>Update message access rule for account users setup</comment>
        <sql>
            update au_rule
            set permission = null
            where resource_type = 'SYSTEM_MESSAGE' and resource_sub_type = 'ACCOUNT_USERS_SETUP' and handler = 'notificationSystemMessageAccessHandler';
        </sql>
        <rollback>
            <sql>
                update au_rule
                set permission = 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK'
                where resource_type = 'SYSTEM_MESSAGE' and resource_sub_type = 'ACCOUNT_USERS_SETUP' and handler = 'notificationSystemMessageAccessHandler';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_ACCOUNT_USERS_SETUP_REQUEST_TASK_EXECUTE_ACCESS_RULE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="2">SELECT count(*) FROM au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP'
                and handler = 'requestTaskExecuteAccessHandler';
            </sqlCheck>
        </preConditions>
        <comment>Update request task execute access rule for account users setup</comment>
        <sql>
            update au_service_rule
            set rule_id = (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP'
                and handler = 'requestTaskExecuteAccessHandler' and permission = 'PERM_ACCOUNT_USERS_SETUP_EXECUTE_TASK')
            where rule_id in (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP'
                and handler = 'requestTaskExecuteAccessHandler' and permission = 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK');

            delete
            from au_rule
            where id = (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP'
                and handler = 'requestTaskExecuteAccessHandler' and permission = 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK');

            update au_rule
            set permission = null
            where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP' and handler = 'requestTaskExecuteAccessHandler'
                and permission = 'PERM_ACCOUNT_USERS_SETUP_EXECUTE_TASK';
        </sql>
        <rollback>
            <sql>
                update au_rule
                set permission = 'PERM_ACCOUNT_USERS_SETUP_EXECUTE_TASK'
                where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP' and handler = 'requestTaskExecuteAccessHandler'
                    and permission is null;

                insert into au_rule(id, resource_type, resource_sub_type, handler, permission, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_TASK', 'ACCOUNT_USERS_SETUP', 'requestTaskExecuteAccessHandler', 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK', 'OPERATOR');

                update au_service_rule
                set rule_id = (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP'
                    and handler = 'requestTaskExecuteAccessHandler' and permission = 'PERM_ACCOUNT_USERS_SETUP_VIEW_TASK')
                where service_id in (select id from au_service where name in ('assignTask', 'getCandidateAssignees'))
                and rule_id = (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'ACCOUNT_USERS_SETUP'
                    and handler = 'requestTaskExecuteAccessHandler' and permission = 'PERM_ACCOUNT_USERS_SETUP_EXECUTE_TASK')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_assignTask_AUTHORIZATION_SERVICE_WITH_NEW_USER_CONFIRMED" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'assignTask';
            </sqlCheck>
        </preConditions>
        <comment>Update assignTask service with rule requestTaskExecuteAccessHandler for NEW_USER_CONFIRMED resource type</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'NEW_USER_CONFIRMED'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and permission is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'NEW_USER_CONFIRMED'
                    and handler = 'requestTaskExecuteAccessHandler' and permission is null);
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_getCandidateAssignees_AUTHORIZATION_SERVICE_WITH_NEW_USER_CONFIRMED" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getCandidateAssignees';
            </sqlCheck>
        </preConditions>
        <comment>Update getCandidateAssignees service with rule requestTaskExecuteAccessHandler for NEW_USER_CONFIRMED resource type</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'NEW_USER_CONFIRMED'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and permission is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssignees')
                and rule_id = (select id from au_rule where resource_type = 'REQUEST_TASK' and resource_sub_type = 'NEW_USER_CONFIRMED'
                and handler = 'requestTaskExecuteAccessHandler' and permission is null);
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_DELETE_getRequestActionsByRequestRefObjectId_AUTHORIZATION_SERVICE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getRequestActionsByRequestRefObjectId';</sqlCheck>
        </preConditions>
        <comment>Delete getRequestActionsByRequestRefObjectId service</comment>
        <sql>
            delete from au_service_rule where service_id = (select id from au_service where name = 'getRequestActionsByRequestRefObjectId');
            delete from au_service where name = 'getRequestActionsByRequestRefObjectId';
        </sql>
        <rollback>
            <sql>
                insert into au_service(id, name)
                values (nextval('au_service_seq'), 'getRequestActionsByRequestRefObjectId');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id from au_service aus cross join au_rule aur where
                (aus.name = 'getRequestActionsByRequestRefObjectId' and aur.resource_type = 'REQUEST_REF_OBJECT' and aur.handler = 'requestObjectAccessHandler' and permission is null);
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_DELETE_REQUEST_OBJECT_ACCESS_RULE" author="P70383">
        <comment>Delete request object access rule</comment>
        <sql>
            delete from au_rule
            where resource_type = 'REQUEST_REF_OBJECT' and handler = 'requestObjectAccessHandler'
            and role_type in ('OPERATOR', 'REGULATOR') and permission is null;
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_REF_OBJECT' , 'requestObjectAccessHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_REF_OBJECT' , 'requestObjectAccessHandler', 'REGULATOR');
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_ADD_SCOPE_COLUMN_IN_AUTHORIZATION_RULE_TABLE" author="P35066">
        <addColumn tableName="au_rule">
            <column name="scope" type="varchar(255)" remarks="The authorization scope of the rule">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <rollback>
            <sql>
                ALTER TABLE au_rule
                DROP COLUMN IF EXISTS scope;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_RESOURCE_SCOPE_PERMISSION_CREATE_SEQUENCE" author="P35066">
        <createSequence sequenceName="au_resource_scope_permission_seq" minValue="0" maxValue="999999999999999999"
                        incrementBy="1" startValue="1" cycle="false"/>
        <rollback>
            <sql>
                DROP SEQUENCE IF EXISTS au_resource_scope_permission_seq;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_RESOURCE_SCOPE_PERMISSION_CREATE_TABLE" author="P35066">
        <createTable tableName="au_resource_scope_permission" remarks="Represents a resource scope with the required permission">
            <column name="id" type="bigint" remarks="Primary key">
                <constraints primaryKey="true" primaryKeyName="au_resource_scope_permission_pk" nullable="false"/>
            </column>
            <column name="resource_type" type="varchar(255)" remarks="The resource type">
                <constraints nullable="false" />
            </column>
            <column name="resource_sub_type" type="varchar(255)" remarks="The resource sub type">
                <constraints nullable="true" />
            </column>
            <column name="scope" type="varchar(255)" remarks="The authorization scope of the permission">
                <constraints nullable="true" />
            </column>
            <column name="permission" type="varchar(255)" remarks="The permission">
                <constraints nullable="false" />
            </column>
        </createTable>
        <rollback>
            <sql>
                DROP TABLE IF EXISTS au_resource_scope_permission;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_RESOURCE_SCOPE_PERMISSION_TABLE" author="P35066">
        <comment>Populate RESOURCE_SCOPE_PERMISSION table</comment>
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, permission)
			(select nextval('au_resource_scope_permission_seq'), r.resource_type, r.resource_sub_type, r.permission
			 from au_rule r 
			 where r.permission is not null
			 group by r.resource_type, r.resource_sub_type, r.permission
			);
        </sql>
     </changeSet>
     
     <changeSet id="0_1_0_POPULATE_RESOURCE_SCOPE_PERMISSION_TABLE_SCOPE_COLUMN" author="P35066">
        <comment>Populate au_resource_scope_permission SCOPE column</comment>
        <sql>
            update au_resource_scope_permission set scope = 'REQUEST_TASK_EXECUTE' 
            where resource_type = 'REQUEST_TASK' 
            and resource_sub_type is not null
            and permission like '%_EXECUTE_TASK';
            
            update au_resource_scope_permission set scope = 'REQUEST_TASK_VIEW' 
            where resource_type = 'REQUEST_TASK' 
            and resource_sub_type is not null
            and permission like '%_VIEW_TASK';
            
            update au_resource_scope_permission set scope = 'ACCESS' 
            where scope is null;
        </sql>
     </changeSet>
     
     <changeSet id="0_1_0_ADD_NOT_NULL_CONSTRAINT_TO_SCOPE_COLUMN_OF_RESOURCE_SCOPE_PERMISSION_TABLE" author="P35066" >
		<addNotNullConstraint tableName="au_resource_scope_permission" columnName="scope" />
		<rollback>
            <dropNotNullConstraint tableName="au_resource_scope_permission" columnName="scope"/>
        </rollback>
	</changeSet>
     
     <changeSet id="0_1_0_POPULATE_AUTHORIZATION_RULE_TABLE_SCOPE_COLUMN" author="P35066">
        <comment>Populate au_rule SCOPE column</comment>
        <sql>
            with v as (
                select rps.resource_type as rps_resource_type, rps.permission as rps_perm, rps.scope as rps_scope
                from au_resource_scope_permission rps
            )
            update au_rule
            set scope = v.rps_scope
            from v
            where resource_type = v.rps_resource_type
            and permission = v.rps_perm;
        </sql>
     </changeSet>
     
     <changeSet id="0_1_0_DELETE_CA_AUTHORIZATION_RULE_WITH_NO_PERMISSION_ENTRY" author="P35066">
        <comment>Delete authorization rule entry with resource type CA and no permission</comment>
        <sql>
        	delete from au_service_rule
        	where rule_id = (select id from au_rule where resource_type = 'CA' and handler = 'caAccessHandler' and permission is null);
        	
        	delete from au_rule
        	where resource_type = 'CA' and handler = 'caAccessHandler'  and permission is null;
        	
        	delete from au_service where name = 'updateCurrentRegulatorUser';
        	
        	delete from au_service where name = 'getCurrentRegulatorUserPermissionsByCa';
        </sql>
        <rollback>
            <sql>
            	insert into au_rule(id, resource_type, handler, role_type)
            	values (nextval('au_rule_seq'), 'CA' , 'caAccessHandler', 'REGULATOR');
            	
            	insert into au_service(id, name)
	            values (nextval('au_service_seq'), 'updateCurrentRegulatorUser');
	            
	            insert into au_service(id, name)
            	values (nextval('au_service_seq'), 'getCurrentRegulatorUserPermissionsByCa');
	
	            insert into au_service_rule(service_id, rule_id)
	            select aus.id, aur.id 
	            from au_service aus cross join au_rule aur 
	            where aus.name = 'updateCurrentRegulatorUser' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission is null;
	            
	            insert into au_service_rule(service_id, rule_id)
	            select aus.id, aur.id 
	            from au_service aus cross join au_rule aur 
	            where aus.name = 'getCurrentRegulatorUserPermissionsByCa' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and permission is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_RENAME_REQUEST_TASK_ASSIGNMENT_SCOPE_NAME" author="P35066">
        <comment>Rename request task assignment scope from ACCESS to REQUEST_TASK_ASSIGN</comment>
        <sql>
        	update au_resource_scope_permission
        	set scope = 'REQUEST_TASK_ASSIGN'
        	where resource_type = 'REQUEST_TASK' and permission = 'PERM_TASK_ASSIGNMENT' and scope = 'ACCESS';
        	
        	update au_rule
        	set scope = 'REQUEST_TASK_ASSIGN'
        	where resource_type = 'REQUEST_TASK' and permission = 'PERM_TASK_ASSIGNMENT' and scope = 'ACCESS';
        </sql>
        <rollback>
            <sql>
            	update au_resource_scope_permission
	        	set scope = 'ACCESS'
	        	where resource_type = 'REQUEST_TASK' and permission = 'PERM_TASK_ASSIGNMENT' and scope = 'REQUEST_TASK_ASSIGN';
	        	
	        	update au_rule
	        	set scope = 'ACCESS'
	        	where resource_type = 'REQUEST_TASK' and permission = 'PERM_TASK_ASSIGNMENT' and scope = 'REQUEST_TASK_ASSIGN';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_RENAME_EDIT_USER_RELATED_SCOPE_NAME" author="P35066">
        <comment>Rename edit users scope from ACCESS to EDIT_USER</comment>
        <sql>
        	update au_resource_scope_permission
        	set scope = 'EDIT_USER'
        	where resource_type = 'CA' and permission = 'PERM_CA_USERS_EDIT' and scope = 'ACCESS';
        	
        	update au_resource_scope_permission
        	set scope = 'EDIT_USER'
        	where resource_type = 'ACCOUNT' and permission = 'PERM_ACCOUNT_USERS_EDIT' and scope = 'ACCESS';
        	
        	update au_resource_scope_permission
        	set scope = 'EDIT_USER'
        	where resource_type = 'VERIFICATION_BODY' and permission = 'PERM_VB_USERS_EDIT' and scope = 'ACCESS';
        	
        	update au_rule
        	set scope = 'EDIT_USER'
        	where resource_type = 'CA' and permission = 'PERM_CA_USERS_EDIT' and scope = 'ACCESS';
        	
        	update au_rule
        	set scope = 'EDIT_USER'
        	where resource_type = 'ACCOUNT' and permission = 'PERM_ACCOUNT_USERS_EDIT' and scope = 'ACCESS';
        	
        	update au_rule
        	set scope = 'EDIT_USER'
        	where resource_type = 'VERIFICATION_BODY' and permission = 'PERM_VB_USERS_EDIT' and scope = 'ACCESS';
        </sql>
        <rollback>
            <sql>
            	update au_resource_scope_permission
	        	set scope = 'ACCESS'
	        	where resource_type = 'CA' and permission = 'PERM_CA_USERS_EDIT' and scope = 'EDIT_USER';
	        	
	        	update au_resource_scope_permission
	        	set scope = 'ACCESS'
	        	where resource_type = 'ACCOUNT' and permission = 'PERM_ACCOUNT_USERS_EDIT' and scope = 'EDIT_USER';
	        	
	        	update au_resource_scope_permission
	        	set scope = 'ACCESS'
	        	where resource_type = 'VERIFICATION_BODY' and permission = 'PERM_VB_USERS_EDIT' and scope = 'EDIT_USER';
	        	
	        	update au_rule
	        	set scope = 'ACCESS'
	        	where resource_type = 'CA' and permission = 'PERM_CA_USERS_EDIT' and scope = 'EDIT_USER';
	        	
	        	update au_rule
	        	set scope = 'ACCESS'
	        	where resource_type = 'ACCOUNT' and permission = 'PERM_ACCOUNT_USERS_EDIT' and scope = 'EDIT_USER';
	        	
	        	update au_rule
	        	set scope = 'ACCESS'
	        	where resource_type = 'VERIFICATION_BODY' and permission = 'PERM_VB_USERS_EDIT' and scope = 'EDIT_USER';
            </sql>
        </rollback>
    </changeSet>
     
     <changeSet id="0_1_0_DROP_PERMISSION_COLUMN_FROM_AUTHORIZATION_RULE_TABLE" author="P35066">
        <dropColumn tableName="au_rule">
            <column name="permission"/> 
        </dropColumn>
        <rollback>
            <addColumn tableName="au_rule">
	            <column name="permission" type="varchar(255)" remarks="The permission needed to perform the action on the resource">
	                <constraints nullable="true" />
	            </column>
	        </addColumn>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteCaExternalContactById_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate deleteCaExternalContactById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteCaExternalContactById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'deleteCaExternalContactById' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and scope = 'EDIT_USER');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'deleteCaExternalContactById');
                delete from au_service where name = 'deleteCaExternalContactById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_createCaExternalContact_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate createCaExternalContact service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'createCaExternalContact');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'createCaExternalContact' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and scope = 'EDIT_USER');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'createCaExternalContact');
                delete from au_service where name = 'createCaExternalContact';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_editCaExternalContact_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate editCaExternalContact service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'editCaExternalContact');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'editCaExternalContact' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and scope = 'EDIT_USER');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'editCaExternalContact');
                delete from au_service where name = 'editCaExternalContact';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getCaExternalContactById_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate getCaExternalContactById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getCaExternalContactById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            (aus.name = 'getCaExternalContactById' and aur.resource_type = 'CA' and aur.handler = 'caAccessHandler' and scope = 'EDIT_USER');

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getCaExternalContactById');
                delete from au_service where name = 'getCaExternalContactById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateCaSiteContacts_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate updateCaSiteContacts service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateCaSiteContacts');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateCaSiteContacts'
            and aur.resource_type = 'CA'
            and aur.handler = 'caAccessHandler'
            and aur.scope = 'EDIT_USER';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateCaSiteContacts');

                delete
                from au_service
                where name = 'updateCaSiteContacts';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_ACCOUNT_ACCESS_RULE_VERIFIER" author="P70383">
        <comment>Populate account access rule for verifier</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT' , 'accountAccessHandler', 'VERIFIER');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'ACCOUNT' and handler = 'accountAccessHandler' and role_type = 'VERIFIER' and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_getAssignedItemsByAccount_VERIFIER_AUTHORIZATION_SERVICE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getAssignedItemsByAccount';</sqlCheck>
        </preConditions>
        <comment>Update getAssignedItemsByAccount service for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getAssignedItemsByAccount' and aur.resource_type = 'ACCOUNT' and aur.handler = 'accountAccessHandler' and aur.role_type = 'VERIFIER' and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getAssignedItemsByAccount')
                and rule_id = (select id from au_rule where resource_type = 'ACCOUNT' and handler = 'accountAccessHandler' and role_type = 'VERIFIER');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_getItemsAssignedToOthersByAccount_VERIFIER_AUTHORIZATION_SERVICE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getItemsAssignedToOthersByAccount';</sqlCheck>
        </preConditions>
        <comment>Update getItemsAssignedToOthersByAccount service for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getItemsAssignedToOthersByAccount' and aur.resource_type = 'ACCOUNT' and aur.handler = 'accountAccessHandler' and aur.role_type = 'VERIFIER' and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getItemsAssignedToOthersByAccount')
                and rule_id = (select id from au_rule where resource_type = 'ACCOUNT' and handler = 'accountAccessHandler' and role_type = 'VERIFIER');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_UPDATE_getUnassignedItemsByAccount_VERIFIER_AUTHORIZATION_SERVICE" author="P70383">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getUnassignedItemsByAccount';</sqlCheck>
        </preConditions>
        <comment>Update getUnassignedItemsByAccount service for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getUnassignedItemsByAccount' and aur.resource_type = 'ACCOUNT' and aur.handler = 'accountAccessHandler' and aur.role_type = 'VERIFIER' and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getUnassignedItemsByAccount')
                and rule_id = (select id from au_rule where resource_type = 'ACCOUNT' and handler = 'accountAccessHandler' and role_type = 'VERIFIER');
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_CREATE_REQUEST_TASK_ACCESS_RULE_ENTRY_FOR_VERIFIER" author="P35066">
        <comment>Create request task access rule entry for verifier</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskAccessHandler', 'VERIFIER', 'REQUEST_TASK_ASSIGN');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and handler = 'requestTaskAccessHandler'
                and scope = 'REQUEST_TASK_ASSIGN'
                and role_type = 'VERIFIER';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_assignTask_SERVICE_WITH_REQUEST_TASK_ACCESS_VERIFIER_RULE" author="P35066">
        <comment>Associate assignTask service with request task access rule for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_ASSIGN'
            and aur.role_type = 'VERIFIER';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
	                and handler = 'requestTaskAccessHandler'
	                and scope = 'REQUEST_TASK_ASSIGN'
	                and role_type = 'VERIFIER'
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getCandidateAssignees_SERVICE_WITH_REQUEST_TASK_ACCESS_VERIFIER_RULE" author="P35066">
        <comment>Associate assignTask service with request task access rule for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_ASSIGN'
            and aur.role_type = 'VERIFIER';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssignees')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
	                and handler = 'requestTaskAccessHandler'
	                and scope = 'REQUEST_TASK_ASSIGN'
	                and role_type = 'VERIFIER'
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_releaseTask_SERVICE_WITH_REQUEST_TASK_ACCESS_VERIFIER_RULE" author="P35066">
        <comment>Associate assignTask service with request task access rule for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'releaseTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_ASSIGN'
            and aur.role_type = 'VERIFIER';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'releaseTask')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
	                and handler = 'requestTaskAccessHandler'
	                and scope = 'REQUEST_TASK_ASSIGN'
	                and role_type = 'VERIFIER'
                );
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_CREATE_REQUEST_ACCESS_RULE_ENTRY_FOR_VERIFIER" author="P35066">
        <comment>Create request access rule entry for verifier</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST' , 'requestAccessHandler', 'VERIFIER');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST'
                and handler = 'requestAccessHandler'
                and role_type = 'VERIFIER'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getRequestActionsByRequestId_SERVICE_WITH_REQUEST_ACCESS_VERIFIER_RULE" author="P35066">
        <comment>Associate getRequestActionsByRequestId service with request access rule for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getRequestActionsByRequestId'
            and aur.resource_type = 'REQUEST'
            and aur.handler = 'requestAccessHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getRequestActionsByRequestId')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST'
	                and handler = 'requestAccessHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_CREATE_REQUEST_TASK_VIEW_RULE_ENTRY_FOR_VERIFIER" author="P35066">
        <comment>Create request task view rule entry for verifier</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskViewHandler', 'VERIFIER');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and handler = 'requestTaskViewHandler'
                and role_type = 'VERIFIER'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getItemTaskInfo_SERVICE_WITH_REQUEST_TASK_VIEW_VERIFIER_RULE" author="P35066">
        <comment>Associate getItemTaskInfo service with request task view rule for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getItemTaskInfo'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskViewHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getItemTaskInfo')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
	                and handler = 'requestTaskViewHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getTaskItemInfoById_SERVICE_WITH_REQUEST_ACCESS_VERIFIER_RULE" author="P35066">
        <comment>Associate getTaskItemInfoById service with request access rule for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskViewHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getTaskItemInfoById')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
	                and handler = 'requestTaskViewHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_CREATE_REQUEST_VIEW_RULE_ENTRY_FOR_VERIFIER" author="P35066">
        <comment>Create request view rule entry for verifier</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST' , 'requestViewHandler', 'VERIFIER');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST'
                and handler = 'requestViewHandler'
                and role_type = 'VERIFIER'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getItemRequestInfo_SERVICE_WITH_REQUEST_VIEW_VERIFIER_RULE" author="P35066">
        <comment>Associate getItemRequestInfo service with request view rule for verifier</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getItemRequestInfo'
            and aur.resource_type = 'REQUEST'
            and aur.handler = 'requestViewHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getItemRequestInfo')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST'
	                and handler = 'requestViewHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_REMOVE_DUPLICATE_OPERATOR_ACCOUNT_ACCESS_HANDLER_ENTRIES_FROM_AU_RULE_TABLE" author="P35066">
        <comment>Delete dupe operator account access handler entries from au_rule table</comment>
        <sql>
            update au_service_rule
			set rule_id = (
			select min(id)
						   from au_rule where resource_type = 'ACCOUNT'
						   and resource_sub_type is null
						   and handler = 'accountAccessHandler'
						   and role_type = 'OPERATOR'
						   and scope is null
			)
			where service_id = (select id from au_service where name = 'getAccountOperatorAuthorities')
			and rule_id = (select max(id)
						   from au_rule where resource_type = 'ACCOUNT'
						   and resource_sub_type is null
						   and handler = 'accountAccessHandler'
						   and role_type = 'OPERATOR'
						   and scope is null);

			DELETE FROM au_rule
			WHERE id in
			(select id from (
			  SELECT id,
			  ROW_NUMBER() OVER(PARTITION BY resource_type, resource_sub_type, handler, role_type, scope ORDER BY id asc) AS row_num
			  FROM au_rule
			  where resource_type = 'ACCOUNT'
			  and resource_sub_type is null
			  and handler = 'accountAccessHandler'
			  and role_type = 'OPERATOR'
			  and scope is null
			) dups
			where dups.row_num > 1);
        </sql>
     </changeSet>

     <changeSet id="0_1_0_REMOVE_DUPLICATE_REGULATOR_ACCOUNT_ACCESS_HANDLER_ENTRIES_FROM_AU_RULE_TABLE" author="P35066">
        <comment>Delete dupe regulator account access handler entries from au_rule table</comment>
        <sql>
            update au_service_rule
			set rule_id = (
			select min(id)
						   from au_rule where resource_type = 'ACCOUNT'
						   and resource_sub_type is null
						   and handler = 'accountAccessHandler'
						   and role_type = 'REGULATOR'
						   and scope is null
			)
			where service_id = (select id from au_service where name = 'getAccountOperatorAuthorities')
			and rule_id = (select max(id)
						   from au_rule where resource_type = 'ACCOUNT'
						   and resource_sub_type is null
						   and handler = 'accountAccessHandler'
						   and role_type = 'REGULATOR'
						   and scope is null);

			DELETE FROM au_rule
			WHERE id in
			(select id from (
			  SELECT id,
			  ROW_NUMBER() OVER(PARTITION BY resource_type, resource_sub_type, handler, role_type, scope ORDER BY id asc) AS row_num
			  FROM au_rule
			  where resource_type = 'ACCOUNT'
			  and resource_sub_type is null
			  and handler = 'accountAccessHandler'
			  and role_type = 'REGULATOR'
			  and scope is null
			) dups
			where dups.row_num > 1);
        </sql>
     </changeSet>

    <changeSet id="0_1_0_POPULATE_MANAGE_VB_SCOPE_WITH_PERM_VB_MANAGE_PERMISSION" author="P70383">
        <comment>Populate MANAGE_VB SCOPE for CA resource type with PERM_VB_MANAGE permission</comment>
        <sql>
            insert into au_resource_scope_permission(id, resource_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 'CA', 'MANAGE_VB', 'PERM_VB_MANAGE');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'CA' and scope = 'MANAGE_VB' and permission = 'PERM_VB_MANAGE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_CREATE_NEW_VERIFICATION_BODY_INSTALLATION_REQUEST_TASK_RULE_ENTRY_FOR_VERIFIER" author="P35066">
        <comment>Create rule for request task of type new_verification_body_installation for verifier role type</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'NEW_VERIFICATION_BODY_INSTALLATION', 'requestTaskExecuteAccessHandler', 'VERIFIER');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
                and handler = 'requestTaskExecuteAccessHandler'
                and role_type = 'VERIFIER'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_processRequestTaskAction_SERVICE_WITH_NEW_VERIFICATION_BODY_INSTALLATION_REQUEST_TASK_RULE" author="P35066">
        <comment>Associate processRequestTaskAction service with request task of type new_verification_body_installation rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'processRequestTaskAction')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_assignTask_SERVICE_WITH_NEW_VERIFICATION_BODY_INSTALLATION_REQUEST_TASK_RULE" author="P35066">
        <comment>Associate assignTask service with request task of type new_verification_body_installation rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getCandidateAssignees_SERVICE_WITH_NEW_VERIFICATION_BODY_INSTALLATION_REQUEST_TASK_RULE" author="P35066">
        <comment>Associate getCandidateAssignees service with request task of type new_verification_body_installation rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssignees')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_CREATE_NEW_VERIFICATION_BODY_INSTALLATION_SYSTEM_MESSAGE_RULE_ENTRY_FOR_VERIFIER" author="P35066">
        <comment>Create rule for system message of type new_verification_body_installation for verifier role type</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE' , 'NEW_VERIFICATION_BODY_INSTALLATION', 'notificationSystemMessageAccessHandler', 'VERIFIER');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'SYSTEM_MESSAGE'
                and resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
                and handler = 'notificationSystemMessageAccessHandler'
                and role_type = 'VERIFIER'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getNotificationSystemMessageById_SERVICE_WITH_NEW_VERIFICATION_BODY_INSTALLATION_MESSAGE_RULE" author="P35066">
        <comment>Associate getNotificationSystemMessageById service with system message of type new_verification_body_installation rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getNotificationSystemMessageById'
            and aur.resource_type = 'SYSTEM_MESSAGE'
            and aur.resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
            and aur.handler = 'notificationSystemMessageAccessHandler'
            and aur.role_type = 'VERIFIER'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getNotificationSystemMessageById')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'SYSTEM_MESSAGE'
                	and resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
	                and handler = 'notificationSystemMessageAccessHandler'
	                and role_type = 'VERIFIER'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateVbSiteContacts_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate updateVbSiteContacts service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateVbSiteContacts');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateVbSiteContacts'
            and aur.resource_type = 'VERIFICATION_BODY'
            and aur.handler = 'verificationBodyAccessHandler'
            and aur.scope = 'EDIT_USER';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateVbSiteContacts');

                delete
                from au_service
                where name = 'updateVbSiteContacts';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getVerificationBodyOfAccount_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Populate getVerificationBodyOfAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getVerificationBodyOfAccount');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getVerificationBodyOfAccount'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'REGULATOR';
            
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getVerificationBodyOfAccount'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getVerificationBodyOfAccount');

                delete
                from au_service
                where name = 'getVerificationBodyOfAccount';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_getActiveVerificationBodies_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Populate getActiveVerificationBodies service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getActiveVerificationBodies');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getActiveVerificationBodies'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope = 'EDIT_USER'
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getActiveVerificationBodies');

                delete
                from au_service
                where name = 'getActiveVerificationBodies';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_POPULATE_appointVerificationBodyToAccount_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Populate appointVerificationBodyToAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'appointVerificationBodyToAccount');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'appointVerificationBodyToAccount'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope = 'EDIT_USER'
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'appointVerificationBodyToAccount');

                delete
                from au_service
                where name = 'appointVerificationBodyToAccount';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_CA_MANAGE_VB_ACCESS_RULE_FOR_REGULATOR" author="pafilisa@unisystems.gr">
        <comment>Create rule manage verification body for regulator role type</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'CA' , 'caAccessHandler', 'REGULATOR', 'MANAGE_VB');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'CA'
                and handler = 'caAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'MANAGE_VB'
                and resource_sub_type is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_createVerificationBody_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate createVerificationBody service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'createVerificationBody');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'createVerificationBody'
            and aur.resource_type = 'CA'
            and aur.handler = 'caAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'MANAGE_VB'
            and aur.resource_sub_type is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'createVerificationBody')
                and rule_id = (
                select id from au_rule
                where resource_type = 'CA'
                and handler = 'caAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'MANAGE_VB'
                and resource_sub_type is null
                );

                delete
                from au_service
                where name = 'createVerificationBody';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getVerifierAuthoritiesByVerificationBodyId_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getVerifierAuthoritiesByVerificationBodyId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getVerifierAuthoritiesByVerificationBodyId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getVerifierAuthoritiesByVerificationBodyId'
            and aur.resource_type = 'CA'
            and aur.handler = 'caAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'MANAGE_VB';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getVerifierAuthoritiesByVerificationBodyId');

                delete
                from au_service
                where name = 'getVerifierAuthoritiesByVerificationBodyId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_inviteVerifierAdminUserByVerificationBodyId_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate inviteVerifierAdminUserByVerificationBodyId auth service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'inviteVerifierAdminUserByVerificationBodyId');

            insert into au_service_rule(service_id, rule_id)
            values(
            (select s.id from au_service s where s.name = 'inviteVerifierAdminUserByVerificationBodyId'),
            (select r.id from au_rule r
            where r.resource_type = 'CA'
            and r.handler = 'caAccessHandler'
            and r.scope = 'MANAGE_VB'
            and r.role_type = 'REGULATOR')
            );
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'inviteVerifierAdminUserByVerificationBodyId');
                delete from au_service where name = 'inviteVerifierAdminUserByVerificationBodyId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteVerifierAuthority_AUTHORIZATION_SERVICE_AND_ASSIGN_TO_PERM_VB_USERS_EDIT_RULE" author="P70366">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteVerifierAuthority');

            insert into au_service_rule(service_id, rule_id)
            values(
            (select s.id from au_service s where s.name = 'deleteVerifierAuthority'),
            (select r.id from au_rule r
            where r.resource_type = 'VERIFICATION_BODY'
            and r.handler = 'verificationBodyAccessHandler'
            and r.scope = 'EDIT_USER'
            and r.role_type = 'VERIFIER')
            );
        </sql>

        <rollback>
            <sql>
                delete from au_service_rule
                where service_id = (select id from au_service where name = 'deleteVerifierAuthority');

                delete from au_service where name = 'deleteVerifierAuthority';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteCurrentVerifierAuthority_AUTHORIZATION_SERVICE_AND_ASSIGN_TO_PERM_VB_USERS_EDIT_RULE" author="P70366">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteCurrentVerifierAuthority');

            insert into au_service_rule(service_id, rule_id)
            values(
            (select s.id from au_service s where s.name = 'deleteCurrentVerifierAuthority'),
            (select r.id from au_rule r
            where r.resource_type = 'VERIFICATION_BODY'
            and r.handler = 'verificationBodyAccessHandler'
            and r.scope = 'EDIT_USER'
            and r.role_type = 'VERIFIER')
            );
        </sql>

        <rollback>
            <sql>
                delete from au_service_rule
                where service_id = (select id from au_service where name = 'deleteCurrentVerifierAuthority');

                delete from au_service where name = 'deleteCurrentVerifierAuthority';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_CREATE_VERIFIER_NO_LONGER_AVAILABLE_REQUEST_TASK_RULE_ENTRY_FOR_VERIFIER" author="P35066">
        <comment>Create rule for request task of type verifier_no_longer_available for operator role type</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'VERIFIER_NO_LONGER_AVAILABLE', 'requestTaskExecuteAccessHandler', 'OPERATOR');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
                and handler = 'requestTaskExecuteAccessHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_processRequestTaskAction_SERVICE_WITH_VERIFIER_NO_LONGER_AVAILABLE_REQUEST_TASK_RULE" author="P35066">
        <comment>Associate processRequestTaskAction service with request task of type verifier_no_longer_available rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'processRequestTaskAction')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'OPERATOR'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_assignTask_SERVICE_WITH_VERIFIER_NO_LONGER_AVAILABLE_REQUEST_TASK_RULE" author="P35066">
        <comment>Associate assignTask service with request task of type verifier_no_longer_available rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'OPERATOR'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getCandidateAssignees_SERVICE_WITH_VERIFIER_NO_LONGER_AVAILABLE_REQUEST_TASK_RULE" author="P35066">
        <comment>Associate getCandidateAssignees service with request task of type verifier_no_longer_available rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssignees')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'OPERATOR'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_CREATE_VERIFIER_NO_LONGER_AVAILABLE_SYSTEM_MESSAGE_RULE_ENTRY_FOR_OPERATOR" author="P35066">
        <comment>Create rule for system message of type verifier_no_longer_available for operator role type</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE' , 'VERIFIER_NO_LONGER_AVAILABLE', 'notificationSystemMessageAccessHandler', 'OPERATOR');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'SYSTEM_MESSAGE'
                and resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
                and handler = 'notificationSystemMessageAccessHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_ASSOCIATE_getNotificationSystemMessageById_SERVICE_WITH_VERIFIER_NO_LONGER_AVAILABLE_MESSAGE_RULE" author="P35066">
        <comment>Associate getNotificationSystemMessageById service with system message of type verifier_no_longer_available rule</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getNotificationSystemMessageById'
            and aur.resource_type = 'SYSTEM_MESSAGE'
            and aur.resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
            and aur.handler = 'notificationSystemMessageAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getNotificationSystemMessageById')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'SYSTEM_MESSAGE'
                	and resource_sub_type = 'VERIFIER_NO_LONGER_AVAILABLE'
	                and handler = 'notificationSystemMessageAccessHandler'
	                and role_type = 'OPERATOR'
	                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getVerificationBodyById_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Populate getVerificationBodyById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getVerificationBodyById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getVerificationBodyById'
            and aur.resource_type = 'CA'
            and aur.resource_sub_type is null
            and aur.handler = 'caAccessHandler'
            and aur.scope = 'MANAGE_VB'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getVerificationBodyById');

                delete
                from au_service
                where name = 'getVerificationBodyById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateVerificationBody_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Populate updateVerificationBody service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateVerificationBody');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateVerificationBody'
            and aur.resource_type = 'CA'
            and aur.resource_sub_type is null
            and aur.handler = 'caAccessHandler'
            and aur.scope = 'MANAGE_VB'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateVerificationBody');

                delete
                from au_service
                where name = 'updateVerificationBody';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REF_OBJECT_RULE" author="P70383">
        <comment>Create rule for REF_OBJECT resource type for all kind of users</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REF_OBJECT' , 'ACCOUNT', 'requestObjectAccessHandler', 'OPERATOR'),
            (nextval('au_rule_seq'), 'REF_OBJECT' , 'ACCOUNT', 'requestObjectAccessHandler', 'REGULATOR'),
            (nextval('au_rule_seq'), 'REF_OBJECT' , 'MESSAGE_NOTIFICATION', 'requestObjectAccessHandler', 'OPERATOR'),
            (nextval('au_rule_seq'), 'REF_OBJECT' , 'MESSAGE_NOTIFICATION', 'requestObjectAccessHandler', 'REGULATOR'),
            (nextval('au_rule_seq'), 'REF_OBJECT' , 'MESSAGE_NOTIFICATION', 'requestObjectAccessHandler', 'VERIFIER');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'REF_OBJECT';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRequestActionsByRefObjectIdAndRefObjectType_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getRequestActionsByRefObjectIdAndRefObjectType auth service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRequestActionsByRefObjectIdAndRefObjectType');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getRequestActionsByRefObjectIdAndRefObjectType' and aur.resource_type = 'REF_OBJECT' and aur.handler = 'requestObjectAccessHandler';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRequestActionsByRefObjectIdAndRefObjectType');
                delete from au_service where name = 'getRequestActionsByRefObjectIdAndRefObjectType';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateVerificationBodiesStatus_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate updateVerificationBodiesStatus service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateVerificationBodiesStatus');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateVerificationBodiesStatus'
            and aur.resource_type = 'CA'
            and aur.resource_sub_type is null
            and aur.handler = 'caAccessHandler'
            and aur.scope = 'MANAGE_VB'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'updateVerificationBodiesStatus');
                delete from au_service where name = 'updateVerificationBodiesStatus';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_deleteVerificationBodyById_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate deleteVerificationBodyById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'deleteVerificationBodyById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'deleteVerificationBodyById'
            and aur.resource_type = 'CA'
            and aur.resource_sub_type is null
            and aur.handler = 'caAccessHandler'
            and aur.scope = 'MANAGE_VB'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'deleteVerificationBodyById');
                delete from au_service where name = 'deleteVerificationBodyById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_replaceVerificationBodyToAccount_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate replaceVerificationBodyToAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'replaceVerificationBodyToAccount');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'replaceVerificationBodyToAccount'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope = 'EDIT_USER'
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'replaceVerificationBodyToAccount');

                delete
                from au_service
                where name = 'replaceVerificationBodyToAccount';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_PERMIT_ACCESS_RULE" author="p70366">
        <comment>Populate permit access rule</comment>
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'PERMIT' , 'permitAccessHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'PERMIT' , 'permitAccessHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'PERMIT' and handler = 'permitAccessHandler' and role_type = 'OPERATOR' and scope is null;
                delete from au_rule where resource_type = 'PERMIT' and handler = 'permitAccessHandler' and role_type = 'REGULATOR' and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getPermitById_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate getPermitById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getPermitById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getPermitById' and aur.resource_type = 'PERMIT' and aur.handler = 'permitAccessHandler' and scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getPermitById');
                delete from au_service where name = 'getPermitById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REF_OBJECT_RULE_PERMIT" author="p70366">
        <comment>Create rule for REF_OBJECT resource type and PERMIT resource subtype</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REF_OBJECT' , 'PERMIT', 'requestObjectAccessHandler', 'OPERATOR'),
            (nextval('au_rule_seq'), 'REF_OBJECT' , 'PERMIT', 'requestObjectAccessHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule where resource_type = 'REF_OBJECT' and resource_sub_type = 'PERMIT';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRequestActionsByRefObjectIdAndRefObjectType_permit_AUTHORIZATION_SERVICE" author="p70366">
        <comment>Populate getRequestActionsByRefObjectIdAndRefObjectType auth service</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getRequestActionsByRefObjectIdAndRefObjectType'
            and aur.resource_type = 'REF_OBJECT'
            and aur.resource_sub_type = 'PERMIT'
            and aur.handler = 'requestObjectAccessHandler';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule
                where service_id = (select id from au_service aus where aus.name = 'getRequestActionsByRefObjectIdAndRefObjectType')
                and rule_id in (select id from au_rule aur where aur.resource_type = 'REF_OBJECT'
                and aur.resource_sub_type = 'PERMIT'
                and aur.handler = 'requestObjectAccessHandler');
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_CREATE_uploadRequestTaskAttachment_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Populate uploadRequestTaskAttachment service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'uploadRequestTaskAttachment');
        </sql>
        <rollback>
            <sql>
                delete from au_service where name = 'uploadRequestTaskAttachment';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_ASSOCIATE_uploadRequestTaskAttachment_AUTHORIZATION_SERVICE_with_PERMIT_ISSUANCE_APPLICATION_SUBMIT_rule" author="P35066">
        <comment>Associate uploadRequestTaskAttachment service with the PERMIT_ISSUANCE_APPLICATION_SUBMIT rule for operator role for scope execute</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id 
            from au_service aus 
            cross join au_rule aur 
            where aus.name = 'uploadRequestTaskAttachment' 
            and aur.resource_type = 'REQUEST_TASK' 
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMIT' 
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'OPERATOR' 
            and aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule 
                where 
                service_id = (select id from au_service where name = 'uploadRequestTaskAttachment')
                and rule_id = (
                	select id from au_rule 
                	where 
                	resource_type = 'REQUEST_TASK'
		            and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMIT' 
		            and handler = 'requestTaskExecuteAccessHandler'
		            and role_type = 'OPERATOR'
		            and scope = 'REQUEST_TASK_EXECUTE'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_REQUEST_ACTION_VIEW_AUTHORIZATION_RULE_FOR_OPERATOR_ROLE_TYPE" author="pafilisa@unisystems.gr">
        <comment>Populate request action view authorization rule for OPERATOR role code</comment>

        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'requestActionViewHandler', 'OPERATOR');
        </sql>

        <rollback>
            <sql>
                delete
                  from au_rule
                 where resource_type = 'REQUEST_ACTION'
                   and handler = 'requestActionViewHandler'
                   and role_type = 'OPERATOR'
                   and resource_sub_type is null
                   and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_CREATE_downloadRequestActionFileAttachment_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate downloadRequestActionFileAttachment authorization service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'downloadRequestActionFileAttachment');
        </sql>
        <rollback>
            <sql>
                delete
                  from au_service
                 where name = 'downloadRequestActionFileAttachment';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_ASSOCIATE_downloadRequestActionFileAttachment_AUTHORIZATION_SERVICE_with_request_action_AUTHORIZATION_RULE" author="pafilisa@unisystems.gr">
        <comment>Associate downloadRequestActionFileAttachment authorization service with the REQUEST_ACTION authorization rule for OPERATOR role type</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'downloadRequestActionFileAttachment'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'OPERATOR'
            and aur.resource_sub_type is null
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule
                where
                service_id = (select id from au_service where name = 'downloadRequestActionFileAttachment')
                and rule_id = (
                select id from au_rule
                where
                resource_type = 'REQUEST_ACTION'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and resource_sub_type is null
                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_CREATE_getPermitAttachment_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Create getPermitAttachment authorization service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getPermitAttachment');
        </sql>
        <rollback>
            <sql>
                delete from au_service where name = 'getPermitAttachment';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_ASSOCIATE_getPermitAttachment_AUTHORIZATION_SERVICE_with_permit_resource_type_rule" author="P35066">
        <comment>Associate getPermitAttachment service with the rules related to the PERMIT resource type</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur 
            where
            aus.name = 'getPermitAttachment' 
            and aur.resource_type = 'PERMIT'
            and aur.resource_sub_type is null
            and aur.handler = 'permitAccessHandler' 
            and scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule 
                where 
                service_id = (select id from au_service where name = 'getPermitAttachment')
                and rule_id in (
                	select id from au_rule 
                	where 
                	resource_type = 'PERMIT'
		            and resource_sub_type is null 
		            and handler = 'permitAccessHandler'
		            and scope is null
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_REMOVE_UNNECESSARY_SERVICE_RULE_updateAccountOperatorAuthorities" author="P70453">
        <comment>REMOVE UNNECESSARY SERVICE RULE updateAccountOperatorAuthorities for roles different than OPERATOR</comment>
        <sql>
            delete from au_service_rule
            where
            service_id = (select id from au_service where name = 'updateAccountOperatorAuthorities')
            and rule_id in (
            select id from au_rule
            where
            role_type != 'OPERATOR'
            );
        </sql>
    </changeSet>
    <changeSet id="0_1_0_REMOVE_UNNECESSARY_SERVICE_RULE_updateOperatorUserById" author="P70453">
        <comment>REMOVE UNNECESSARY SERVICE RULE updateOperatorUserById for roles different than OPERATOR</comment>
        <sql>
            delete from au_service_rule
            where
            service_id = (select id from au_service where name = 'updateOperatorUserById')
            and rule_id in (
            select id from au_rule
            where
            role_type != 'OPERATOR'
            );
        </sql>
    </changeSet>
    
    <changeSet id="0_1_0_RENAME_downloadRequestActionFileAttachment_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Rename downloadRequestActionFileAttachment to generateRequestActionGetFileAttachmentToken</comment>
        <sql>
            update au_service set name= 'generateRequestActionGetFileAttachmentToken'
            where name = 'downloadRequestActionFileAttachment';
        </sql>
        <rollback>
            <sql>
                update au_service set name= 'downloadRequestActionFileAttachment'
                where name = 'generateRequestActionGetFileAttachmentToken';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_RENAME_getPermitAttachment_AUTHORIZATION_SERVICE" author="P35066">
        <comment>Rename getPermitAttachment to generateGetPermitAttachmentToken</comment>
        <sql>
            update au_service set name= 'generateGetPermitAttachmentToken'
            where name = 'getPermitAttachment';
        </sql>
        <rollback>
            <sql>
                update au_service set name= 'getPermitAttachment'
                where name = 'generateGetPermitAttachmentToken';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW', 
            	'REQUEST_TASK_VIEW', 
            	'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW' 
                and scope = 'REQUEST_TASK_VIEW' 
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            	'REQUEST_TASK' , 
            	'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW', 
            	'requestTaskExecuteAccessHandler', 
            	'OPERATOR', 
            	'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW'
                and handler = 'requestTaskExecuteAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_assignTask_service_with_PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW_view_scope_for_operator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'OPERATOR'
	                and scope = 'REQUEST_TASK_VIEW'
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_getCandidateAssignees_service_with_PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW_view_scope_for_operator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssignees')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'OPERATOR'
	                and scope = 'REQUEST_TASK_VIEW'
                );
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_ISSUANCE_APPLICATION_REVIEW_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_ISSUANCE_APPLICATION_REVIEW', 
            	'REQUEST_TASK_VIEW', 
            	'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW' 
                and scope = 'REQUEST_TASK_VIEW' 
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_ISSUANCE_APPLICATION_REVIEW_and_role_REGULATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            	'REQUEST_TASK' , 
            	'PERMIT_ISSUANCE_APPLICATION_REVIEW', 
            	'requestTaskExecuteAccessHandler', 
            	'REGULATOR', 
            	'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
                and handler = 'requestTaskExecuteAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_assignTask_service_with_PERMIT_ISSUANCE_APPLICATION_REVIEW_view_scope_for_regulator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'REGULATOR'
	                and scope = 'REQUEST_TASK_VIEW'
                );
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_getCandidateAssignees_service_with_PERMIT_ISSUANCE_APPLICATION_REVIEW_view_scope_for_regulator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssignees'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssignees')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'REGULATOR'
	                and scope = 'REQUEST_TASK_VIEW'
                );
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_ISSUANCE_APPLICATION_REVIEW_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_ISSUANCE_APPLICATION_REVIEW', 
            	'REQUEST_TASK_EXECUTE', 
            	'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW' 
                and scope = 'REQUEST_TASK_EXECUTE' 
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_ISSUANCE_APPLICATION_REVIEW_and_role_REGULATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            'REQUEST_TASK' , 
            'PERMIT_ISSUANCE_APPLICATION_REVIEW', 
            'requestTaskExecuteAccessHandler', 
            'REGULATOR', 
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
                and handler = 'requestTaskExecuteAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_processRequestTaskAction_service_with_PERMIT_ISSUANCE_APPLICATION_REVIEW_execute_scope_for_regulator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
            and aur.handler = 'requestTaskExecuteAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'processRequestTaskAction')
                and rule_id = (
                	select id from au_rule
                	where resource_type = 'REQUEST_TASK'
                	and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
	                and handler = 'requestTaskExecuteAccessHandler'
	                and role_type = 'REGULATOR'
	                and scope = 'REQUEST_TASK_EXECUTE'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION', 
            	'requestActionViewHandler', 
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION', 
            	'requestActionViewHandler', 
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION', 
            	'requestActionViewHandler', 
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION', 
            	'requestActionViewHandler', 
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION', 
            	'requestActionViewHandler', 
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION', 
            	'requestActionViewHandler', 
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_APPLY_SAVE_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'PERMIT_APPLY_SAVE', 
            	'requestActionViewHandler', 
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_APPLY_SAVE'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_APPLY_SUBMIT_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'PERMIT_APPLY_SUBMIT', 
            	'requestActionViewHandler', 
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_APPLY_SUBMIT'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_APPLY_SUBMIT_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'PERMIT_APPLY_SUBMIT', 
            	'requestActionViewHandler', 
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_APPLY_SUBMIT'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_delete_generic_REQUEST_ACTION_rule_with_no_specific_action_type" author="P35066">
        <sql>
            delete from au_service_rule sr
            using au_rule r
            where r.id = sr.rule_id
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type is null
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;
            
            delete from au_rule r
            where r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type is null
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, handler, role_type)
            	values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'requestActionViewHandler', 'OPERATOR');

                insert into au_service_rule(service_id, rule_id)
	            select aus.id, aur.id
	            from au_service aus
	            cross join au_rule aur
	            where aus.name = 'generateRequestActionGetFileAttachmentToken'
	            and aur.resource_type = 'REQUEST_ACTION'
	            and aur.handler = 'requestActionViewHandler'
	            and aur.role_type = 'OPERATOR'
	            and aur.resource_sub_type is null
	            and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_generateGetPermitAttachmentToken_service_with_request_action_type_PERMIT_APPLY_SAVE_for_role_OPERATOR" author="P35066">
        <sql>
        	insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileAttachmentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_APPLY_SAVE'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
	            using 
	            	au_rule r,
	            	au_service s
	            where r.id = sr.rule_id
	            and s.id = sr.service_id
	            and r.resource_type = 'REQUEST_ACTION'
	            and r.resource_sub_type = 'PERMIT_APPLY_SAVE'
	            and r.handler = 'requestActionViewHandler'
	            and r.role_type = 'OPERATOR'
	            and r.scope is null
	            and s.name = 'generateRequestActionGetFileAttachmentToken';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_auth_service_getRequestActionById" author="P35066">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRequestActionById');
        </sql>
        <rollback>
            <sql>
                delete from au_service where name = 'getRequestActionById';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_related_rules" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus 
            cross join au_rule aur 
            where
            aus.name = 'getRequestActionById' 
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type in (
            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION', 
            	'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION', 
            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION', 
            	'PERMIT_APPLY_SAVE', 
            	'PERMIT_APPLY_SUBMIT')
            and aur.handler = 'requestActionViewHandler' 
            and scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
	            using 
	            	au_rule r,
	            	au_service s
	            where r.id = sr.rule_id
	            and s.id = sr.service_id 
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type in (
	            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION', 
	            	'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION', 
	            	'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION', 
	            	'PERMIT_APPLY_SAVE', 
	            	'PERMIT_APPLY_SUBMIT')
		        and r.handler = 'requestActionViewHandler'
		        and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_getItemRequestInfo_authorization_service" author="pafilisa@unisystems.gr">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getItemRequestInfo';</sqlCheck>
        </preConditions>
        <comment>Delete getItemRequestInfo service</comment>
        <sql>
            delete
              from au_service_rule
             where service_id = (select id from au_service where name = 'getItemRequestInfo');

            delete
              from au_service
             where name = 'getItemRequestInfo';
        </sql>
        <rollback>
            <sql>
                insert into au_service(id, name)
                values (nextval('au_service_seq'), 'getItemRequestInfo');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where (
                aus.name = 'getItemRequestInfo'
                and aur.resource_type = 'REQUEST'
                and aur.resource_sub_type is null
                and aur.handler = 'requestViewHandler'
                and scope is null
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_requestTaskViewHandler_rules" author="pafilisa@unisystems.gr">
        <sql>
            delete from au_service_rule sr
            using au_rule r
            where r.id = sr.rule_id
            and r.resource_type = 'REQUEST_TASK'
            and r.handler = 'requestTaskViewHandler';

            delete from au_rule r
            where r.resource_type = 'REQUEST_TASK'
            and r.handler = 'requestTaskViewHandler';
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskViewHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskViewHandler', 'REGULATOR');

                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'requestTaskViewHandler', 'VERIFIER');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name in ('getItemTaskInfo', 'getTaskItemInfoById')
                and aur.resource_type = 'REQUEST_TASK'
                and aur.handler = 'requestTaskViewHandler'
                and aur.role_type in ('OPERATOR', 'REGULATOR', 'VERIFIER')
                and aur.resource_sub_type is null
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_update_au_rule_rename_requestTaskAccessHandler_to_requestTaskAssignAccessHandler" author="pafilisa@unisystems.gr">
        <sql>
            update au_rule
               set handler = 'requestTaskAssignAccessHandler'
             where handler = 'requestTaskAccessHandler';
        </sql>
        <rollback>
            <sql>
                update au_rule
                   set handler = 'requestTaskAccessHandler'
                 where handler = 'requestTaskAssignAccessHandler';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_update_au_rule_rename_requestTaskExecuteAccessHandler_to_requestTaskAccessHandler" author="pafilisa@unisystems.gr">
        <sql>
            update au_rule
               set handler = 'requestTaskAccessHandler'
             where handler = 'requestTaskExecuteAccessHandler';
        </sql>
        <rollback>
            <sql>
                update au_rule
                   set handler = 'requestTaskExecuteAccessHandler'
                 where handler = 'requestTaskAccessHandler';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getTaskItemInfoById_service_with_request_task_related_rules" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and (aur.scope = 'REQUEST_TASK_VIEW' or aur.scope is null)
            and aur.resource_sub_type in (
                'INSTALLATION_ACCOUNT_OPENING_ARCHIVE',
                'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW',
                'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW',
                'PERMIT_ISSUANCE_APPLICATION_SUBMIT',
                'PERMIT_ISSUANCE_APPLICATION_REVIEW',
                'ACCOUNT_USERS_SETUP',
                'NEW_USER_CONFIRMED',
                'VERIFIER_NO_LONGER_AVAILABLE',
                'NEW_VERIFICATION_BODY_INSTALLATION'
            );
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getTaskItemInfoById'
                and r.resource_type = 'REQUEST_TASK'
                and r.handler = 'requestTaskAccessHandler'
                and (r.scope = 'REQUEST_TASK_VIEW' or r.scope is null)
                and r.resource_sub_type in (
                'INSTALLATION_ACCOUNT_OPENING_ARCHIVE',
                'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW',
                'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW',
                'PERMIT_ISSUANCE_APPLICATION_SUBMIT',
                'PERMIT_ISSUANCE_APPLICATION_REVIEW',
                'ACCOUNT_USERS_SETUP',
                'NEW_USER_CONFIRMED',
                'VERIFIER_NO_LONGER_AVAILABLE',
                'NEW_VERIFICATION_BODY_INSTALLATION'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getItemTaskInfo_service_with_request_task_related_rules" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getItemTaskInfo'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.handler = 'requestTaskAccessHandler'
            and (aur.scope = 'REQUEST_TASK_VIEW' or aur.scope is null)
            and aur.resource_sub_type in (
                'INSTALLATION_ACCOUNT_OPENING_ARCHIVE',
                'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW',
                'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW',
                'PERMIT_ISSUANCE_APPLICATION_SUBMIT',
                'PERMIT_ISSUANCE_APPLICATION_REVIEW',
                'ACCOUNT_USERS_SETUP',
                'NEW_USER_CONFIRMED',
                'VERIFIER_NO_LONGER_AVAILABLE',
                'NEW_VERIFICATION_BODY_INSTALLATION'
            );
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getItemTaskInfo'
                and r.resource_type = 'REQUEST_TASK'
                and r.handler = 'requestTaskAccessHandler'
                and (r.scope = 'REQUEST_TASK_VIEW' or r.scope is null)
                and r.resource_sub_type in (
                    'INSTALLATION_ACCOUNT_OPENING_ARCHIVE',
                    'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW',
                    'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW',
                    'PERMIT_ISSUANCE_APPLICATION_SUBMIT',
                    'PERMIT_ISSUANCE_APPLICATION_REVIEW',
                    'ACCOUNT_USERS_SETUP',
                    'NEW_USER_CONFIRMED',
                    'VERIFIER_NO_LONGER_AVAILABLE',
                    'NEW_VERIFICATION_BODY_INSTALLATION'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_requestViewHandler_rules" author="pafilisa@unisystems.gr">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="0">
                select count( distinct s.id)
                  from au_service_rule sr,
                       au_rule r,
                       au_service s
                 where r.id = sr.rule_id
                   and s.id = sr.service_id
                   and r.resource_type = 'REQUEST'
                   and r.handler = 'requestViewHandler';
            </sqlCheck>
        </preConditions>
        <sql>
            delete
              from au_rule r
             where r.resource_type = 'REQUEST'
               and r.handler = 'requestViewHandler';
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST' , 'requestViewHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST' , 'requestViewHandler', 'REGULATOR');

                insert into au_rule(id, resource_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST' , 'requestViewHandler', 'VERIFIER');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_REVIEW_SAVE_for_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_REVIEW_SAVE', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                  from au_rule
                 where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVIEW_SAVE'
                  and handler = 'requestActionViewHandler'
                  and role_type = 'REGULATOR'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_generateGetPermitAttachmentToken_service_with_request_action_type_PERMIT_REVIEW_SAVE_for_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileAttachmentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_REVIEW_SAVE'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'REGULATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_REVIEW_SAVE'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'REGULATOR'
                and r.scope is null
                and s.name = 'generateRequestActionGetFileAttachmentToken';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_releaseTask_service_with_missing_rules_from_assignTask" author="P70453">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, ausr.rule_id
            from au_service aus cross join au_service_rule ausr
            where aus.name = 'releaseTask' and ausr.service_id = (select id from au_service where name='assignTask')
            and ausr.rule_id not in (select rule_id from au_service_rule  where service_id = (select id from au_service where name='releaseTask'));
        </sql>
        <rollback></rollback>
    </changeSet>

    
    <changeSet id="0_1_0_remove_association_of_getOperatorUserById_for_REGULATOR" author="P70453">
        <sql>
            delete from au_service_rule sr
            using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and r.role_type = 'REGULATOR'
            and s.name = 'getOperatorUserById';
        </sql>
        <rollback></rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_association_of_getOperatorRoleCodes_for_REGULATOR" author="P70453">
        <sql>
            delete from au_service_rule sr
            using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and r.role_type = 'REGULATOR'
            and s.name = 'getOperatorRoleCodes';
        </sql>
        <rollback></rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_auth_rule_for_deprecated_request_action_INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION" author="pafilisa@unisystems.gr">
        <comment>Delete authorization rule entry with resource type REQUEST_ACTION and resource sub type INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION</comment>
        <sql>
            delete from au_service_rule
            where rule_id in (select id
                                from au_rule
                                where resource_type = 'REQUEST_ACTION'
                                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION'
                                and handler = 'requestActionViewHandler'
                                and scope is null);

    
            delete
            from au_rule
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION'
            and handler = 'requestActionViewHandler'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION', 'requestActionViewHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION', 'requestActionViewHandler', 'REGULATOR');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus cross join au_rule aur
                where aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_AMEND_APPLICATION'
                and aur.handler = 'requestActionViewHandler'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_auth_rule_for_deprecated_request_action_INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION" author="pafilisa@unisystems.gr">
        <comment>Delete authorization rule entry with resource type REQUEST_ACTION and resource sub type INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION</comment>
        <sql>
            delete from au_service_rule
            where rule_id in (select id
            from au_rule
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION'
            and handler = 'requestActionViewHandler'
            and scope is null);

            delete
            from au_rule
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION'
            and handler = 'requestActionViewHandler'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION', 'requestActionViewHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION', 'requestActionViewHandler', 'REGULATOR');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus cross join au_rule aur
                where aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_DECISION'
                and aur.handler = 'requestActionViewHandler'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_auth_rule_for_deprecated_request_action_PERMIT_APPLY_SAVE" author="pafilisa@unisystems.gr">
        <comment>Delete authorization rule entry with resource type REQUEST_ACTION and resource sub type PERMIT_APPLY_SAVE</comment>
        <sql>
            delete from au_service_rule
            where rule_id in (select id
            from au_rule
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'PERMIT_APPLY_SAVE'
            and handler = 'requestActionViewHandler'
            and role_type = 'OPERATOR'
            and scope is null);

            delete
            from au_rule
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'PERMIT_APPLY_SAVE'
            and handler = 'requestActionViewHandler'
            and role_type = 'OPERATOR'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_APPLY_SAVE', 'requestActionViewHandler', 'OPERATOR');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus cross join au_rule aur
                where aus.name  in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_APPLY_SAVE'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'OPERATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_auth_rule_for_deprecated_request_action_PERMIT_REVIEW_SAVE" author="pafilisa@unisystems.gr">
        <comment>Delete authorization rule entry with resource type REQUEST_ACTION and resource sub type PERMIT_REVIEW_SAVE</comment>
        <sql>
            delete from au_service_rule
            where rule_id in (select id
            from au_rule
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'PERMIT_REVIEW_SAVE'
            and handler = 'requestActionViewHandler'
            and role_type = 'REGULATOR'
            and scope is null);

            delete
            from au_rule
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'PERMIT_REVIEW_SAVE'
            and handler = 'requestActionViewHandler'
            and role_type = 'REGULATOR'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_REVIEW_SAVE', 'requestActionViewHandler', 'REGULATOR');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus cross join au_rule aur
                where aus.name = 'generateRequestActionGetFileAttachmentToken'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_REVIEW_SAVE'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_update_auth_rule_for_deprecated_request_action_INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION" author="pafilisa@unisystems.gr">
        <comment>Update authorization rule entry with resource type REQUEST_ACTION and resource sub type INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION</comment>
        <sql>
            update au_rule
            set resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_APPLICATION_SUBMITTED'
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION'
            and handler = 'requestActionViewHandler'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                update au_rule
                set resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION'
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_APPLICATION_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_update_auth_rule_for_deprecated_request_action_PERMIT_ISSUANCE_APPLICATION_SUBMITTED" author="pafilisa@unisystems.gr">
        <comment>Update authorization rule entry with resource type REQUEST_ACTION and resource sub type PERMIT_ISSUANCE_APPLICATION_SUBMITTED</comment>
        <sql>
            update au_rule
            set resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMITTED'
            where resource_type = 'REQUEST_ACTION'
            and resource_sub_type = 'PERMIT_APPLY_SUBMIT'
            and handler = 'requestActionViewHandler'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                update au_rule
                set resource_sub_type = 'PERMIT_APPLY_SUBMIT'
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_ACCEPTED_for_roles_OPERATOR_and_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_ACCEPTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_ACCEPTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_ACCEPTED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_INSTALLATION_ACCOUNT_OPENING_ACCEPTED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_ACCEPTED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_ACCEPTED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null
                and s.name = 'getRequestActionById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_REJECTED_for_roles_OPERATOR_and_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_REJECTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_REJECTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_REJECTED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_INSTALLATION_ACCOUNT_OPENING_REJECTED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_REJECTED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_REJECTED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null
                and s.name = 'getRequestActionById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_INSTALLATION_ACCOUNT_OPENING_ACCOUNT_APPROVED_for_roles_OPERATOR_and_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_ACCOUNT_APPROVED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'INSTALLATION_ACCOUNT_OPENING_ACCOUNT_APPROVED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_ACCOUNT_APPROVED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_INSTALLATION_ACCOUNT_OPENING_ACCOUNT_APPROVED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_ACCOUNT_APPROVED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_ACCOUNT_APPROVED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null
                and s.name = 'getRequestActionById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_generateRequestActionGetFileAttachmentToken_service_with_request_action_type_PERMIT_ISSUANCE_APPLICATION_SUBMITTED" author="pafilisa@unisystems.gr">
    <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileAttachmentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null
                and s.name = 'generateRequestActionGetFileAttachmentToken';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_update_auth_rule_for_deprecated_request_task_type_PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW" author="pafilisa@unisystems.gr">
        <comment>Update authorization rule entry with resource type REQUEST_TASK and resource sub type PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW</comment>
        <sql>
            update au_rule
               set resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_REVIEW'
             where resource_type = 'REQUEST_TASK'
               and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW';
        </sql>
        <rollback>
            <sql>
                update au_rule
                   set resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW'
                 where resource_type = 'REQUEST_TASK'
                   and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_REVIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_update_resource_scope_permission_for_deprecated_request_task_type_PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW" author="pafilisa@unisystems.gr">
        <comment>Update resource scope permission entry with resource type REQUEST_TASK and resource sub type PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW</comment>
        <sql>
            update au_resource_scope_permission
               set resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_REVIEW'
             where resource_type = 'REQUEST_TASK'
              and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW';
        </sql>

        <rollback>
            <sql>
                update au_resource_scope_permission
                   set resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_WAIT_FOR_REVIEW'
                 where resource_type = 'REQUEST_TASK'
                   and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_REVIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_generateRequestTaskGetFileAttachmentToken_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate generateRequestTaskGetFileAttachmentToken service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'generateRequestTaskGetFileAttachmentToken');
        </sql>
        <rollback>
            <sql>
                delete
                  from au_service
                 where name = 'generateRequestTaskGetFileAttachmentToken';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_ASSOCIATE_generateRequestTaskGetFileAttachmentToken_AUTHORIZATION_SERVICE_with_authorization_rules" author="pafilisa@unisystems.gr">
        <comment>
            Associate generateRequestTaskGetFileAttachmentToken service with
            the PERMIT_ISSUANCE_APPLICATION_SUBMIT rule for operator role for scope view and
            the PERMIT_ISSUANCE_APPLICATION_REVIEW rule for regulator role for scope view
        </comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
              from au_service aus
             cross join au_rule aur
             where aus.name = 'generateRequestTaskGetFileAttachmentToken'
              and aur.resource_type = 'REQUEST_TASK'
              and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMIT'
              and aur.handler = 'requestTaskAccessHandler'
              and aur.role_type = 'OPERATOR'
              and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
              from au_service aus
             cross join au_rule aur
            where aus.name = 'generateRequestTaskGetFileAttachmentToken'
              and aur.resource_type = 'REQUEST_TASK'
              and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
              and aur.handler = 'requestTaskAccessHandler'
              and aur.role_type = 'REGULATOR'
              and aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                  from au_service_rule
                where service_id = (select id from au_service where name = 'generateRequestTaskGetFileAttachmentToken')
                  and rule_id = (select id from au_rule
                                  where resource_type = 'REQUEST_TASK'
                                    and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_SUBMIT'
                                    and handler = 'requestTaskAccessHandler'
                                    and role_type = 'OPERATOR'
                                    and scope = 'REQUEST_TASK_VIEW'
                                  );

                delete
                  from au_service_rule
                where service_id = (select id from au_service where name = 'generateRequestTaskGetFileAttachmentToken')
                  and rule_id = (select id from au_rule
                                  where resource_type = 'REQUEST_TASK'
                                    and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
                                    and handler = 'requestTaskAccessHandler'
                                    and role_type = 'REGULATOR'
                                    and scope = 'REQUEST_TASK_VIEW'
                                  );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_getNotificationSystemMessageById_authorization_service" author="pafilisa@unisystems.gr">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getNotificationSystemMessageById';</sqlCheck>
        </preConditions>
        <comment>Delete getNotificationSystemMessageById service</comment>
        <sql>
            delete
            from au_service_rule
            where service_id = (select id from au_service where name = 'getNotificationSystemMessageById');

            delete
            from au_service
            where name = 'getNotificationSystemMessageById';
        </sql>
        <rollback>
            <sql>
                insert into au_service(id, name)
                values (nextval('au_service_seq'), 'getNotificationSystemMessageById');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getNotificationSystemMessageById'
                  and aur.resource_type = 'SYSTEM_MESSAGE'
                  and aur.resource_sub_type in ('ACCOUNT_USERS_SETUP',
                                                'NEW_USER_CONFIRMED',
                                                'VERIFIER_NO_LONGER_AVAILABLE')
                  and aur.handler = 'notificationSystemMessageAccessHandler'
                  and aur.role_type = 'OPERATOR'
                  and scope is null;

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getNotificationSystemMessageById'
                  and aur.resource_type = 'SYSTEM_MESSAGE'
                  and aur.resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
                  and aur.handler = 'notificationSystemMessageAccessHandler'
                  and aur.role_type = 'VERIFIER'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_auth_rules_for_system_messages" author="pafilisa@unisystems.gr">
        <comment>Delete authorization rules for system messages</comment>
        <sql>
            delete from au_service_rule
            where rule_id in (select id from au_rule where resource_type = 'SYSTEM_MESSAGE');

            delete
            from au_rule
            where resource_type = 'SYSTEM_MESSAGE';
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE' , 'ACCOUNT_USERS_SETUP', 'notificationSystemMessageAccessHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE' , 'NEW_USER_CONFIRMED', 'notificationSystemMessageAccessHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE' , 'VERIFIER_NO_LONGER_AVAILABLE', 'notificationSystemMessageAccessHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'SYSTEM_MESSAGE' , 'NEW_VERIFICATION_BODY_INSTALLATION', 'notificationSystemMessageAccessHandler', 'VERIFIER');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_getRequestActionsByRefObjectIdAndRefObjectType_authorization_service" author="pafilisa@unisystems.gr">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getRequestActionsByRefObjectIdAndRefObjectType';</sqlCheck>
        </preConditions>
        <comment>Delete getRequestActionsByRefObjectIdAndRefObjectType service</comment>
        <sql>
            delete
            from au_service_rule
            where service_id = (select id from au_service where name = 'getRequestActionsByRefObjectIdAndRefObjectType');

            delete
            from au_service
            where name = 'getRequestActionsByRefObjectIdAndRefObjectType';
        </sql>
        <rollback>
            <sql>
                insert into au_service(id, name)
                values (nextval('au_service_seq'), 'getRequestActionsByRefObjectIdAndRefObjectType');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getRequestActionsByRefObjectIdAndRefObjectType'
                  and aur.resource_type = 'REF_OBJECT'
                  and aur.resource_sub_type in ('PERMIT', 'ACCOUNT')
                  and aur.handler = 'requestObjectAccessHandler'
                  and aur.role_type in ('OPERATOR', 'REGULATOR')
                  and scope is null;

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getRequestActionsByRefObjectIdAndRefObjectType'
                  and aur.resource_type = 'REF_OBJECT'
                  and aur.resource_sub_type = 'MESSAGE_NOTIFICATION'
                  and aur.handler = 'requestObjectAccessHandler'
                  and aur.role_type in ('OPERATOR', 'REGULATOR', 'VERIFIER')
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_remove_auth_rules_for_reference_objects" author="pafilisa@unisystems.gr">
        <comment>Delete authorization rules for reference objects</comment>
        <sql>
            delete from au_service_rule
            where rule_id in (select id from au_rule where resource_type = 'REF_OBJECT');

            delete
            from au_rule
            where resource_type = 'REF_OBJECT';
        </sql>
        <rollback>
            <sql>
                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REF_OBJECT' , 'ACCOUNT', 'requestObjectAccessHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REF_OBJECT' , 'ACCOUNT', 'requestObjectAccessHandler', 'REGULATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REF_OBJECT' , 'PERMIT', 'requestObjectAccessHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REF_OBJECT' , 'PERMIT', 'requestObjectAccessHandler', 'REGULATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REF_OBJECT' , 'MESSAGE_NOTIFICATION', 'requestObjectAccessHandler', 'OPERATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REF_OBJECT' , 'MESSAGE_NOTIFICATION', 'requestObjectAccessHandler', 'REGULATOR');

                insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
                values (nextval('au_rule_seq'), 'REF_OBJECT' , 'MESSAGE_NOTIFICATION', 'requestObjectAccessHandler', 'VERIFIER');
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_getItemTaskInfo_authorization_service" author="pafilisa@unisystems.gr">
        <preConditions onFail="WARN">
            <sqlCheck expectedResult="1">SELECT count(*) FROM au_service where name = 'getItemTaskInfo';</sqlCheck>
        </preConditions>
        <comment>Delete getItemTaskInfo service</comment>
        <sql>
            delete
            from au_service_rule
            where service_id = (select id from au_service where name = 'getItemTaskInfo');

            delete
            from au_service
            where name = 'getItemTaskInfo';
        </sql>
        <rollback>
            <sql>
                insert into au_service(id, name)
                values (nextval('au_service_seq'), 'getItemTaskInfo');

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getItemTaskInfo'
                and aur.resource_type = 'REQUEST_TASK'
                and aur.resource_sub_type in ('ACCOUNT_USERS_SETUP', 'NEW_USER_CONFIRMED', 'VERIFIER_NO_LONGER_AVAILABLE')
                and aur.handler = 'requestTaskAccessHandler'
                and aur.role_type = 'OPERATOR'
                and scope is null;

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getItemTaskInfo'
                and aur.resource_type = 'REQUEST_TASK'
                and aur.resource_sub_type = 'NEW_VERIFICATION_BODY_INSTALLATION'
                and aur.handler = 'requestTaskAccessHandler'
                and aur.role_type = 'VERIFIER'
                and scope is null;

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getItemTaskInfo'
                and aur.resource_type = 'REQUEST_TASK'
                and aur.resource_sub_type in ('INSTALLATION_ACCOUNT_OPENING_ARCHIVE',
                                              'PERMIT_ISSUANCE_APPLICATION_SUBMIT',
                                              'PERMIT_ISSUANCE_WAIT_FOR_REVIEW')
                and aur.handler = 'requestTaskAccessHandler'
                and aur.role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW';

                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'getItemTaskInfo'
                and aur.resource_type = 'REQUEST_TASK'
                and aur.resource_sub_type in ('PERMIT_ISSUANCE_APPLICATION_REVIEW', 'INSTALLATION_ACCOUNT_OPENING_APPLICATION_REVIEW')
                and aur.handler = 'requestTaskAccessHandler'
                and aur.role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_ASSOCIATE_uploadRequestTaskAttachment_AUTHORIZATION_SERVICE_with_PERMIT_ISSUANCE_APPLICATION_REVIEW_rule" author="pafilisa@unisystems.gr">
        <comment>Associate uploadRequestTaskAttachment service with the PERMIT_ISSUANCE_APPLICATION_REVIEW rule for regulator role and scope execute</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'uploadRequestTaskAttachment'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule
                where
                service_id = (select id from au_service where name = 'uploadRequestTaskAttachment')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_EXECUTE'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_edit_rights_to_regulators_for_operator_users" author="P70605">
        <comment>Add edit rights to regulators for operator users</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in
                  ('updateAccountOperatorAuthorities',
                   'deleteAccountOperatorAuthority',
                   'getOperatorUserById',
                   'updateOperatorUserById',
                   'getOperatorRoleCodes')
              and r.resource_type = 'ACCOUNT'
              and r.handler = 'accountAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'EDIT_USER'
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in
                    ('updateAccountOperatorAuthorities', 
                     'deleteAccountOperatorAuthority', 
                     'getOperatorUserById', 
                     'updateOperatorUserById', 
                     'getOperatorRoleCodes')
                  and r.resource_type = 'ACCOUNT'
                  and r.handler = 'accountAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'EDIT_USER'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_ASSOCIATE_VERIFIER_USER_MANAGEMENT_SERVICES_WITH_MANAGE_VB_SCOPE_PERMISSION_FOR_REGULATORS" author="pafilisa@unisystems.gr">
        <comment>Associate verifier user management services with MANAGE_VB resource scope permission for regulators</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
              from au_service aus
             cross join au_rule aur
            where aus.name in (
                'deleteVerifierAuthority',
                'getVerifierUserById',
                'updateVerifierUserById',
                'getVerifierRoleCodes')
              and aur.resource_type = 'CA'
              and aur.handler = 'caAccessHandler'
              and aur.scope = 'MANAGE_VB'
              and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                     au_rule r,
                     au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in (
                    'deleteVerifierAuthority',
                    'getVerifierUserById',
                    'updateVerifierUserById',
                    'getVerifierRoleCodes')
                  and r.resource_type = 'CA'
                  and r.handler = 'caAccessHandler'
                  and r.scope = 'MANAGE_VB'
                  and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_updateVerifierAuthoritiesByVerificationBodyId_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate updateVerifierAuthoritiesByVerificationBodyId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateVerifierAuthoritiesByVerificationBodyId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
              from au_service aus
             cross join au_rule aur
            where aus.name = 'updateVerifierAuthoritiesByVerificationBodyId'
              and aur.resource_type = 'CA'
              and aur.handler = 'caAccessHandler'
              and aur.scope = 'MANAGE_VB'
              and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                  from au_service_rule sr using
                      au_rule r,
                      au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'updateVerifierAuthoritiesByVerificationBodyId'
                  and r.resource_type = 'CA'
                  and r.handler = 'caAccessHandler'
                  and r.scope = 'MANAGE_VB'
                  and r.role_type = 'REGULATOR';

                delete
                  from au_service
                 where name = 'updateVerifierAuthoritiesByVerificationBodyId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_get_candidate_assignees_with_scope_request_task_assign" author="P70605">
        <comment>delete get candidate assignees with scope request task assign</comment>
        <sql>
            delete
            from au_service_rule
            where service_id = (select id from au_service where name = 'getCandidateAssignees')
              and rule_id in (select id
                              from au_rule
                              where resource_type = 'REQUEST_TASK'
                                and handler = 'requestTaskAssignAccessHandler'
                                and scope = 'REQUEST_TASK_ASSIGN');
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                         cross join au_rule aur
                where aus.name = 'getCandidateAssignees'
                  and aur.resource_type = 'REQUEST_TASK'
                  and aur.handler = 'requestTaskAssignAccessHandler'
                  and aur.scope = 'REQUEST_TASK_ASSIGN';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_ISSUANCE_REVIEW_OPERATOR_NOTIFIED_for_role_operator" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_GRANTED',
                    'requestActionViewHandler',
                    'OPERATOR');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_REJECTED',
                    'requestActionViewHandler',
                    'OPERATOR');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN',
                    'requestActionViewHandler',
                    'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_GRANTED', 'PERMIT_ISSUANCE_APPLICATION_REJECTED', 'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN')
                  and handler = 'requestActionViewHandler'
                  and role_type = 'OPERATOR'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_ISSUANCE_REVIEW_OPERATOR_NOTIFIED_for_role_regulator" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_GRANTED',
                    'requestActionViewHandler',
                    'REGULATOR');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_REJECTED',
                    'requestActionViewHandler',
                    'REGULATOR');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_GRANTED', 'PERMIT_ISSUANCE_APPLICATION_REJECTED', 'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN')
                  and handler = 'requestActionViewHandler'
                  and role_type = 'REGULATOR'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_ISSUANCE_REVIEW_OPERATOR_NOTIFIED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'getRequestActionById'
              and aur.resource_type = 'REQUEST_ACTION'
              and aur.resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_GRANTED', 'PERMIT_ISSUANCE_APPLICATION_REJECTED', 'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN')
              and aur.handler = 'requestActionViewHandler'
              and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using 
	            	au_rule r,
	            	au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_GRANTED', 'PERMIT_ISSUANCE_APPLICATION_REJECTED', 'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN')
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_generateRequestActionGetFileAttachmentToken_service_with_request_action_type_PERMIT_ISSUANCE_REVIEW_OPERATOR_NOTIFIED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'generateRequestActionGetFileAttachmentToken'
              and aur.resource_type = 'REQUEST_ACTION'
              and aur.resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_GRANTED', 'PERMIT_ISSUANCE_APPLICATION_REJECTED', 'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN')
              and aur.handler = 'requestActionViewHandler'
              and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using 
	            	au_rule r,
	            	au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'generateRequestActionGetFileAttachmentToken'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_GRANTED', 'PERMIT_ISSUANCE_APPLICATION_REJECTED', 'PERMIT_ISSUANCE_APPLICATION_DEEMED_WITHDRAWN')
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_RENAME_getCandidateAssignees_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Rename getCandidateAssignees to getCandidateAssigneesByTaskId</comment>
        <sql>
            update au_service
            set name= 'getCandidateAssigneesByTaskId'
            where name = 'getCandidateAssignees';
        </sql>
        <rollback>
            <sql>
                update au_service
                set name= 'getCandidateAssignees'
                where name = 'getCandidateAssigneesByTaskId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getCandidateAssigneesByTaskType_AUTHORIZATION_SERVICE" author="pafilisa@unisystems.gr">
        <comment>Populate getCandidateAssigneesByTaskType service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getCandidateAssigneesByTaskType');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service
                where name = 'getCandidateAssigneesByTaskType';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_ASSOCIATE_getCandidateAssigneesByTaskType_AUTHORIZATION_SERVICE_with_authorization_rules" author="pafilisa@unisystems.gr">
        <comment>
            Associate getCandidateAssigneesByTaskType service with
            the PERMIT_ISSUANCE_APPLICATION_REVIEW rule for regulator role for scope execute
        </comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssigneesByTaskType'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssigneesByTaskType')
                and rule_id = (select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                  from au_rule
                 where resource_type = 'REQUEST_TASK'
                   and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
                   and handler = 'requestTaskAccessHandler'
                   and role_type = 'REGULATOR'
                   and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
                'assignTask',
                'releaseTask',
                'getCandidateAssigneesByTaskId',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_VIEW'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                    'assignTask',
                    'releaseTask',
                    'getCandidateAssigneesByTaskId',
                    'getTaskItemInfoById',
                    'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_VIEW'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rules_for_request_task_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
                'generateRequestTaskGetFileAttachmentToken',
                'processRequestTaskAction')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_EXECUTE'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                    'generateRequestTaskGetFileAttachmentToken',
                    'processRequestTaskAction')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_EXECUTE'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
            'assignTask',
            'releaseTask',
            'getCandidateAssigneesByTaskId',
            'getTaskItemInfoById',
            'generateRequestTaskGetFileAttachmentToken')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_VIEW'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                'assignTask',
                'releaseTask',
                'getCandidateAssigneesByTaskId',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_VIEW'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rules_for_request_task_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'generateRequestTaskGetFileAttachmentToken'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_EXECUTE'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestTaskGetFileAttachmentToken'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_EXECUTE'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rule_for_request_action_type_PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED_for_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_associate_rule_for_request_action_type_PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in ('generateRequestActionGetFileAttachmentToken', 'getRequestActionById')
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('generateRequestActionGetFileAttachmentToken', 'getRequestActionById')
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_rename_getActiveAccountById_au_service_to_getAccountById" author="P35066">
        <sql>
        	update au_service
        	set name = 'getAccountById'
        	where name = 'getActiveAccountById';

        </sql>
        <rollback>
            <sql>
                update au_service
        		set name = 'getActiveAccountById'
        		where name = 'getAccountById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_ACCEPTED_REJECTED_for_role_regulator" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_ACCEPTED',
                    'requestActionViewHandler',
                    'REGULATOR');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_REJECTED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_ACCEPTED', 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_REJECTED')
                  and handler = 'requestActionViewHandler'
                  and role_type = 'REGULATOR'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_ACCEPTED_REJECTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'getRequestActionById'
              and aur.resource_type = 'REQUEST_ACTION'
              and aur.resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_ACCEPTED', 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_REJECTED')
              and aur.handler = 'requestActionViewHandler'
              and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
	            	au_rule r,
	            	au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type IN ('PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_ACCEPTED', 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEWER_REJECTED')
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS_for_roles_OPERATOR_and_REGULATOR" author="P70383">
        <comment>Add rule for request action type PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS for Operator and regulator</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS" author="P70383">
        <comment>Associate services with request action type PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileAttachmentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null
                and s.name = 'getRequestActionById';

                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_RETURNED_FOR_AMENDS'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null
                and s.name = 'generateRequestActionGetFileAttachmentToken';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_task_type_PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT_for_role_OPERATOR" author="P70383">
        <comment>Populate request task PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT execute view rule</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT', 'requestTaskAccessHandler', 'OPERATOR', 'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT', 'requestTaskAccessHandler', 'OPERATOR', 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK' and handler = 'requestTaskAccessHandler' and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT_request_task_type" author="P70383">
        <comment>Populate request task PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT execute view scope</comment>
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_task_type_PERMIT_ISSUANCE_WAIT_FOR_AMENDS_for_role_REGULATOR" author="P70383">
        <comment>Populate request task PERMIT_ISSUANCE_WAIT_FOR_AMENDS execute view rule</comment>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS', 'requestTaskAccessHandler', 'REGULATOR', 'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'REQUEST_TASK', 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS', 'requestTaskAccessHandler', 'REGULATOR', 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK' and handler = 'requestTaskAccessHandler' and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_ISSUANCE_WAIT_FOR_AMENDS_request_task_type" author="P70383">
        <comment>Populate request task PERMIT_ISSUANCE_WAIT_FOR_AMENDS execute view scope</comment>
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_AMENDS',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_AMENDS',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT_execute_scope_for_operator" author="P70383">
        <comment>Associate relevant services with PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT execute scope for operator</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_EXECUTE';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'uploadRequestTaskAttachment'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'processRequestTaskAction')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'uploadRequestTaskAttachment')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT_view_scope_for_operator" author="P70383">
        <comment>Associate relevant services with PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT view scope for operator</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssigneesByTaskId'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'releaseTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'generateRequestTaskGetFileAttachmentToken'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'OPERATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssigneesByTaskId')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'releaseTask')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getTaskItemInfoById')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'generateRequestTaskGetFileAttachmentToken')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_PERMIT_ISSUANCE_WAIT_FOR_AMENDS_execute_scope_for_regulator" author="P70383">
        <comment>Associate relevant services with PERMIT_ISSUANCE_WAIT_FOR_AMENDS execute scope for regulator</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'processRequestTaskAction')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_PERMIT_ISSUANCE_WAIT_FOR_AMENDS_view_scope_for_regulator" author="P70383">
        <comment>Associate relevant services with PERMIT_ISSUANCE_WAIT_FOR_AMENDS view scope for regulator</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'assignTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getCandidateAssigneesByTaskId'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'releaseTask'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'generateRequestTaskGetFileAttachmentToken'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'assignTask')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getCandidateAssigneesByTaskId')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'releaseTask')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getTaskItemInfoById')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );

                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'generateRequestTaskGetFileAttachmentToken')
                and rule_id = (
                select id from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW'
                );
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_ISSUANCE_RECALLED_FROM_AMENDS_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_ISSUANCE_RECALLED_FROM_AMENDS', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_ISSUANCE_RECALLED_FROM_AMENDS', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_ISSUANCE_RECALLED_FROM_AMENDS'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_ISSUANCE_RECALLED_FROM_AMENDS" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_ISSUANCE_RECALLED_FROM_AMENDS'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_ISSUANCE_RECALLED_FROM_AMENDS'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null
                  and s.name = 'getRequestActionById';

            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_getWorkflowsByAccountId_authorization_service" author="P35066">
        <comment>Populate getWorkflowsByAccountId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getWorkflowsByAccountId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getWorkflowsByAccountId'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'REGULATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getWorkflowsByAccountId'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getWorkflowsByAccountId');

                delete
                from au_service
                where name = 'getWorkflowsByAccountId';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_populate_updateAccountSiteName_authorization_service" author="P35066">
        <comment>Populate updateAccountSiteName service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateAccountSiteName');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateAccountSiteName'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'REGULATOR';
            
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateAccountSiteName'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateAccountSiteName');

                delete
                from au_service
                where name = 'updateAccountSiteName';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_populate_updateAccountRegistryId_authorization_service" author="P35066">
        <comment>Populate updateAccountRegistryId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateAccountRegistryId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateAccountRegistryId'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateAccountRegistryId');

                delete
                from au_service
                where name = 'updateAccountRegistryId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_updateAccountSopId_authorization_service" author="P35066">
        <comment>Populate updateAccountSopId service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateAccountSopId');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateAccountSopId'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateAccountSopId');

                delete
                from au_service
                where name = 'updateAccountSopId';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED_for_roles_OPERATOR_and_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_updateAccountAddress_authorization_service" author="P70383">
        <comment>Populate updateAccountAddress service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateAccountAddress');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateAccountAddress'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'REGULATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateAccountAddress'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateAccountAddress');

                delete
                from au_service
                where name = 'updateAccountAddress';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_service_for_processRequestCreateAction_method" author="P35066">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'processRequestCreateAction');
        </sql>
        <rollback>
            <sql>
                delete from au_service where name = 'processRequestCreateAction';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_rule_for_ACCOUNT_resource_and_INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION_subresource_for_operator" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'ACCOUNT', 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION', 'accountRequestCreateHandler', 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'ACCOUNT'
                and resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION'
                and handler = 'accountRequestCreateHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_processRequestCreateAction_service_with_ACCOUNT_resource_and_accountRequestCreateHandler_for_operator_rule" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestCreateAction'
            and r.resource_type = 'ACCOUNT'
            and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION'
            and r.handler = 'accountRequestCreateHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestCreateAction'
                and r.resource_type = 'ACCOUNT'
                and r.resource_sub_type = 'INSTALLATION_ACCOUNT_OPENING_SUBMIT_APPLICATION'
                and r.handler = 'accountRequestCreateHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_rule_for_ACCOUNT_resource_and_PERMIT_SURRENDER_subresource_and_request_create_handler_for_operator" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'ACCOUNT', 'PERMIT_SURRENDER', 'accountRequestCreateHandler', 'OPERATOR', 'REQUEST_CREATE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'ACCOUNT'
                and resource_sub_type = 'PERMIT_SURRENDER'
                and handler = 'accountRequestCreateHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_processRequestCreateAction_service_with_ACCOUNT_PERMIT_SURRENDER_create_handler_rule" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestCreateAction'
            and r.resource_type = 'ACCOUNT'
            and r.resource_sub_type = 'PERMIT_SURRENDER'
            and r.handler = 'accountRequestCreateHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_CREATE';

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestCreateAction'
                and r.resource_type = 'ACCOUNT'
                and r.resource_sub_type = 'PERMIT_SURRENDER'
                and r.handler = 'accountRequestCreateHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_resource_scope_permission_for_ACCOUNT_resource_type_and_PERMIT_SURRENDER_subtype_for_request_create_scope" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'ACCOUNT',
            'PERMIT_SURRENDER',
            'REQUEST_CREATE',
            'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'ACCOUNT'
                and resource_sub_type = 'PERMIT_SURRENDER'
                and scope = 'REQUEST_CREATE'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_SURRENDER_APPLICATION_SUBMIT_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_SURRENDER_APPLICATION_SUBMIT', 
            	'REQUEST_TASK_VIEW', 
            	'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT' 
                and scope = 'REQUEST_TASK_VIEW' 
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_SURRENDER_APPLICATION_SUBMIT_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            	'REQUEST_TASK' , 
            	'PERMIT_SURRENDER_APPLICATION_SUBMIT', 
            	'requestTaskAccessHandler', 
            	'OPERATOR', 
            	'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_SURRENDER_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_SURRENDER_APPLICATION_SUBMIT_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_SURRENDER_APPLICATION_SUBMIT', 
            	'REQUEST_TASK_EXECUTE', 
            	'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT' 
                and scope = 'REQUEST_TASK_EXECUTE' 
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_SURRENDER_APPLICATION_SUBMIT_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            	'REQUEST_TASK' , 
            	'PERMIT_SURRENDER_APPLICATION_SUBMIT', 
            	'requestTaskAccessHandler', 
            	'OPERATOR', 
            	'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_execute_rule_for_PERMIT_SURRENDER_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_uploadRequestTaskAttachment_with_PERMIT_ISSUANCE_WAIT_FOR_AMENDS_execute_scope_for_regulator" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'uploadRequestTaskAttachment'
              and aur.resource_type = 'REQUEST_TASK'
              and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
              and aur.handler = 'requestTaskAccessHandler'
              and aur.role_type = 'REGULATOR'
              and aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'uploadRequestTaskAttachment')
                  and rule_id = (
                    select id from au_rule
                    where resource_type = 'REQUEST_TASK'
                      and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
                      and handler = 'requestTaskAccessHandler'
                      and role_type = 'REGULATOR'
                      and scope = 'REQUEST_TASK_EXECUTE'
                );
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_RFI_SUBMITTED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_SUBMITTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_SUBMITTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'RFI_SUBMITTED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RFI_SUBMITTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'RFI_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'RFI_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK',
                    'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_VIEW');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK',
                    'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK',
                    'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK',
                    'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where (aus.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment') and
                   aur.resource_type = 'REQUEST_TASK' and
                   aur.resource_sub_type = 'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT' and
                   aur.handler = 'requestTaskAccessHandler' and
                   aur.role_type = 'OPERATOR' and
                   aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where (aus.name in ('getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken') and
                   aur.resource_type = 'REQUEST_TASK' and
                   aur.resource_sub_type = 'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT' and
                   aur.handler = 'requestTaskAccessHandler' and
                   aur.role_type = 'OPERATOR' and
                   aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                                    from au_service
                                    where name in ('processRequestTaskAction',
                                                   'uploadRequestTaskAttachment',
                                                   'getTaskItemInfoById',
                                                   'generateRequestTaskGetFileAttachmentToken'))
                  and rule_id in (
                    select id
                    from au_rule
                    where resource_type = 'REQUEST_TASK'
                      and resource_sub_type = 'PERMIT_ISSUANCE_RFI_RESPONSE_SUBMIT'
                      and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where (aus.name ='processRequestTaskAction' and
                   aur.resource_type = 'REQUEST_TASK' and
                   aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE' and
                   aur.handler = 'requestTaskAccessHandler' and
                   aur.role_type = 'REGULATOR' and
                   aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where (aus.name = 'getTaskItemInfoById' and
                   aur.resource_type = 'REQUEST_TASK' and
                   aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE' and
                   aur.handler = 'requestTaskAccessHandler' and
                   aur.role_type = 'REGULATOR' and
                   aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                                    from au_service
                                    where name in ('processRequestTaskAction', 'getTaskItemInfoById'))
                  and rule_id in (
                    select id
                    from au_rule
                    where resource_type = 'REQUEST_TASK'
                      and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RFI_RESPONSE'
                      and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_NOTIFICATION_TEMPLATE_ACCESS_RULE" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'NOTIFICATION_TEMPLATE' , 'notificationTemplateAccessHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                  from au_rule
                 where resource_type = 'NOTIFICATION_TEMPLATE'
                   and handler = 'notificationTemplateAccessHandler'
                   and role_type = 'REGULATOR'
                   and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_getNotificationTemplateById_authorization_service" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getNotificationTemplateById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getNotificationTemplateById'
            and aur.resource_type = 'NOTIFICATION_TEMPLATE'
            and aur.resource_sub_type is null
            and aur.handler = 'notificationTemplateAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;

        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getNotificationTemplateById');

                delete
                from au_service
                where name = 'getNotificationTemplateById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_updateNotificationTemplate_authorization_service" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateNotificationTemplate');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateNotificationTemplate'
            and aur.resource_type = 'NOTIFICATION_TEMPLATE'
            and aur.resource_sub_type is null
            and aur.handler = 'notificationTemplateAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;

        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateNotificationTemplate');

                delete
                from au_service
                where name = 'updateNotificationTemplate';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_SUBMITTED_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'PERMIT_SURRENDER_APPLICATION_SUBMITTED', 
            	'requestActionViewHandler', 
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_SUBMITTED_for_operator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_SUBMITTED_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 
            	'REQUEST_ACTION' , 
            	'PERMIT_SURRENDER_APPLICATION_SUBMITTED', 
            	'requestActionViewHandler', 
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_SUBMITTED_for_regulator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_SURRENDER_APPLICATION_REVIEW_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_SURRENDER_APPLICATION_REVIEW', 
            	'REQUEST_TASK_VIEW', 
            	'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW' 
                and scope = 'REQUEST_TASK_VIEW' 
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_SURRENDER_APPLICATION_REVIEW_and_role_REGULATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            'REQUEST_TASK' , 
            'PERMIT_SURRENDER_APPLICATION_REVIEW', 
            'requestTaskAccessHandler', 
            'REGULATOR', 
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_SURRENDER_APPLICATION_REVIEW_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_SURRENDER_APPLICATION_REVIEW_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_SURRENDER_APPLICATION_REVIEW', 
            	'REQUEST_TASK_EXECUTE', 
            	'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW' 
                and scope = 'REQUEST_TASK_EXECUTE' 
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_SURRENDER_APPLICATION_REVIEW_and_role_REGULATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            'REQUEST_TASK' , 
            'PERMIT_SURRENDER_APPLICATION_REVIEW', 
            'requestTaskAccessHandler', 
            'REGULATOR', 
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_execute_rule_for_PERMIT_SURRENDER_APPLICATION_REVIEW_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('processRequestTaskAction', 'getCandidateAssigneesByTaskType')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction', 'getCandidateAssigneesByTaskType')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
            	and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_updateDocumentTemplate_authorization_service" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateDocumentTemplate');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'updateDocumentTemplate'
            and aur.resource_type = 'DOCUMENT_TEMPLATE'
            and aur.resource_sub_type is null
            and aur.handler = 'documentTemplateAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;

        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateDocumentTemplate');

                delete
                from au_service
                where name = 'updateDocumentTemplate';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_uploadDocumentTemplateFile_authorization_service" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'uploadDocumentTemplateFile');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'uploadDocumentTemplateFile'
            and aur.resource_type = 'DOCUMENT_TEMPLATE'
            and aur.resource_sub_type is null
            and aur.handler = 'documentTemplateAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;

        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'uploadDocumentTemplateFile');

                delete
                from au_service
                where name = 'uploadDocumentTemplateFile';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_SURRENDER_WAIT_FOR_REVIEW_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'), 
            	'REQUEST_TASK', 
            	'PERMIT_SURRENDER_WAIT_FOR_REVIEW', 
            	'REQUEST_TASK_VIEW', 
            	'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK' 
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_REVIEW' 
                and scope = 'REQUEST_TASK_VIEW' 
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_SURRENDER_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 
            'REQUEST_TASK' , 
            'PERMIT_SURRENDER_WAIT_FOR_REVIEW', 
            'requestTaskAccessHandler', 
            'OPERATOR', 
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_SURRENDER_WAIT_FOR_REVIEW_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_DOCUMENT_TEMPLATE_ACCESS_RULE" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, handler, role_type)
            values (nextval('au_rule_seq'), 'DOCUMENT_TEMPLATE' , 'documentTemplateAccessHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'DOCUMENT_TEMPLATE'
                and handler = 'documentTemplateAccessHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_getDocumentTemplateById_authorization_service" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getDocumentTemplateById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getDocumentTemplateById'
            and aur.resource_type = 'DOCUMENT_TEMPLATE'
            and aur.resource_sub_type is null
            and aur.handler = 'documentTemplateAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;

        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getDocumentTemplateById');

                delete
                from au_service
                where name = 'getDocumentTemplateById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_generateGetDocumentTemplateFileToken_authorization_service" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'generateGetDocumentTemplateFileToken');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'generateGetDocumentTemplateFileToken'
            and aur.resource_type = 'DOCUMENT_TEMPLATE'
            and aur.resource_sub_type is null
            and aur.handler = 'documentTemplateAccessHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;

        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'generateGetDocumentTemplateFileToken');

                delete
                from au_service
                where name = 'generateGetDocumentTemplateFileToken';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_add_rule_for_request_action_type_RDE_SUBMITTED_for_roles_OPERATOR_and_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_SUBMITTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_SUBMITTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'RDE_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RDE_SUBMITTED" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'RDE_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'RDE_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_RDE_RESPONSE_SUBMIT'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name ='processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_add_rule_for_request_action_type_RFI_RESPONSE_SUBMITTED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_RESPONSE_SUBMITTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_RESPONSE_SUBMITTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'RFI_RESPONSE_SUBMITTED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RFI_RESPONSE_SUBMITTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'RFI_RESPONSE_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'RFI_RESPONSE_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_ACCEPTED_for_role_regulator" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_ACCEPTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_ACCEPTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_REJECTED_for_role_regulator" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_REJECTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_REJECTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_ACCEPTED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getRequestActionById'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_ACCEPTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                and aus.id = sr.service_id
                and aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_ACCEPTED'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_REJECTED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getRequestActionById'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_REJECTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                and aus.id = sr.service_id
                and aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEWER_REJECTED'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_RDE_ACCEPTED_RDE_REJECTED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION', 'RDE_ACCEPTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION', 'RDE_ACCEPTED', 'requestActionViewHandler', 'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION', 'RDE_REJECTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION', 'RDE_REJECTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type in ('RDE_ACCEPTED', 'RDE_REJECTED')
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RDE_ACCEPTED_RDE_REJECTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type IN ('RDE_ACCEPTED', 'RDE_REJECTED')
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
            au_rule r,
            au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type IN ('RDE_ACCEPTED', 'RDE_REJECTED')
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_RFI_CANCELLED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_CANCELLED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_CANCELLED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'RFI_CANCELLED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RFI_CANCELLED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'RFI_CANCELLED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'RFI_CANCELLED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getItemsByRequest_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getAssignedItemsByAccount service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getItemsByRequest');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getItemsByRequest' and aur.resource_type = 'REQUEST' and aur.handler = 'requestAccessHandler' and aur.role_type = 'OPERATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getItemsByRequest' and aur.resource_type = 'REQUEST' and aur.handler = 'requestAccessHandler' and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getItemsByRequest');
                delete from au_service where name = 'getItemsByRequest';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRequestDetailsById_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getRequestDetailsById service</comment>
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getRequestDetailsById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getRequestDetailsById' and aur.resource_type = 'REQUEST' and aur.handler = 'requestAccessHandler' and aur.role_type = 'OPERATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id from au_service aus cross join au_rule aur where
            aus.name = 'getRequestDetailsById' and aur.resource_type = 'REQUEST' and aur.handler = 'requestAccessHandler' and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule where service_id = (select id from au_service where name = 'getRequestDetailsById');
                delete from au_service where name = 'getRequestDetailsById';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_POPULATE_getRequestDetailsByAccountId_AUTHORIZATION_SERVICE" author="P70383">
        <comment>Populate getRequestDetailsByAccountId service by renaming getWorkflowsByAccountId</comment>
        <sql>
            UPDATE au_service
            SET name = 'getRequestDetailsByAccountId'
            WHERE name = 'getWorkflowsByAccountId'
        </sql>
        <rollback>
            <sql>
                UPDATE au_service
                SET name = 'getWorkflowsByAccountId'
                WHERE name = 'getRequestDetailsByAccountId'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_CANCELLED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_SURRENDER_APPLICATION_CANCELLED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_SURRENDER_APPLICATION_CANCELLED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_CANCELLED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_SURRENDER_APPLICATION_CANCELLED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_CANCELLED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_CANCELLED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_detach_generateRequestActionGetFileAttachmentToken_service_from_request_action_type_PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED" author="pafilisa@unisystems.gr">
        <sql>
            delete from au_service_rule sr
            using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and s.name =  'generateRequestActionGetFileAttachmentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select s.id, r.id
                from au_service s
                cross join au_rule r
                where s.name = 'generateRequestActionGetFileAttachmentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_detach_generateRequestActionGetFileAttachmentToken_service_from_request_action_type_PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED" author="pafilisa@unisystems.gr">
        <sql>
            delete
            from au_service_rule sr using
            au_rule aur,
            au_service aus
            where aur.id = sr.rule_id
            and aus.id = sr.service_id
            and aus.name = 'generateRequestActionGetFileAttachmentToken'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'generateRequestActionGetFileAttachmentToken'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_ISSUANCE_PEER_REVIEW_REQUESTED'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_detach_generateRequestTaskGetFileAttachmentToken_service_from_request_task_PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW_with_execute_scope" author="pafilisa@unisystems.gr">
        <sql>
            delete
            from au_service_rule sr using
            au_rule aur,
            au_service aus
            where aur.id = sr.rule_id
            and aus.id = sr.service_id
            and aus.name = 'generateRequestTaskGetFileAttachmentToken'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_EXECUTE'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'generateRequestTaskGetFileAttachmentToken'
                and aur.resource_type = 'REQUEST_TASK'
                and aur.resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_PEER_REVIEW'
                and aur.handler = 'requestTaskAccessHandler'
                and aur.scope = 'REQUEST_TASK_EXECUTE'
                and aur.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_detach_generateRequestTaskGetFileAttachmentToken_service_from_request_task_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW_with_execute_scope" author="pafilisa@unisystems.gr">
        <sql>
            delete
            from au_service_rule sr using
            au_rule aur,
            au_service aus
            where aur.id = sr.rule_id
            and aus.id = sr.service_id
            and aus.name = 'generateRequestTaskGetFileAttachmentToken'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_EXECUTE'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'generateRequestTaskGetFileAttachmentToken'
                and aur.resource_type = 'REQUEST_TASK'
                and aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and aur.handler = 'requestTaskAccessHandler'
                and aur.scope = 'REQUEST_TASK_EXECUTE'
                and aur.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rule_for_request_action_type_PERMIT_SURRENDER_PEER_REVIEW_REQUESTED_for_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_SURRENDER_PEER_REVIEW_REQUESTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_PEER_REVIEW_REQUESTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rule_for_request_action_type_PERMIT_SURRENDER_PEER_REVIEW_REQUESTED_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getRequestActionById'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_PEER_REVIEW_REQUESTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                and aus.id = sr.service_id
                and aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_SURRENDER_PEER_REVIEW_REQUESTED'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_permission_for_PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_permission_for_PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_rule_for_request_task_PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_rule_for_request_task_PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
            'assignTask',
            'releaseTask',
            'getCandidateAssigneesByTaskId',
            'getTaskItemInfoById',
            'generateRequestTaskGetFileAttachmentToken')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_VIEW'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                'assignTask',
                'releaseTask',
                'getCandidateAssigneesByTaskId',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_VIEW'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_permission_for_PERMIT_SURRENDER_APPLICATION_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_PEER_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_PEER_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_permission_for_PERMIT_SURRENDER_APPLICATION_PEER_REVIEW_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_PEER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_PEER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_rule_for_request_task_PERMIT_SURRENDER_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_rule_for_request_task_PERMIT_SURRENDER_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_SURRENDER_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
            'assignTask',
            'releaseTask',
            'getCandidateAssigneesByTaskId',
            'getTaskItemInfoById',
            'generateRequestTaskGetFileAttachmentToken')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_VIEW'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                'assignTask',
                'releaseTask',
                'getCandidateAssigneesByTaskId',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_VIEW'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rules_for_request_task_PERMIT_SURRENDER_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_EXECUTE'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_EXECUTE'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_insert_service_rule_PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where (aus.name in ('uploadRequestTaskAttachment') and
                   aur.resource_type = 'REQUEST_TASK' and
                   aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE' and
                   aur.handler = 'requestTaskAccessHandler' and
                   aur.role_type = 'REGULATOR' and
                   aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where (aus.name in ('generateRequestTaskGetFileAttachmentToken') and
                   aur.resource_type = 'REQUEST_TASK' and
                   aur.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE' and
                   aur.handler = 'requestTaskAccessHandler' and
                   aur.role_type = 'REGULATOR' and
                   aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                                     from au_service
                                     where name in ('uploadRequestTaskAttachment',
                                                    'generateRequestTaskGetFileAttachmentToken'))
                  and rule_id in (
                    select id
                    from au_rule
                    where resource_type = 'REQUEST_TASK'
                      and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_RDE_RESPONSE'
                      and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_RDE_FORCE_ACCEPTED_RDE_FORCE_REJECTED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_FORCE_ACCEPTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_FORCE_ACCEPTED', 'requestActionViewHandler', 'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_FORCE_REJECTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_FORCE_REJECTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type IN ('RDE_FORCE_ACCEPTED', 'RDE_FORCE_REJECTED')
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RDE_FORCE_ACCEPTED_RDE_FORCE_REJECTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type IN ('RDE_FORCE_ACCEPTED', 'RDE_FORCE_REJECTED')
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type IN ('RDE_FORCE_ACCEPTED', 'RDE_FORCE_REJECTED')
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_RFI_EXPIRED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_EXPIRED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RFI_EXPIRED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'RFI_EXPIRED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RFI_EXPIRED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'RFI_EXPIRED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'RFI_EXPIRED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_processRequestTaskAction_with_request_task_type_PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW" author="P70383">
        <comment>Associate processRequestTaskAction service with request task type 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_RDE_EXPIRED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_EXPIRED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_EXPIRED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'RDE_EXPIRED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RDE_EXPIRED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'RDE_EXPIRED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'RDE_EXPIRED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_permission_for_PERMIT_SURRENDER_CESSATION_SUBMIT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_CESSATION_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_permission_for_PERMIT_SURRENDER_CESSATION_SUBMIT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_CESSATION_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_rule_for_request_task_PERMIT_SURRENDER_CESSATION_SUBMIT_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_SURRENDER_CESSATION_SUBMIT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_rule_for_request_task_PERMIT_SURRENDER_CESSATION_SUBMIT_and_role_REGULATOR" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_SURRENDER_CESSATION_SUBMIT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_SURRENDER_CESSATION_SUBMIT_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
            'assignTask',
            'releaseTask',
            'getCandidateAssigneesByTaskId',
            'getTaskItemInfoById')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_VIEW'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                'assignTask',
                'releaseTask',
                'getCandidateAssigneesByTaskId',
                'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_VIEW'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rules_for_request_task_PERMIT_SURRENDER_CESSATION_SUBMIT_with_the_appropriate_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_EXECUTE'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_EXECUTE'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_for_files_of_PERMIT_SURRENDER_APPLICATION_REVIEW" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'uploadRequestTaskAttachment' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name = 'uploadRequestTaskAttachment')
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name ='processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RFI_RESPONSE'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name in ('getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction',
                'uploadRequestTaskAttachment',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_RFI_RESPONSE_SUBMIT'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name ='processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name in ('uploadRequestTaskAttachment') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name in ('generateRequestTaskGetFileAttachmentToken') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById', 'uploadRequestTaskAttachment', 'generateRequestTaskGetFileAttachmentToken'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_RDE_RESPONSE'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_RDE_RESPONSE_SUBMIT'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_processRequestTaskAction_with_request_task_type_PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW" author="P70383">
        <comment>Associate processRequestTaskAction service with request task type 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'</comment>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_CESSATION_COMPLETED_for_role_operator" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_SURRENDER_CESSATION_COMPLETED',
            'requestActionViewHandler',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_CESSATION_COMPLETED_for_role_regulator" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_SURRENDER_CESSATION_COMPLETED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_CESSATION_COMPLETED_for_operator" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'OPERATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_CESSATION_COMPLETED_for_regulator" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'REGULATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'REGULATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_RDE_CANCELLED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_CANCELLED', 'requestActionViewHandler', 'OPERATOR');
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'RDE_CANCELLED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'RDE_CANCELLED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_RDE_CANCELLED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById')
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'RDE_CANCELLED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('getRequestActionById')
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'RDE_CANCELLED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_GRANTED_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            	'REQUEST_ACTION' ,
            	'PERMIT_SURRENDER_APPLICATION_GRANTED',
            	'requestActionViewHandler',
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_GRANTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_GRANTED_for_operator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_GRANTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_GRANTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_GRANTED_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            	'REQUEST_ACTION' ,
            	'PERMIT_SURRENDER_APPLICATION_GRANTED',
            	'requestActionViewHandler',
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_GRANTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_GRANTED_for_regulator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_GRANTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_GRANTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_REJECTED_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            	'REQUEST_ACTION' ,
            	'PERMIT_SURRENDER_APPLICATION_REJECTED',
            	'requestActionViewHandler',
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REJECTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_REJECTED_for_operator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REJECTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REJECTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_REJECTED_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            	'REQUEST_ACTION' ,
            	'PERMIT_SURRENDER_APPLICATION_REJECTED',
            	'requestActionViewHandler',
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REJECTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_REJECTED_for_regulator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REJECTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_REJECTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN_for_role_operator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            	'REQUEST_ACTION' ,
            	'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN',
            	'requestActionViewHandler',
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN_for_operator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN_for_role_regulator" author="P35066">
        <sql>
        	insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            	'REQUEST_ACTION' ,
            	'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN',
            	'requestActionViewHandler',
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN_for_regulator" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_populate_getAvailableWorkflows_authorization_service" author="P70605">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getAvailableWorkflows');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'getAvailableWorkflows'
              and aur.resource_type = 'ACCOUNT'
              and aur.resource_sub_type is null
              and aur.handler = 'accountAccessHandler'
              and aur.scope is null
              and aur.role_type = 'REGULATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'getAvailableWorkflows'
              and aur.resource_type = 'ACCOUNT'
              and aur.resource_sub_type is null
              and aur.handler = 'accountAccessHandler'
              and aur.scope is null
              and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getAvailableWorkflows');

                delete
                from au_service
                where name = 'getAvailableWorkflows';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rule_for_ACCOUNT_resource_and_PERMIT_NOTIFICATION_subresource_and_request_create_handler_for_operator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'ACCOUNT', 'PERMIT_NOTIFICATION', 'accountRequestCreateHandler', 'OPERATOR', 'REQUEST_CREATE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'ACCOUNT'
                and resource_sub_type = 'PERMIT_NOTIFICATION'
                and handler = 'accountRequestCreateHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_processRequestCreateAction_service_with_ACCOUNT_PERMIT_NOTIFICATION_create_handler_rule" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestCreateAction'
            and r.resource_type = 'ACCOUNT'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION'
            and r.handler = 'accountRequestCreateHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_CREATE';

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestCreateAction'
                and r.resource_type = 'ACCOUNT'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION'
                and r.handler = 'accountRequestCreateHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_resource_scope_permission_for_ACCOUNT_resource_type_and_PERMIT_NOTIFICATION_subtype_for_request_create_scope" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'ACCOUNT',
            'PERMIT_NOTIFICATION',
            'REQUEST_CREATE',
            'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'ACCOUNT'
                and resource_sub_type = 'PERMIT_NOTIFICATION'
                and scope = 'REQUEST_CREATE'
                and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_REVOCATION_APPLICATION_SUBMIT_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_APPLICATION_SUBMIT',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_APPLICATION_SUBMIT',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_scopes_permission_for_PERMIT_REVOCATION_APPLICATION_SUBMIT_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_APPLICATION_SUBMIT',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_APPLICATION_SUBMIT',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_REVOCATION_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rule_for_ACCOUNT_resource_and_PERMIT_REVOCATION_subresource_and_request_create_handler_for_operator" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'ACCOUNT', 'PERMIT_REVOCATION', 'accountRequestCreateHandler', 'REGULATOR', 'REQUEST_CREATE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'ACCOUNT'
                  and resource_sub_type = 'PERMIT_REVOCATION'
                  and handler = 'accountRequestCreateHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_processRequestCreateAction_service_with_ACCOUNT_PERMIT_REVOCATION_create_handler_rule" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'processRequestCreateAction'
              and r.resource_type = 'ACCOUNT'
              and r.resource_sub_type = 'PERMIT_REVOCATION'
              and r.handler = 'accountRequestCreateHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_CREATE';

        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'processRequestCreateAction'
                  and r.resource_type = 'ACCOUNT'
                  and r.resource_sub_type = 'PERMIT_REVOCATION'
                  and r.handler = 'accountRequestCreateHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_resource_scope_permission_for_ACCOUNT_resource_type_and_PERMIT_REVOCATION_subtype_for_request_create_scope" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'ACCOUNT',
                        'PERMIT_REVOCATION',
                        'REQUEST_CREATE',
                        'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'ACCOUNT'
                  and resource_sub_type = 'PERMIT_REVOCATION'
                  and scope = 'REQUEST_CREATE'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_APPLICATION_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_APPLICATION_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_and_role_OPERATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_APPLICATION_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_APPLICATION_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_execute_rule_for_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_uploadDocumentTemplateFile_authorization_service" author="P35066">
        <sql>
            delete
            from au_service_rule
            where service_id = (select id from au_service where name = 'uploadDocumentTemplateFile');

            delete
            from au_service
            where name = 'uploadDocumentTemplateFile';
        </sql>
        <rollback changeSetId="0_1_0_populate_uploadDocumentTemplateFile_authorization_service" changeSetAuthor="pafilisa@unisystems.gr" />
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_REQUEST_TERMINATED_for_role_operator" author="P62629">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'REQUEST_TERMINATED',
                    'requestActionViewHandler',
                    'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'REQUEST_TERMINATED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_REQUEST_TERMINATED_for_operator" author="P62629">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'REQUEST_TERMINATED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('getRequestActionById')
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'OPERATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_REQUEST_TERMINATED_for_role_regulator" author="P62629">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'REQUEST_TERMINATED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'REQUEST_TERMINATED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_REQUEST_TERMINATED_for_regulator" author="P62629">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'REQUEST_TERMINATED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('getRequestActionById')
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'REQUEST_TERMINATED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'REGULATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_NOTIFICATION_APPLICATION_SUBMITTED_for_role_operator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED',
            'requestActionViewHandler',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_SUBMITTED_for_operator" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'OPERATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_NOTIFICATION_APPLICATION_SUBMITTED_for_role_regulator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_SUBMITTED_for_regulator" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'REGULATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'REGULATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_REVOCATION_APPLICATION_SUBMITTED" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_REVOCATION_APPLICATION_SUBMITTED',
                    'requestActionViewHandler',
                    'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_REVOCATION_APPLICATION_SUBMITTED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMITTED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_REVOCATION_APPLICATION_SUBMITTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_CANCELLED_for_roles_OPERATOR_and_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_APPLICATION_CANCELLED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_APPLICATION_CANCELLED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_CANCELLED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_NOTIFICATION_APPLICATION_CANCELLED" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_CANCELLED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_CANCELLED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_REVOCATION_APPLICATION_CANCELLED" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_REVOCATION_APPLICATION_CANCELLED',
                    'requestActionViewHandler',
                    'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_REVOCATION_APPLICATION_CANCELLED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_CANCELLED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_REVOCATION_APPLICATION_CANCELLED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_CANCELLED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_CANCELLED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_CANCELLED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_NOTIFICATION_APPLICATION_REVIEW_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_APPLICATION_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_APPLICATION_REVIEW',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_APPLICATION_REVIEW_and_role_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_APPLICATION_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_APPLICATION_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_execute_rule_for_PERMIT_NOTIFICATION_APPLICATION_REVIEW_task_type_with_request_task_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('processRequestTaskAction', 'getCandidateAssigneesByTaskType')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction', 'getCandidateAssigneesByTaskType')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_NOTIFICATION_WAIT_FOR_REVIEW_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_NOTIFICATION_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_NOTIFICATION_WAIT_FOR_REVIEW_task_type_with_request_task_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_execute_rule_for_PERMIT_REVOCATION_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getCandidateAssigneesByTaskType')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getCandidateAssigneesByTaskType')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_rule_for_request_action_type_PERMIT_REVOCATION_PEER_REVIEW_REQUESTED_for_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_REVOCATION_PEER_REVIEW_REQUESTED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVOCATION_PEER_REVIEW_REQUESTED'
                  and handler = 'requestActionViewHandler'
                  and role_type = 'REGULATOR'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rule_for_request_action_type_PERMIT_REVOCATION_PEER_REVIEW_REQUESTED_with_the_appropriate_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'getRequestActionById'
              and aur.resource_type = 'REQUEST_ACTION'
              and aur.resource_sub_type = 'PERMIT_REVOCATION_PEER_REVIEW_REQUESTED'
              and aur.handler = 'requestActionViewHandler'
              and aur.role_type = 'REGULATOR'
              and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                  and aus.id = sr.service_id
                  and aus.name = 'getRequestActionById'
                  and aur.resource_type = 'REQUEST_ACTION'
                  and aur.resource_sub_type = 'PERMIT_REVOCATION_PEER_REVIEW_REQUESTED'
                  and aur.handler = 'requestActionViewHandler'
                  and aur.role_type = 'REGULATOR'
                  and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_permission_for_PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_permission_for_PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_rule_for_request_task_PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_rule_for_request_task_PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW_with_the_appropriate_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name in ('assignTask',
                               'releaseTask',
                               'getCandidateAssigneesByTaskId',
                               'getTaskItemInfoById')
              and aur.resource_type = 'REQUEST_TASK'
              and aur.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
              and aur.handler = 'requestTaskAccessHandler'
              and aur.scope = 'REQUEST_TASK_VIEW'
              and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask',
                                 'releaseTask',
                                 'getCandidateAssigneesByTaskId',
                                 'getTaskItemInfoById')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.scope = 'REQUEST_TASK_VIEW'
                  and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rules_for_request_task_PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW_with_the_appropriate_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
              and aur.resource_type = 'REQUEST_TASK'
              and aur.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
              and aur.handler = 'requestTaskAccessHandler'
              and aur.scope = 'REQUEST_TASK_EXECUTE'
              and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'processRequestTaskAction'
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_PEER_REVIEW'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.scope = 'REQUEST_TASK_EXECUTE'
                  and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_permission_for_PERMIT_REVOCATION_APPLICATION_PEER_REVIEW_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_REVOCATION_PEER_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_REVOCATION_PEER_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_permission_for_PERMIT_REVOCATION_APPLICATION_PEER_REVIEW_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_REVOCATION_PEER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_REVOCATION_PEER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_rule_for_request_task_PERMIT_REVOCATION_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_rule_for_request_task_PERMIT_REVOCATION_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_REVOCATION_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name in ('assignTask',
                               'releaseTask',
                               'getCandidateAssigneesByTaskId',
                               'getTaskItemInfoById')
              and aur.resource_type = 'REQUEST_TASK'
              and aur.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
              and aur.handler = 'requestTaskAccessHandler'
              and aur.scope = 'REQUEST_TASK_VIEW'
              and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask',
                                 'releaseTask',
                                 'getCandidateAssigneesByTaskId',
                                 'getTaskItemInfoById')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.scope = 'REQUEST_TASK_VIEW'
                  and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rules_for_request_task_PERMIT_REVOCATION_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
              and aur.resource_type = 'REQUEST_TASK'
              and aur.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
              and aur.handler = 'requestTaskAccessHandler'
              and aur.scope = 'REQUEST_TASK_EXECUTE'
              and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'processRequestTaskAction'
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEW'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.scope = 'REQUEST_TASK_EXECUTE'
                  and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_for_request_action_type_PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_ACCEPTED_for_role_regulator" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_ACCEPTED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_ACCEPTED'
                  and handler = 'requestActionViewHandler'
                  and role_type = 'REGULATOR'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_for_request_action_type_PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_REJECTED_for_role_regulator" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_REJECTED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_REJECTED'
                  and handler = 'requestActionViewHandler'
                  and role_type = 'REGULATOR'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_ACCEPTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'getRequestActionById'
              and aur.resource_type = 'REQUEST_ACTION'
              and aur.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_ACCEPTED'
              and aur.handler = 'requestActionViewHandler'
              and aur.role_type = 'REGULATOR'
              and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                  and aus.id = sr.service_id
                  and aus.name = 'getRequestActionById'
                  and aur.resource_type = 'REQUEST_ACTION'
                  and aur.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_ACCEPTED'
                  and aur.handler = 'requestActionViewHandler'
                  and aur.role_type = 'REGULATOR'
                  and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_REJECTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'getRequestActionById'
              and aur.resource_type = 'REQUEST_ACTION'
              and aur.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_REJECTED'
              and aur.handler = 'requestActionViewHandler'
              and aur.role_type = 'REGULATOR'
              and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                  and aus.id = sr.service_id
                  and aus.name = 'getRequestActionById'
                  and aur.resource_type = 'REQUEST_ACTION'
                  and aur.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_PEER_REVIEWER_REJECTED'
                  and aur.handler = 'requestActionViewHandler'
                  and aur.role_type = 'REGULATOR'
                  and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_resource_scope_permission_PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_for_files_of_PERMIT_NOTIFICATION_APPLICATION_REVIEW" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'uploadRequestTaskAttachment' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name = 'uploadRequestTaskAttachment')
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name ='processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_RFI_RESPONSE'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_service_rule_PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name in ('getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction',
                'uploadRequestTaskAttachment',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_RFI_RESPONSE_SUBMIT'
                and handler = 'requestTaskAccessHandler')
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_REVOCATION_WAIT_FOR_APPEAL_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_WAIT_FOR_APPEAL',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_REVOCATION_WAIT_FOR_APPEAL',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_scopes_permission_for_PERMIT_REVOCATION_WAIT_FOR_APPEAL_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_WAIT_FOR_APPEAL',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_WAIT_FOR_APPEAL',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_REVOCATION_WAIT_FOR_APPEAL_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_NOTIFICATION_APPLICATION_GRANTED_for_role_operator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_GRANTED',
            'requestActionViewHandler',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_GRANTED_for_operator" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'OPERATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_NOTIFICATION_APPLICATION_GRANTED_for_role_regulator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_GRANTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_GRANTED_for_regulator" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'REGULATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'REGULATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_NOTIFICATION_APPLICATION_REJECTED_for_role_operator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_REJECTED',
            'requestActionViewHandler',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'OPERATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_REJECTED_for_operator" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'OPERATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'OPERATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_NOTIFICATION_APPLICATION_REJECTED_for_role_regulator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_REJECTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_REJECTED_for_regulator" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type = 'REGULATOR'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type = 'REGULATOR'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_getAccountHeaderInfoById_authorization_service" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'getAccountHeaderInfoById');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getAccountHeaderInfoById'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'REGULATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getAccountHeaderInfoById'
            and aur.resource_type = 'ACCOUNT'
            and aur.resource_sub_type is null
            and aur.handler = 'accountAccessHandler'
            and aur.scope is null
            and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'getAccountHeaderInfoById');

                delete
                from au_service
                where name = 'getAccountHeaderInfoById';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_populate_generateGetRegulatorSignatureToken_authorization_service" author="P35066">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'generateGetRegulatorSignatureToken');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'generateGetRegulatorSignatureToken'
              and aur.resource_type = 'CA'
              and aur.resource_sub_type is null
              and aur.handler = 'caAccessHandler'
              and aur.role_type = 'REGULATOR'
              and aur.scope = 'EDIT_USER';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'generateGetRegulatorSignatureToken');

                delete
                from au_service
                where name = 'generateGetRegulatorSignatureToken';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_rules_for_PERMIT_REVOCATION_WAIT_FOR_APPEAL_task_type_with_upload" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('generateRequestTaskGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_VIEW';
    
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('uploadRequestTaskAttachment')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                    au_rule r,
                    au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('generateRequestTaskGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';
    
                delete from au_service_rule sr
                    using
                    au_rule r,
                    au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('uploadRequestTaskAttachment')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_WAIT_FOR_APPEAL'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_create_rule_for_request_action_type_PERMIT_REVOCATION_APPLICATION_WITHDRAWN" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION',
                    'PERMIT_REVOCATION_APPLICATION_WITHDRAWN',
                    'requestActionViewHandler',
                    'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION',
                    'PERMIT_REVOCATION_APPLICATION_WITHDRAWN',
                    'requestActionViewHandler',
                    'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_WITHDRAWN'
                  and handler = 'requestActionViewHandler'
                  and role_type in ('REGULATOR', 'OPERATOR')
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_REVOCATION_APPLICATION_WITHDRAWN" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_WITHDRAWN'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_WITHDRAWN'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_VIEW';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_execute_rule_for_PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_FOLLOW_UP'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_NOTIFICATION_FOLLOW_UP_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_FOLLOW_UP_and_role_OPERATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_execute_rule_for_PERMIT_NOTIFICATION_FOLLOW_UP_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_REVOCATION_CESSATION_SUBMIT_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK',
                    'PERMIT_REVOCATION_CESSATION_SUBMIT',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK',
                    'PERMIT_REVOCATION_CESSATION_SUBMIT',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_CESSATION_SUBMIT'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_scopes_permission_for_PERMIT_REVOCATION_CESSATION_SUBMIT_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_CESSATION_SUBMIT',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_REVOCATION_CESSATION_SUBMIT',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_CESSATION_SUBMIT'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_REVOCATION_CESSATION_SUBMIT'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_REVOCATION_CESSATION_SUBMIT_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rule_for_request_action_type_PERMIT_REVOCATION_CESSATION_COMPLETED" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION',
                    'PERMIT_REVOCATION_CESSATION_COMPLETED',
                    'requestActionViewHandler',
                    'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION',
                    'PERMIT_REVOCATION_CESSATION_COMPLETED',
                    'requestActionViewHandler',
                    'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_REVOCATION_CESSATION_COMPLETED'
                  and handler = 'requestActionViewHandler'
                  and role_type in ('REGULATOR', 'OPERATOR')
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_REVOCATION_CESSATION_COMPLETED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_COMPLETED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_COMPLETED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_ISSUANCE_MAKE_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_MAKE_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_MAKE_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_ISSUANCE_MAKE_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_MAKE_PAYMENT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_MAKE_PAYMENT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_ISSUANCE_MAKE_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>



    <changeSet id="0_1_0_create_rule_for_request_action_type_PAYMENT_MARKED_AS_PAID" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION',
            'PAYMENT_MARKED_AS_PAID',
            'requestActionViewHandler',
            'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION',
            'PAYMENT_MARKED_AS_PAID',
            'requestActionViewHandler',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PAYMENT_MARKED_AS_PAID'
                and handler = 'requestActionViewHandler'
                and role_type in ('REGULATOR', 'OPERATOR')
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PAYMENT_MARKED_AS_PAID" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PAYMENT_MARKED_AS_PAID'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PAYMENT_MARKED_AS_PAID'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_ISSUANCE_TRACK_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_TRACK_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_TRACK_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_ISSUANCE_TRACK_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_TRACK_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_TRACK_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_ISSUANCE_TRACK_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rule_for_request_action_type_PAYMENT_MARKED_AS_RECEIVED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION',
            'PAYMENT_MARKED_AS_RECEIVED',
            'requestActionViewHandler',
            'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION',
            'PAYMENT_MARKED_AS_RECEIVED',
            'requestActionViewHandler',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PAYMENT_MARKED_AS_RECEIVED'
                and handler = 'requestActionViewHandler'
                and role_type in ('REGULATOR', 'OPERATOR')
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PAYMENT_MARKED_AS_RECEIVED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PAYMENT_MARKED_AS_RECEIVED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PAYMENT_MARKED_AS_RECEIVED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rule_for_request_action_type_PAYMENT_CANCELLED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION',
            'PAYMENT_CANCELLED',
            'requestActionViewHandler',
            'REGULATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION',
            'PAYMENT_CANCELLED',
            'requestActionViewHandler',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PAYMENT_CANCELLED'
                and handler = 'requestActionViewHandler'
                and role_type in ('REGULATOR', 'OPERATOR')
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PAYMENT_CANCELLED" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PAYMENT_CANCELLED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PAYMENT_CANCELLED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_ISSUANCE_CONFIRM_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_CONFIRM_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_CONFIRM_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_ISSUANCE_CONFIRM_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_CONFIRM_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_ISSUANCE_CONFIRM_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_ISSUANCE_CONFIRM_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_ISSUANCE_WAIT_FOR_REVIEW_request_task_type" author="P70453">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_ISSUANCE_WAIT_FOR_REVIEW',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_ISSUANCE_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_ISSUANCE_WAIT_FOR_REVIEW',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_SURRENDER_WAIT_FOR_REVIEW_request_task_type" author="P70453">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_SURRENDER_WAIT_FOR_REVIEW',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_SURRENDER_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_SURRENDER_WAIT_FOR_REVIEW',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_WAIT_FOR_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_NOTIFICATION_WAIT_FOR_REVIEW_request_task_type" author="P70453">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_au_service_generateRequestActionGetFileDocumentToken_and_associate_with_rfi_submitted_request_action" author="P35066">
    	<sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'generateRequestActionGetFileDocumentToken');
        </sql>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'RFI_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type in ('OPERATOR', 'REGULATOR')
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestActionGetFileDocumentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'RFI_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type in ('OPERATOR', 'REGULATOR')
                and r.scope is null;

                delete
                from au_service
                where name = 'generateRequestActionGetFileDocumentToken';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_create_rule_for_request_action_type_PERMIT_NOTIFICATION_PEER_REVIEW_REQUESTED_for_role_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_PEER_REVIEW_REQUESTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_PEER_REVIEW_REQUESTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rule_for_request_action_type_PERMIT_NOTIFICATION_PEER_REVIEW_REQUESTED_with_the_appropriate_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getRequestActionById'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_NOTIFICATION_PEER_REVIEW_REQUESTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and aur.scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                and aus.id = sr.service_id
                and aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_NOTIFICATION_PEER_REVIEW_REQUESTED'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_permission_for_PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_permission_for_PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_rule_for_request_task_PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW_and_role_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW_with_the_appropriate_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
            'assignTask',
            'releaseTask',
            'getCandidateAssigneesByTaskId',
            'getTaskItemInfoById',
            'generateRequestTaskGetFileAttachmentToken')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_VIEW'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                'assignTask',
                'releaseTask',
                'getCandidateAssigneesByTaskId',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_WAIT_FOR_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_VIEW'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_permission_for_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_NOTIFICATION_PEER_REVIEW_VIEW_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_NOTIFICATION_PEER_REVIEW_VIEW_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_permission_for_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_NOTIFICATION_PEER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_NOTIFICATION_PEER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_view_scope_rule_for_request_task_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW_and_role_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>

        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_scope_rules_for_request_task_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in (
            'assignTask',
            'releaseTask',
            'getCandidateAssigneesByTaskId',
            'getTaskItemInfoById',
            'generateRequestTaskGetFileAttachmentToken')
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_VIEW'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in (
                'assignTask',
                'releaseTask',
                'getCandidateAssigneesByTaskId',
                'getTaskItemInfoById',
                'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_VIEW'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rules_for_request_task_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW_with_the_appropriate_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction'
            and aur.resource_type = 'REQUEST_TASK'
            and aur.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
            and aur.handler = 'requestTaskAccessHandler'
            and aur.scope = 'REQUEST_TASK_EXECUTE'
            and aur.role_type = 'REGULATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.scope = 'REQUEST_TASK_EXECUTE'
                and r.role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_ACCEPTED_for_role_regulator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_ACCEPTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_ACCEPTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_ACCEPTED" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getRequestActionById'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_ACCEPTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                and aus.id = sr.service_id
                and aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_ACCEPTED'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_REJECTED_for_role_regulator" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
            'REQUEST_ACTION' ,
            'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_REJECTED',
            'requestActionViewHandler',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_REJECTED'
                and handler = 'requestActionViewHandler'
                and role_type = 'REGULATOR'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_getRequestActionById_service_with_request_action_type_PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_REJECTED" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getRequestActionById'
            and aur.resource_type = 'REQUEST_ACTION'
            and aur.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_REJECTED'
            and aur.handler = 'requestActionViewHandler'
            and aur.role_type = 'REGULATOR'
            and scope is null;
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule aur,
                au_service aus
                where aur.id = sr.rule_id
                and aus.id = sr.service_id
                and aus.name = 'getRequestActionById'
                and aur.resource_type = 'REQUEST_ACTION'
                and aur.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_PEER_REVIEWER_REJECTED'
                and aur.handler = 'requestActionViewHandler'
                and aur.role_type = 'REGULATOR'
                and aur.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_DATE_EXTENDED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_DATE_EXTENDED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_DATE_EXTENDED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_DATE_EXTENDED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_DATE_EXTENDED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_DATE_EXTENDED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_DATE_EXTENDED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_au_service_processCardPayment_and_associate_with_appropriate rules" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'processCardPayment');
        </sql>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processCardPayment'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processCardPayment'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';

                delete
                from au_service
                where name = 'processCardPayment';
            </sql>
        </rollback>
    </changeSet>


    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_VIEW';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_execute_rule_for_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId', 'uploadRequestTaskAttachment')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'OPERATOR'
                  and scope = 'REQUEST_TASK_VIEW';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'OPERATOR'
                  and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_REVIEW'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_rde_submitted_request_action" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'RDE_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type in ('OPERATOR', 'REGULATOR')
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestActionGetFileDocumentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'RDE_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type in ('OPERATOR', 'REGULATOR')
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_au_service_processExistingCardPayment_and_associate_with_appropriate rules" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'processExistingCardPayment');
        </sql>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processExistingCardPayment'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processExistingCardPayment'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';

                delete
                from au_service
                where name = 'processExistingCardPayment';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_rename_processCardPayment_au_service_to_createCardPayment" author="pafilisa@unisystems.gr">
        <sql>
            update au_service
            set name = 'createCardPayment'
            where name = 'processCardPayment';

        </sql>
        <rollback>
            <sql>
                update au_service
                set name = 'processCardPayment'
                where name = 'createCardPayment';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_RESPONSE_SUBMITTED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_RESPONSE_SUBMITTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_RESPONSE_SUBMITTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RESPONSE_SUBMITTED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_RESPONSE_SUBMITTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RESPONSE_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RESPONSE_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_NOTIFICATION_APPLICATION_COMPLETED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_APPLICATION_COMPLETED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_APPLICATION_COMPLETED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_COMPLETED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_NOTIFICATION_APPLICATION_COMPLETED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_COMPLETED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_COMPLETED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_SURRENDER_MAKE_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_MAKE_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_MAKE_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_SURRENDER_MAKE_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_MAKE_PAYMENT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_MAKE_PAYMENT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_SURRENDER_MAKE_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_SURRENDER_TRACK_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_TRACK_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_TRACK_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_SURRENDER_TRACK_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_TRACK_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_TRACK_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_SURRENDER_TRACK_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_SURRENDER_CONFIRM_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_CONFIRM_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_CONFIRM_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_SURRENDER_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_SURRENDER_CONFIRM_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_CONFIRM_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_SURRENDER_CONFIRM_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_SURRENDER_CONFIRM_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rule_for_request_task_PERMIT_SURRENDER_MAKE_PAYMENT_with_card_payment_related_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('createCardPayment', 'processExistingCardPayment')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('createCardPayment', 'processExistingCardPayment')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_RETURNED_FOR_AMENDS_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_RETURNED_FOR_AMENDS', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_RETURNED_FOR_AMENDS', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RETURNED_FOR_AMENDS'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_RETURNED_FOR_AMENDS" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RETURNED_FOR_AMENDS'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RETURNED_FOR_AMENDS'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PAYMENT_COMPLETED_for_roles_OPERATOR_and_REGULATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PAYMENT_COMPLETED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PAYMENT_COMPLETED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                and resource_sub_type = 'PAYMENT_COMPLETED'
                and handler = 'requestActionViewHandler'
                and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PAYMENT_COMPLETED" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'getRequestActionById'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PAYMENT_COMPLETED'
            and r.handler = 'requestActionViewHandler'
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'getRequestActionById'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PAYMENT_COMPLETED'
                and r.handler = 'requestActionViewHandler'
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_REVOCATION_MAKE_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_MAKE_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_REVOCATION_MAKE_PAYMENT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_MAKE_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_REVOCATION_MAKE_PAYMENT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_REVOCATION_MAKE_PAYMENT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_REVOCATION_MAKE_PAYMENT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_REVOCATION_MAKE_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_MAKE_PAYMENT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_MAKE_PAYMENT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_REVOCATION_MAKE_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_REVOCATION_TRACK_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_TRACK_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_TRACK_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_TRACK_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_TRACK_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_REVOCATION_TRACK_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_TRACK_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_TRACK_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_TRACK_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_REVOCATION_TRACK_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_REVOCATION_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_REVOCATION_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_REVOCATION_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_REVOCATION_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_REVOCATION_CONFIRM_PAYMENT_request_task_type" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_CONFIRM_PAYMENT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_CONFIRM_PAYMENT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_CONFIRM_PAYMENT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_VIEW_TASK';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_CONFIRM_PAYMENT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_REVOCATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_rules_for_request_task_PERMIT_REVOCATION_CONFIRM_PAYMENT" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_CONFIRM_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_REVOCATION_CONFIRM_PAYMENT',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_REVOCATION_CONFIRM_PAYMENT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_rules_for_PERMIT_REVOCATION_CONFIRM_PAYMENT_task_type_with_request_task_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_REVOCATION_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestTaskAction'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_REVOCATION_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_REVOCATION_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete
                from au_service_rule sr using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'processRequestTaskAction'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_REVOCATION_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_scope_rule_for_request_task_PERMIT_REVOCATION_MAKE_PAYMENT_with_card_payment_related_services" author="pafilisa@unisystems.gr">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('createCardPayment', 'processExistingCardPayment')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('createCardPayment', 'processExistingCardPayment')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_REVOCATION_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_NOTIFICATION_APPLICATION_SUBMIT_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_rule_for_request_task_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_REVIEW_and_role_OPERATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT',
                    'requestTaskAccessHandler',
                    'OPERATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'OPERATOR'
                  and scope = 'REQUEST_TASK_VIEW';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'OPERATOR'
                  and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_execute_rule_for_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMIT'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS_request_task_type" author="P70605">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS',
                        'REQUEST_TASK_VIEW',
                        'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
                  and scope = 'REQUEST_TASK_VIEW'
                  and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_VIEW_TASK';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
                  and scope = 'REQUEST_TASK_EXECUTE'
                  and permission = 'PERM_PERMIT_NOTIFICATION_REVIEW_EXECUTE_TASK';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS_and_role_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
                    'REQUEST_TASK' ,
                    'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS',
                    'requestTaskAccessHandler',
                    'REGULATOR',
                    'REQUEST_TASK_EXECUTE');
        </sql>

        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_VIEW';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
                  and handler = 'requestTaskAccessHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS_task_type_with_request_task_services" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId', 'generateRequestTaskGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId', 'generateRequestTaskGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('processRequestTaskAction')
                  and r.resource_type = 'REQUEST_TASK'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_WAIT_FOR_AMENDS'
                  and r.handler = 'requestTaskAccessHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_permit_surrender_determination_actions" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type in ('PERMIT_SURRENDER_APPLICATION_GRANTED', 'PERMIT_SURRENDER_APPLICATION_REJECTED', 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN', 'PERMIT_SURRENDER_APPLICATION_CANCELLED')
            and r.handler = 'requestActionViewHandler'
            and r.role_type in ('OPERATOR', 'REGULATOR')
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestActionGetFileDocumentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type in ('PERMIT_SURRENDER_APPLICATION_GRANTED', 'PERMIT_SURRENDER_APPLICATION_REJECTED', 'PERMIT_SURRENDER_APPLICATION_DEEMED_WITHDRAWN', 'PERMIT_SURRENDER_APPLICATION_CANCELLED')
                and r.handler = 'requestActionViewHandler'
                and r.role_type in ('OPERATOR', 'REGULATOR')
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_permit_surrender_cessation_completed_action" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type in ('OPERATOR', 'REGULATOR')
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestActionGetFileDocumentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CESSATION_COMPLETED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type in ('OPERATOR', 'REGULATOR')
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_PERMIT_NOTIFICATION_APPLICATION_GRANTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type in ('OPERATOR', 'REGULATOR')
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using au_rule r, au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'generateRequestActionGetFileDocumentToken'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_GRANTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type in ('OPERATOR', 'REGULATOR')
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_PERMIT_NOTIFICATION_APPLICATION_REJECTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type in ('OPERATOR', 'REGULATOR')
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using au_rule r, au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'generateRequestActionGetFileDocumentToken'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_APPLICATION_REJECTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.role_type in ('OPERATOR', 'REGULATOR')
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_assign_associate_rules_for_PERMIT_ISSUANCE_MAKE_PAYMENT_task_type" author="P70383">
        <sql>
            delete
            from au_service_rule sr using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select s.id, r.id
                from au_service s
                cross join au_rule r
                where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_assign_associate_rules_for_PERMIT_ISSUANCE_TRACK_PAYMENT_task_type" author="P70383">
        <sql>
            delete
            from au_service_rule sr using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select s.id, r.id
                from au_service s
                cross join au_rule r
                where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_assign_associate_rules_for_PERMIT_ISSUANCE_CONFIRM_PAYMENT_task_type" author="P70383">
        <sql>
            delete
            from au_service_rule sr using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select s.id, r.id
                from au_service s
                cross join au_rule r
                where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_ISSUANCE_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_assign_associate_rules_for_PERMIT_SURRENDER_MAKE_PAYMENT_task_type" author="P70383">
        <sql>
            delete
            from au_service_rule sr using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select s.id, r.id
                from au_service s
                cross join au_rule r
                where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_MAKE_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_assign_associate_rules_for_PERMIT_SURRENDER_TRACK_PAYMENT_task_type" author="P70383">
        <sql>
            delete
            from au_service_rule sr using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select s.id, r.id
                from au_service s
                cross join au_rule r
                where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_TRACK_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_delete_assign_associate_rules_for_PERMIT_SURRENDER_CONFIRM_PAYMENT_task_type" author="P70383">
        <sql>
            delete
            from au_service_rule sr using
            au_rule r,
            au_service s
            where r.id = sr.rule_id
            and s.id = sr.service_id
            and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select s.id, r.id
                from au_service s
                cross join au_rule r
                where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_SURRENDER_CONFIRM_PAYMENT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_permit_revocation_submitted_action" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMITTED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type in ('OPERATOR', 'REGULATOR')
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestActionGetFileDocumentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_SUBMITTED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type in ('OPERATOR', 'REGULATOR')
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_permit_revocation_withdrawn_action" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_WITHDRAWN'
            and r.handler = 'requestActionViewHandler'
            and r.role_type in ('OPERATOR', 'REGULATOR')
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestActionGetFileDocumentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_REVOCATION_APPLICATION_WITHDRAWN'
                and r.handler = 'requestActionViewHandler'
                and r.role_type in ('OPERATOR', 'REGULATOR')
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_generateRequestActionGetFileDocumentToken_service_with_permit_revocation_cessation_completed_action" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestActionGetFileDocumentToken'
            and r.resource_type = 'REQUEST_ACTION'
            and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_COMPLETED'
            and r.handler = 'requestActionViewHandler'
            and r.role_type in ('OPERATOR', 'REGULATOR')
            and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using au_rule r, au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestActionGetFileDocumentToken'
                and r.resource_type = 'REQUEST_ACTION'
                and r.resource_sub_type = 'PERMIT_REVOCATION_CESSATION_COMPLETED'
                and r.handler = 'requestActionViewHandler'
                and r.role_type in ('OPERATOR', 'REGULATOR')
                and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_RECALLED_FROM_AMENDS_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_RECALLED_FROM_AMENDS', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_RECALLED_FROM_AMENDS', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RECALLED_FROM_AMENDS'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_RECALLED_FROM_AMENDS" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RECALLED_FROM_AMENDS'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_RECALLED_FROM_AMENDS'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMITTED_for_roles_OPERATOR_and_REGULATOR" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMITTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMITTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMITTED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMITTED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_NOTIFICATION_FOLLOW_UP_APPLICATION_AMENDS_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

	<changeSet id="0_1_0_fix_resource_scope_permission_scopes_for_permit_issuance_amend_task" author="P35066">
        <sql>
        	update au_resource_scope_permission set scope = 'REQUEST_TASK_EXECUTE'
			where resource_type = 'REQUEST_TASK'
			and resource_sub_type = 'PERMIT_ISSUANCE_APPLICATION_AMENDS_SUBMIT'
			and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_SUBMIT_EXECUTE_TASK';
        </sql>
        <sql>
        	update au_resource_scope_permission set scope = 'REQUEST_TASK_EXECUTE'
			where resource_type = 'REQUEST_TASK'
			and resource_sub_type = 'PERMIT_ISSUANCE_WAIT_FOR_AMENDS'
			and permission = 'PERM_PERMIT_ISSUANCE_APPLICATION_REVIEW_EXECUTE_TASK';
        </sql>
        <rollback></rollback>
    </changeSet>

    <changeSet id="0_1_0_add_role_type_column_as_nullable_in_resource_scope_permission" author="P35066">
        <addColumn tableName="au_resource_scope_permission">
            <column name="role_type" type="varchar(255)" remarks="The role type">
                <constraints nullable="true" />
            </column>
        </addColumn>
        <rollback>
            <sql>
                alter table au_resource_scope_permission
                drop column if exists role_type;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_role_type_column_in_resource_scope_permission" author="P35066">
        <sql>
        	update au_resource_scope_permission
			set role_type = 'OPERATOR'
			where resource_type = 'ACCOUNT' and resource_sub_type is null and scope = 'EDIT_USER' and permission = 'PERM_ACCOUNT_USERS_EDIT';
        </sql>
        <sql>
        	insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
			(select nextval('au_resource_scope_permission_seq'),
			'ACCOUNT',
			null,
			'EDIT_USER',
			'PERM_ACCOUNT_USERS_EDIT',
			'REGULATOR');
        </sql>
        <sql>
	        update au_resource_scope_permission
			set role_type = 'OPERATOR'
			where resource_type = 'REQUEST_TASK' and resource_sub_type is null and scope = 'REQUEST_TASK_ASSIGN' and permission = 'PERM_TASK_ASSIGNMENT';
        </sql>
        <sql>
        	insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
			(select nextval('au_resource_scope_permission_seq'),
			'REQUEST_TASK',
			null,
			'REQUEST_TASK_ASSIGN',
			'PERM_TASK_ASSIGNMENT',
			'REGULATOR');
        </sql>
        <sql>
        	insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
			(select nextval('au_resource_scope_permission_seq'),
			'REQUEST_TASK',
			null,
			'REQUEST_TASK_ASSIGN',
			'PERM_TASK_ASSIGNMENT',
			'VERIFIER');
        </sql>
        <sql>
	        with t as (
				select sp.id as rowid, r.role_type
				from au_resource_scope_permission sp
				inner join au_rule r
				on (r.resource_type = sp.resource_type
					and ((r.resource_sub_type = sp.resource_sub_type or (r.resource_sub_type is null and sp.resource_sub_type is null)))
					and r.scope = sp.scope)
				where sp.role_type is null
			)
			update au_resource_scope_permission
			set role_type = t.role_type
			from t
			where id = t.rowid;
        </sql>
        <rollback>
        	<sql>
        		delete from au_resource_scope_permission
        		where resource_type = 'REQUEST_TASK' and resource_sub_type is null and scope = 'REQUEST_TASK_ASSIGN' and permission = 'PERM_TASK_ASSIGNMENT' and role_type = 'VERIFIER'
        	</sql>
        	<sql>
        		delete from au_resource_scope_permission
        		where resource_type = 'REQUEST_TASK' and resource_sub_type is null and scope = 'REQUEST_TASK_ASSIGN' and permission = 'PERM_TASK_ASSIGNMENT' and role_type = 'REGULATOR'
        	</sql>
        	<sql>
        		delete from au_resource_scope_permission
        		where resource_type = 'ACCOUNT' and resource_sub_type is null and scope = 'EDIT_USER' and permission = 'PERM_ACCOUNT_USERS_EDIT' and role_type = 'REGULATOR'
        	</sql>
            <sql>
                update au_resource_scope_permission set role_type = null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_alter_role_type_column_set_as_not_nullable_in_resource_scope_permission" author="P35066">
        <addNotNullConstraint tableName="au_resource_scope_permission" columnName="role_type" />
		<rollback>
            <dropNotNullConstraint tableName="au_resource_scope_permission" columnName="role_type"/>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rules_and_service_association_for_ACCOUNT_resource_and_PERMIT_VARIATION_subresource_and_REQUEST_CREATE_handler_for_operator" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'ACCOUNT', 'PERMIT_VARIATION', 'accountRequestCreateHandler', 'OPERATOR', 'REQUEST_CREATE');

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestCreateAction'
              and r.resource_type = 'ACCOUNT'
              and r.resource_sub_type = 'PERMIT_VARIATION'
              and r.handler = 'accountRequestCreateHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_CREATE';

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'ACCOUNT',
            'PERMIT_VARIATION',
            'REQUEST_CREATE',
            'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK',
            'OPERATOR');
        </sql>
        <rollback>
            <sql>
            	delete from au_resource_scope_permission
                where resource_type = 'ACCOUNT'
                and resource_sub_type = 'PERMIT_VARIATION'
                and scope = 'REQUEST_CREATE'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK'
                and role_type = 'OPERATOR';

                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'processRequestCreateAction'
                  and r.resource_type = 'ACCOUNT'
                  and r.resource_sub_type = 'PERMIT_VARIATION'
                  and r.handler = 'accountRequestCreateHandler'
                  and r.role_type = 'OPERATOR'
                  and r.scope = 'REQUEST_CREATE';

                delete
                from au_rule
                where resource_type = 'ACCOUNT'
                  and resource_sub_type = 'PERMIT_VARIATION'
                  and handler = 'accountRequestCreateHandler'
                  and role_type = 'OPERATOR'
                  and scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rules_and_service_association_for_ACCOUNT_resource_and_PERMIT_VARIATION_subresource_and_REQUEST_CREATE_handler_for_regulator" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'ACCOUNT', 'PERMIT_VARIATION', 'accountRequestCreateHandler', 'REGULATOR', 'REQUEST_CREATE');

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'processRequestCreateAction'
              and r.resource_type = 'ACCOUNT'
              and r.resource_sub_type = 'PERMIT_VARIATION'
              and r.handler = 'accountRequestCreateHandler'
              and r.role_type = 'REGULATOR'
              and r.scope = 'REQUEST_CREATE';

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'ACCOUNT',
            'PERMIT_VARIATION',
            'REQUEST_CREATE',
            'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK',
            'REGULATOR');
        </sql>
        <rollback>
            <sql>
            	delete from au_resource_scope_permission
                where resource_type = 'ACCOUNT'
                and resource_sub_type = 'PERMIT_VARIATION'
                and scope = 'REQUEST_CREATE'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK'
                and role_type = 'REGULATOR';

            	delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'processRequestCreateAction'
                  and r.resource_type = 'ACCOUNT'
                  and r.resource_sub_type = 'PERMIT_VARIATION'
                  and r.handler = 'accountRequestCreateHandler'
                  and r.role_type = 'REGULATOR'
                  and r.scope = 'REQUEST_CREATE';

                delete
                from au_rule
                where resource_type = 'ACCOUNT'
                  and resource_sub_type = 'PERMIT_VARIATION'
                  and handler = 'accountRequestCreateHandler'
                  and role_type = 'REGULATOR'
                  and scope = 'REQUEST_CREATE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT',
            	'REQUEST_TASK_VIEW',
            	'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK',
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            	'REQUEST_TASK' ,
            	'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT',
            	'requestTaskAccessHandler',
            	'OPERATOR',
            	'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT',
            	'REQUEST_TASK_EXECUTE',
            	'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK',
            	'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            	'REQUEST_TASK' ,
            	'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT',
            	'requestTaskAccessHandler',
            	'OPERATOR',
            	'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_execute_rule_for_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('processRequestTaskAction')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT',
            	'REQUEST_TASK_VIEW',
            	'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK',
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT_and_role_REGULATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            	'REQUEST_TASK' ,
            	'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT',
            	'requestTaskAccessHandler',
            	'REGULATOR',
            	'REQUEST_TASK_VIEW');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_view_rule_for_PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT_request_task_type" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT',
            	'REQUEST_TASK_EXECUTE',
            	'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK',
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT_and_role_REGULATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            	'REQUEST_TASK' ,
            	'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT',
            	'requestTaskAccessHandler',
            	'REGULATOR',
            	'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    <changeSet id="0_1_0_associate_execute_rule_for_PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('processRequestTaskAction')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_REGULATOR_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
            	and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_rule_for_request_task_AER_APPLICATION_SUBMIT_and_role_OPERATOR" author="P70383">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'AER_APPLICATION_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'AER_APPLICATION_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'AER_APPLICATION_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_execute_scope_permission_for_AER_APPLICATION_SUBMIT_request_task_type" author="P70383">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'AER_APPLICATION_SUBMIT',
                        'REQUEST_TASK_VIEW',
                        'PERM_AER_APPLICATION_SUBMIT_VIEW_TASK',
                        'OPERATOR');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
                (select nextval('au_resource_scope_permission_seq'),
                        'REQUEST_TASK',
                        'AER_APPLICATION_SUBMIT',
                        'REQUEST_TASK_EXECUTE',
                        'PERM_AER_APPLICATION_SUBMIT_EXECUTE_TASK',
                        'OPERATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'AER_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_AER_APPLICATION_SUBMIT_VIEW_TASK'
                and role_type = 'OPERATOR';

                delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'AER_APPLICATION_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_AER_APPLICATION_SUBMIT_EXECUTE_TASK'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_view_rule_for_AER_APPLICATION_SUBMIT_task_type_with_request_task_services" author="P70383">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'AER_APPLICATION_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_TASK_VIEW';

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
              and r.resource_type = 'REQUEST_TASK'
              and r.resource_sub_type = 'AER_APPLICATION_SUBMIT'
              and r.handler = 'requestTaskAccessHandler'
              and r.role_type = 'OPERATOR'
              and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'getCandidateAssigneesByTaskId', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'AER_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'AER_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_execute_rule_for_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_task_type_with_upload_attachment_service" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'uploadRequestTaskAttachment'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'uploadRequestTaskAttachment'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_add_rule_for_request_action_type_PERMIT_VARIATION_APPLICATION_SUBMITTED_for_roles_OPERATOR_and_REGULATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_VARIATION_APPLICATION_SUBMITTED', 'requestActionViewHandler', 'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'), 'REQUEST_ACTION' , 'PERMIT_VARIATION_APPLICATION_SUBMITTED', 'requestActionViewHandler', 'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete
                from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_VARIATION_APPLICATION_SUBMITTED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_request_action_type_PERMIT_VARIATION_APPLICATION_SUBMITTED" author="P35066">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_SUBMITTED'
              and r.handler = 'requestActionViewHandler'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name in ('getRequestActionById', 'generateRequestActionGetFileAttachmentToken')
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_SUBMITTED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_updateLegalEntityName_authorization_service" author="P70605">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateLegalEntityName');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'updateLegalEntityName'
              and aur.resource_type = 'ACCOUNT'
              and aur.resource_sub_type is null
              and aur.handler = 'accountAccessHandler'
              and aur.scope is null
              and aur.role_type = 'REGULATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'updateLegalEntityName'
              and aur.resource_type = 'ACCOUNT'
              and aur.resource_sub_type is null
              and aur.handler = 'accountAccessHandler'
              and aur.scope is null
              and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateLegalEntityName');

                delete
                from au_service
                where name = 'updateLegalEntityName';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_populate_updateLegalEntityAddress_authorization_service" author="cgeorgoulis">
        <sql>
            insert into au_service(id, name)
            values (nextval('au_service_seq'), 'updateLegalEntityAddress');

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'updateLegalEntityAddress'
              and aur.resource_type = 'ACCOUNT'
              and aur.resource_sub_type is null
              and aur.handler = 'accountAccessHandler'
              and aur.scope is null
              and aur.role_type = 'REGULATOR';

            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
                     cross join au_rule aur
            where aus.name = 'updateLegalEntityAddress'
              and aur.resource_type = 'ACCOUNT'
              and aur.resource_sub_type is null
              and aur.handler = 'accountAccessHandler'
              and aur.scope is null
              and aur.role_type = 'OPERATOR';
        </sql>
        <rollback>
            <sql>
                delete
                from au_service_rule
                where service_id = (select id from au_service where name = 'updateLegalEntityAddress');

                delete
                from au_service
                where name = 'updateLegalEntityAddress';
            </sql>
        </rollback>
    </changeSet>



    <changeSet id="0_1_0_create_view_scope_permission_for_PERMIT_VARIATION_APPLICATION_REVIEW_request_task_type" author="P35066">
    	<sql>
    		insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'PERMIT_VARIATION_APPLICATION_REVIEW', 'requestTaskAccessHandler', 'REGULATOR', 'REQUEST_TASK_VIEW');
    	</sql>
    	<sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_APPLICATION_REVIEW',
            	'REQUEST_TASK_VIEW',
            	'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK',
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
            	delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK'
                and role_type = 'REGULATOR';

                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken', 'getCandidateAssigneesByTaskId')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';

            	delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_permission_for_PERMIT_VARIATION_APPLICATION_REVIEW_request_task_type" author="P35066">
    	<sql>
    		insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'), 'REQUEST_TASK' , 'PERMIT_VARIATION_APPLICATION_REVIEW', 'requestTaskAccessHandler', 'REGULATOR', 'REQUEST_TASK_EXECUTE');
    	</sql>
    	<sql>
    		insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment', 'getCandidateAssigneesByTaskType')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'REGULATOR'
            and r.scope = 'REQUEST_TASK_EXECUTE';
    	</sql>
    	<sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_APPLICATION_REVIEW',
            	'REQUEST_TASK_EXECUTE',
            	'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK',
            	'REGULATOR');
        </sql>
        <rollback>
            <sql>
            	delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK'
                and role_type = 'REGULATOR';

                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment', 'getCandidateAssigneesByTaskType')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
            	and r.scope = 'REQUEST_TASK_EXECUTE';

            	delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_APPLICATION_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_view_scope_rule_for_request_task_PERMIT_VARIATION_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_VARIATION_WAIT_FOR_REVIEW',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');
        </sql>
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_REVIEW'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_WAIT_FOR_REVIEW',
            	'REQUEST_TASK_VIEW',
            	'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK',
            	'OPERATOR');
        </sql>

        <rollback>
            <sql>
            	delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_REVIEW'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK'
                and role_type = 'OPERATOR';

            	delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name in ('assignTask', 'releaseTask', 'getTaskItemInfoById', 'getCandidateAssigneesByTaskId')
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_REVIEW'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_create_execute_scope_rule_for_request_task_PERMIT_VARIATION_WAIT_FOR_REVIEW_and_role_OPERATOR" author="P35066">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK' ,
            'PERMIT_VARIATION_WAIT_FOR_REVIEW',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            	'REQUEST_TASK',
            	'PERMIT_VARIATION_WAIT_FOR_REVIEW',
            	'REQUEST_TASK_EXECUTE',
            	'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK',
            	'OPERATOR');
        </sql>

        <rollback>
            <sql>
            	delete from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_REVIEW'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK'
                and role_type = 'OPERATOR';

                delete from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_REVIEW'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope = 'REQUEST_TASK_EXECUTE';
            </sql>
        </rollback>
    </changeSet>
    
    
    <changeSet id="0_1_0_insert_auth_data_for_request_task_type_PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK',
            'REGULATOR');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK',
            'REGULATOR');
        </sql>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <sql>
        	insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW');
        
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where (aus.name ='processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE');
        </sql>
        <rollback>
            <sql>
            	delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope in ('REQUEST_TASK_EXECUTE', 'REQUEST_TASK_VIEW'));
            
             	delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope in ('REQUEST_TASK_VIEW', 'REQUEST_TASK_EXECUTE');
                
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK'
                and role_type = 'REGULATOR';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RFI_RESPONSE'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_auth_data_for_request_task_type_PERMIT_VARIATION_RFI_RESPONSE_SUBMIT" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK',
            'OPERATOR');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK',
            'OPERATOR');
        </sql>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <sql>
        	insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in ('getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_VIEW';
        
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name in ('processRequestTaskAction', 'uploadRequestTaskAttachment') and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
            	delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'uploadRequestTaskAttachment', 'getTaskItemInfoById', 'generateRequestTaskGetFileAttachmentToken'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope in ('REQUEST_TASK_EXECUTE', 'REQUEST_TASK_VIEW'));
            
            	delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope in ('REQUEST_TASK_VIEW', 'REQUEST_TASK_EXECUTE');
            
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK'
                and role_type = 'OPERATOR';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_RFI_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>
    
    
    <changeSet id="0_1_0_insert_auth_data_for_request_task_type_PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK',
            'REGULATOR');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK',
            'REGULATOR');
        </sql>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE',
            'requestTaskAccessHandler',
            'REGULATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <sql>
        	insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW';
        
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name ='processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE';
            
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name ='uploadRequestTaskAttachment' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE';
            
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name ='generateRequestTaskGetFileAttachmentToken' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'REGULATOR' and
            aur.scope = 'REQUEST_TASK_VIEW';
        </sql>
        <rollback>
            <sql>
            	delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('processRequestTaskAction', 'getTaskItemInfoById','uploadRequestTaskAttachment', 'generateRequestTaskGetFileAttachmentToken'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'REGULATOR'
                and scope in ('REQUEST_TASK_EXECUTE', 'REQUEST_TASK_VIEW'));
            
             	delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'REGULATOR'
                and r.scope in ('REQUEST_TASK_VIEW', 'REQUEST_TASK_EXECUTE');
                
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_VIEW_TASK'
                and role_type = 'REGULATOR';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_WAIT_FOR_RDE_RESPONSE'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_SUBMIT_REVIEW_EXECUTE_TASK'
                and role_type = 'REGULATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_insert_auth_data_for_request_task_type_PERMIT_VARIATION_RDE_RESPONSE_SUBMIT" author="P35066">
        <sql>
            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT',
            'REQUEST_TASK_VIEW',
            'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK',
            'OPERATOR');

            insert into au_resource_scope_permission(id, resource_type, resource_sub_type, scope, permission, role_type)
            (select nextval('au_resource_scope_permission_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT',
            'REQUEST_TASK_EXECUTE',
            'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK',
            'OPERATOR');
        </sql>
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_VIEW');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type, scope)
            values (nextval('au_rule_seq'),
            'REQUEST_TASK',
            'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT',
            'requestTaskAccessHandler',
            'OPERATOR',
            'REQUEST_TASK_EXECUTE');
        </sql>
        <sql>
        	insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'getTaskItemInfoById' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_VIEW';
            
            insert into au_service_rule(service_id, rule_id)
            select aus.id, aur.id
            from au_service aus
            cross join au_rule aur
            where aus.name = 'processRequestTaskAction' and
            aur.resource_type = 'REQUEST_TASK' and
            aur.resource_sub_type = 'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT' and
            aur.handler = 'requestTaskAccessHandler' and
            aur.role_type = 'OPERATOR' and
            aur.scope = 'REQUEST_TASK_EXECUTE';
        </sql>
        <rollback>
            <sql>
            	delete
                from au_service_rule
                where service_id in (select id
                from au_service
                where name in ('getTaskItemInfoById', 'processRequestTaskAction'))
                and rule_id in (
                select id
                from au_rule
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT'
                and handler = 'requestTaskAccessHandler'
                and role_type = 'OPERATOR'
                and scope in ('REQUEST_TASK_EXECUTE', 'REQUEST_TASK_VIEW'));
            
            	delete
                from au_rule r
                where r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
                and r.scope in ('REQUEST_TASK_VIEW', 'REQUEST_TASK_EXECUTE');
            
                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_VIEW'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_VIEW_TASK'
                and role_type = 'OPERATOR';

                delete
                from au_resource_scope_permission
                where resource_type = 'REQUEST_TASK'
                and resource_sub_type = 'PERMIT_VARIATION_RDE_RESPONSE_SUBMIT'
                and scope = 'REQUEST_TASK_EXECUTE'
                and permission = 'PERM_PERMIT_VARIATION_APPLICATION_SUBMIT_EXECUTE_TASK'
                and role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_removeOperatorFrom_updateAccountSiteName_authorization_service" author="P63757">
        <comment>Remove Operator from updateAccountSiteName service</comment>
        <sql>
            delete
            from au_service_rule
            where
                service_id = (select id from au_service where name = 'updateAccountSiteName') and
                rule_id = (select id from au_rule where resource_type = 'ACCOUNT'
              and resource_sub_type is null
              and handler = 'accountAccessHandler'
              and scope is null
              and role_type = 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'updateAccountSiteName'
                and aur.resource_type = 'ACCOUNT'
                and aur.resource_sub_type is null
                and aur.handler = 'accountAccessHandler'
                and aur.scope is null
                and aur.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_removeOperatorFrom_updateAccountAddress_authorization_service" author="P63757">
        <comment>Remove operator from  updateAccountAddress service</comment>
        <sql>
            delete
            from au_service_rule
            where
                service_id = (select id from au_service where name = 'updateAccountAddress') and
                rule_id = (select id from au_rule where resource_type = 'ACCOUNT'
                    and resource_sub_type is null
                    and handler = 'accountAccessHandler'
                    and scope is null
                    and role_type = 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'updateAccountAddress'
                and aur.resource_type = 'ACCOUNT'
                and aur.resource_sub_type is null
                and aur.handler = 'accountAccessHandler'
                and aur.scope is null
                and aur.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_removeOperatorFrom_updateLegalEntityAddress_authorization_service" author="P63757">
        <comment>Remove operator from updateLegalEntityAddress service</comment>
        <sql>
            delete
            from au_service_rule
            where
                service_id = (select id from au_service where name = 'updateLegalEntityAddress') and
                rule_id = (select id from au_rule where resource_type = 'ACCOUNT'
                    and resource_sub_type is null
                    and handler = 'accountAccessHandler'
                    and scope is null
                    and role_type = 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'updateLegalEntityAddress'
                and aur.resource_type = 'ACCOUNT'
                and aur.resource_sub_type is null
                and aur.handler = 'accountAccessHandler'
                and aur.scope is null
                and aur.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_removeOperatorFrom_updateLegalEntityName_authorization_service" author="P63757">
        <comment>Remove operator from updateLegalEntityName service</comment>
        <sql>
            delete
            from au_service_rule
            where
                service_id = (select id from au_service where name = 'updateLegalEntityName') and
                rule_id = (select id from au_rule where resource_type = 'ACCOUNT'
                    and resource_sub_type is null
                    and handler = 'accountAccessHandler'
                    and scope is null
                    and role_type = 'OPERATOR');
        </sql>
        <rollback>
            <sql>
                insert into au_service_rule(service_id, rule_id)
                select aus.id, aur.id
                from au_service aus
                cross join au_rule aur
                where aus.name = 'updateLegalEntityName'
                and aur.resource_type = 'ACCOUNT'
                and aur.resource_sub_type is null
                and aur.handler = 'accountAccessHandler'
                and aur.scope is null
                and aur.role_type = 'OPERATOR';
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_add_rule_for_request_action_sub_type_PERMIT_VARIATION_APPLICATION_CANCELLED" author="P70605">
        <sql>
            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_VARIATION_APPLICATION_CANCELLED',
                    'requestActionViewHandler',
                    'OPERATOR');

            insert into au_rule(id, resource_type, resource_sub_type, handler, role_type)
            values (nextval('au_rule_seq'),
                    'REQUEST_ACTION' ,
                    'PERMIT_VARIATION_APPLICATION_CANCELLED',
                    'requestActionViewHandler',
                    'REGULATOR');
        </sql>
        <rollback>
            <sql>
                delete from au_rule
                where resource_type = 'REQUEST_ACTION'
                  and resource_sub_type = 'PERMIT_VARIATION_APPLICATION_CANCELLED'
                  and handler = 'requestActionViewHandler'
                  and scope is null;
            </sql>
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_associate_services_with_rule_for_request_action_type_PERMIT_VARIATION_APPLICATION_CANCELLED" author="P70605">
        <sql>
            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_CANCELLED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'OPERATOR'
              and r.scope is null;

            insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
                     cross join au_rule r
            where s.name = 'getRequestActionById'
              and r.resource_type = 'REQUEST_ACTION'
              and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_CANCELLED'
              and r.handler = 'requestActionViewHandler'
              and r.role_type = 'REGULATOR'
              and r.scope is null;
        </sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                    using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                  and s.id = sr.service_id
                  and s.name = 'getRequestActionById'
                  and r.resource_type = 'REQUEST_ACTION'
                  and r.resource_sub_type = 'PERMIT_VARIATION_APPLICATION_CANCELLED'
                  and r.handler = 'requestActionViewHandler'
                  and r.scope is null;
            </sql>
        </rollback>
    </changeSet>
    
    <changeSet id="0_1_0_associate_PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT_task_type_with_generateRequestTaskGetFileAttachmentToken_service_for_operator" author="P35066">
    	<sql>
    		insert into au_service_rule(service_id, rule_id)
            select s.id, r.id
            from au_service s
            cross join au_rule r
            where s.name = 'generateRequestTaskGetFileAttachmentToken'
            and r.resource_type = 'REQUEST_TASK'
            and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
            and r.handler = 'requestTaskAccessHandler'
            and r.role_type = 'OPERATOR'
            and r.scope = 'REQUEST_TASK_VIEW';
    	</sql>
        <rollback>
            <sql>
                delete from au_service_rule sr
                using
                au_rule r,
                au_service s
                where r.id = sr.rule_id
                and s.id = sr.service_id
                and s.name = 'generateRequestTaskGetFileAttachmentToken'
                and r.resource_type = 'REQUEST_TASK'
                and r.resource_sub_type = 'PERMIT_VARIATION_OPERATOR_APPLICATION_SUBMIT'
                and r.handler = 'requestTaskAccessHandler'
                and r.role_type = 'OPERATOR'
            	and r.scope = 'REQUEST_TASK_VIEW';
            </sql>
        </rollback>
    </changeSet>

</databaseChangeLog>
